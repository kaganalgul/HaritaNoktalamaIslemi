/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/reproj/Tile.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},e(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();import{ERROR_THRESHOLD}from"./common.js";import EventType from"../events/EventType.js";import Tile from"../Tile.js";import TileState from"../TileState.js";import Triangulation from"./Triangulation.js";import{calculateSourceExtentResolution,render as renderReprojected}from"../reproj.js";import{clamp}from"../math.js";import{getArea,getIntersection}from"../extent.js";import{listen,unlistenByKey}from"../events.js";var ReprojTile=function(e){function t(t,i,r,o,n,s,a,l,u,c,T,p){var _=e.call(this,n,TileState.IDLE,{interpolate:!!p})||this;_.renderEdges_=void 0!==T&&T,_.pixelRatio_=a,_.gutter_=l,_.canvas_=null,_.sourceTileGrid_=i,_.targetTileGrid_=o,_.wrappedTileCoord_=s||n,_.sourceTiles_=[],_.sourcesListenerKeys_=null,_.sourceZ_=0;var h=o.getTileCoordExtent(_.wrappedTileCoord_),g=_.targetTileGrid_.getExtent(),d=_.sourceTileGrid_.getExtent(),f=g?getIntersection(h,g):h;if(0===getArea(f))return _.state=TileState.EMPTY,_;var E=t.getExtent();E&&(d=d?getIntersection(d,E):E);var m=o.getResolution(_.wrappedTileCoord_[0]),S=calculateSourceExtentResolution(t,r,f,m);if(!isFinite(S)||S<=0)return _.state=TileState.EMPTY,_;var v=void 0!==c?c:ERROR_THRESHOLD;if(_.triangulation_=new Triangulation(t,r,f,d,S*v,m),0===_.triangulation_.getTriangles().length)return _.state=TileState.EMPTY,_;_.sourceZ_=i.getZForResolution(S);var y=_.triangulation_.calculateSourceExtent();if(d&&(t.canWrapX()?(y[1]=clamp(y[1],d[1],d[3]),y[3]=clamp(y[3],d[1],d[3])):y=getIntersection(y,d)),getArea(y)){for(var R=i.getTileRangeForExtentAndZ(y,_.sourceZ_),x=R.minX;x<=R.maxX;x++)for(var j=R.minY;j<=R.maxY;j++){var L=u(_.sourceZ_,x,j,a);L&&_.sourceTiles_.push(L)}0===_.sourceTiles_.length&&(_.state=TileState.EMPTY)}else _.state=TileState.EMPTY;return _}return __extends(t,e),t.prototype.getImage=function(){return this.canvas_},t.prototype.reproject_=function(){var e=[];if(this.sourceTiles_.forEach(function(t,i,r){t&&t.getState()==TileState.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===e.length)this.state=TileState.ERROR;else{var t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),r="number"==typeof i?i:i[0],o="number"==typeof i?i:i[1],n=this.targetTileGrid_.getResolution(t),s=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=renderReprojected(r,o,this.pixelRatio_,s,this.sourceTileGrid_.getExtent(),n,a,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=TileState.LOADED}this.changed()},t.prototype.load=function(){if(this.state==TileState.IDLE){this.state=TileState.LOADING,this.changed();var e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(t,i,r){var o=t.getState();if(o==TileState.IDLE||o==TileState.LOADING){e++;var n=listen(t,EventType.CHANGE,(function(i){var r=t.getState();r!=TileState.LOADED&&r!=TileState.ERROR&&r!=TileState.EMPTY||(unlistenByKey(n),0===--e&&(this.unlistenSources_(),this.reproject_()))}),this);this.sourcesListenerKeys_.push(n)}}.bind(this)),0===e?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach((function(e,t,i){e.getState()==TileState.IDLE&&e.load()}))}},t.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(unlistenByKey),this.sourcesListenerKeys_=null},t}(Tile);export default ReprojTile;
//# sourceMappingURL=/sm/861c9ea991ae781cef6d38e5c6c407a844466e7f2d2874241a454e0a7e205908.map