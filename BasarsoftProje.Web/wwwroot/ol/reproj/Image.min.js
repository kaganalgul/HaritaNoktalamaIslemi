/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/reproj/Image.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();import{ERROR_THRESHOLD}from"./common.js";import EventType from"../events/EventType.js";import ImageBase from"../ImageBase.js";import ImageState from"../ImageState.js";import Triangulation from"./Triangulation.js";import{calculateSourceResolution,render as renderReprojected}from"../reproj.js";import{getCenter,getHeight,getIntersection,getWidth}from"../extent.js";import{listen,unlistenByKey}from"../events.js";var ReprojImage=function(t){function e(e,o,r,n,i,a,s){var u=this,c=e.getExtent(),g=o.getExtent(),_=g?getIntersection(r,g):r,l=getCenter(_),p=calculateSourceResolution(e,o,l,n),h=new Triangulation(e,o,_,c,p*ERROR_THRESHOLD,n),m=a(h.calculateSourceExtent(),p,i),I=m?ImageState.IDLE:ImageState.EMPTY,f=m?m.getPixelRatio():1;return(u=t.call(this,r,n,f,I)||this).targetProj_=o,u.maxSourceExtent_=c,u.triangulation_=h,u.targetResolution_=n,u.targetExtent_=r,u.sourceImage_=m,u.sourcePixelRatio_=f,u.interpolate_=s,u.canvas_=null,u.sourceListenerKey_=null,u}return __extends(e,t),e.prototype.disposeInternal=function(){this.state==ImageState.LOADING&&this.unlistenSource_(),t.prototype.disposeInternal.call(this)},e.prototype.getImage=function(){return this.canvas_},e.prototype.getProjection=function(){return this.targetProj_},e.prototype.reproject_=function(){var t=this.sourceImage_.getState();if(t==ImageState.LOADED){var e=getWidth(this.targetExtent_)/this.targetResolution_,o=getHeight(this.targetExtent_)/this.targetResolution_;this.canvas_=renderReprojected(e,o,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_)}this.state=t,this.changed()},e.prototype.load=function(){if(this.state==ImageState.IDLE){this.state=ImageState.LOADING,this.changed();var t=this.sourceImage_.getState();t==ImageState.LOADED||t==ImageState.ERROR?this.reproject_():(this.sourceListenerKey_=listen(this.sourceImage_,EventType.CHANGE,(function(t){var e=this.sourceImage_.getState();e!=ImageState.LOADED&&e!=ImageState.ERROR||(this.unlistenSource_(),this.reproject_())}),this),this.sourceImage_.load())}},e.prototype.unlistenSource_=function(){unlistenByKey(this.sourceListenerKey_),this.sourceListenerKey_=null},e}(ImageBase);export default ReprojImage;
//# sourceMappingURL=/sm/fabc58cd6cd1d49c248ee9c743e9755896b97f198d31c2b3e588735033346d9c.map