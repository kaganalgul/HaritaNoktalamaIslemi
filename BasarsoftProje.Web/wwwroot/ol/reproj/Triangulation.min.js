/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/reproj/Triangulation.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{boundingExtent,createEmpty,extendCoordinate,getArea,getBottomLeft,getBottomRight,getTopLeft,getTopRight,getWidth,intersects}from"../extent.js";import{getTransform}from"../proj.js";import{log2,modulo}from"../math.js";var MAX_SUBDIVISION=10,MAX_TRIANGLE_WIDTH=.25,Triangulation=function(){function t(t,i,r,e,s,o){this.sourceProj_=t,this.targetProj_=i;var n={},a=getTransform(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){var i=t[0]+"/"+t[1];return n[i]||(n[i]=a(t)),n[i]},this.maxSourceExtent_=e,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!e&&!!this.sourceProj_.getExtent()&&getWidth(e)==getWidth(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?getWidth(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?getWidth(this.targetProj_.getExtent()):null;var h=getTopLeft(r),d=getTopRight(r),u=getBottomRight(r),_=getBottomLeft(r),c=this.transformInv_(h),g=this.transformInv_(d),l=this.transformInv_(u),f=this.transformInv_(_),W=MAX_SUBDIVISION+(o?Math.max(0,Math.ceil(log2(getArea(r)/(o*o*256*256)))):0);if(this.addQuad_(h,d,u,_,c,g,l,f,W),this.wrapsXInSource_){var m=1/0;this.triangles_.forEach((function(t,i,r){m=Math.min(m,t.source[0][0],t.source[1][0],t.source[2][0])})),this.triangles_.forEach(function(t){if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-m>this.sourceWorldWidth_/2){var i=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];i[0][0]-m>this.sourceWorldWidth_/2&&(i[0][0]-=this.sourceWorldWidth_),i[1][0]-m>this.sourceWorldWidth_/2&&(i[1][0]-=this.sourceWorldWidth_),i[2][0]-m>this.sourceWorldWidth_/2&&(i[2][0]-=this.sourceWorldWidth_);var r=Math.min(i[0][0],i[1][0],i[2][0]);Math.max(i[0][0],i[1][0],i[2][0])-r<this.sourceWorldWidth_/2&&(t.source=i)}}.bind(this))}n={}}return t.prototype.addTriangle_=function(t,i,r,e,s,o){this.triangles_.push({source:[e,s,o],target:[t,i,r]})},t.prototype.addQuad_=function(t,i,r,e,s,o,n,a,h){var d=boundingExtent([s,o,n,a]),u=this.sourceWorldWidth_?getWidth(d)/this.sourceWorldWidth_:null,_=this.sourceWorldWidth_,c=this.sourceProj_.canWrapX()&&u>.5&&u<1,g=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){var l=boundingExtent([t,i,r,e]);g=getWidth(l)/this.targetWorldWidth_>MAX_TRIANGLE_WIDTH||g}!c&&this.sourceProj_.isGlobal()&&u&&(g=u>MAX_TRIANGLE_WIDTH||g)}if(!(!g&&this.maxSourceExtent_&&isFinite(d[0])&&isFinite(d[1])&&isFinite(d[2])&&isFinite(d[3]))||intersects(d,this.maxSourceExtent_)){var f=0;if(!(g||isFinite(s[0])&&isFinite(s[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(n[0])&&isFinite(n[1])&&isFinite(a[0])&&isFinite(a[1])))if(h>0)g=!0;else if(1!=(f=(isFinite(s[0])&&isFinite(s[1])?0:8)+(isFinite(o[0])&&isFinite(o[1])?0:4)+(isFinite(n[0])&&isFinite(n[1])?0:2)+(isFinite(a[0])&&isFinite(a[1])?0:1))&&2!=f&&4!=f&&8!=f)return;if(h>0){if(!g){var W=[(t[0]+r[0])/2,(t[1]+r[1])/2],m=this.transformInv_(W),p=void 0;if(c)p=(modulo(s[0],_)+modulo(n[0],_))/2-modulo(m[0],_);else p=(s[0]+n[0])/2-m[0];var v=(s[1]+n[1])/2-m[1];g=p*p+v*v>this.errorThresholdSquared_}if(g){if(Math.abs(t[0]-r[0])<=Math.abs(t[1]-r[1])){var I=[(i[0]+r[0])/2,(i[1]+r[1])/2],x=this.transformInv_(I),T=[(e[0]+t[0])/2,(e[1]+t[1])/2],E=this.transformInv_(T);this.addQuad_(t,i,I,T,s,o,x,E,h-1),this.addQuad_(T,I,r,e,E,x,n,a,h-1)}else{var F=[(t[0]+i[0])/2,(t[1]+i[1])/2],j=this.transformInv_(F),S=[(r[0]+e[0])/2,(r[1]+e[1])/2],P=this.transformInv_(S);this.addQuad_(t,F,S,e,s,j,P,a,h-1),this.addQuad_(F,i,r,S,j,o,n,P,h-1)}return}}if(c){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&f)&&this.addTriangle_(t,r,e,s,n,a),0==(14&f)&&this.addTriangle_(t,r,i,s,n,o),f&&(0==(13&f)&&this.addTriangle_(i,e,t,o,a,s),0==(7&f)&&this.addTriangle_(i,e,r,o,a,n))}},t.prototype.calculateSourceExtent=function(){var t=createEmpty();return this.triangles_.forEach((function(i,r,e){var s=i.source;extendCoordinate(t,s[0]),extendCoordinate(t,s[1]),extendCoordinate(t,s[2])})),t},t.prototype.getTriangles=function(){return this.triangles_},t}();export default Triangulation;
//# sourceMappingURL=/sm/6621fba0515e4771198028345a01b95e3b3bfe57001b877522ec6977495d1329.map