/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/src/renderer/canvas/VectorImageLayer.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import CanvasImageLayerRenderer from"./ImageLayer.js";import CanvasVectorLayerRenderer from"./VectorLayer.js";import EventType from"../../events/EventType.js";import ImageCanvas from"../../ImageCanvas.js";import ImageState from"../../ImageState.js";import RBush from"rbush";import ViewHint from"../../ViewHint.js";import{apply,compose,create}from"../../transform.js";import{assign}from"../../obj.js";import{getHeight,getWidth,isEmpty,scaleFromCenter}from"../../extent.js";class CanvasVectorImageLayerRenderer extends CanvasImageLayerRenderer{constructor(e){super(e),this.vectorRenderer_=new CanvasVectorLayerRenderer(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=create(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return new Promise((e=>e([])));const r=apply(this.coordinateToVectorPixelTransform_,apply(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(r)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){const r=e.pixelRatio,t=e.viewState,o=t.resolution,n=e.viewHints,a=this.vectorRenderer_;let i=e.extent;1!==this.layerImageRatio_&&(i=i.slice(0),scaleFromCenter(i,this.layerImageRatio_));const s=getWidth(i)/o,m=getHeight(i)/o;if(!n[ViewHint.ANIMATING]&&!n[ViewHint.INTERACTING]&&!isEmpty(i)){a.useContainer(null,null,1);const n=a.context,d=assign({},e,{declutterTree:new RBush(9),extent:i,size:[s,m],viewState:assign({},e.viewState,{rotation:0})});let c=!0;const l=new ImageCanvas(i,o,r,n.canvas,(function(e){a.prepareFrame(d)&&a.replayGroupChanged&&(a.clipping=!1,a.renderFrame(d,null)&&(a.renderDeclutter(d),c=!1),e())}));l.addEventListener(EventType.CHANGE,function(){if(l.getState()!==ImageState.LOADED)return;this.image_=c?null:l;const e=l.getResolution(),o=l.getPixelRatio(),n=e*r/o;this.renderedResolution=n,this.coordinateToVectorPixelTransform_=compose(this.coordinateToVectorPixelTransform_,s/2,m/2,1/n,-1/n,0,-t.center[0],-t.center[1])}.bind(this)),l.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,r,t,o,n){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,r,t,o,n):super.forEachFeatureAtCoordinate(e,r,t,o,n)}}export default CanvasVectorImageLayerRenderer;
//# sourceMappingURL=/sm/4cbcb7036c2442ec2e7a3f12c6ddf48bda55035f1f1e004f991cfe85817a01df.map