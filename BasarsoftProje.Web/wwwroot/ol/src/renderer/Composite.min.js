/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/src/renderer/Composite.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import MapRenderer from"./Map.js";import ObjectEventType from"../ObjectEventType.js";import RenderEvent from"../render/Event.js";import RenderEventType from"../render/EventType.js";import SourceState from"../source/State.js";import{CLASS_UNSELECTABLE}from"../css.js";import{checkedFonts}from"../render/canvas.js";import{inView}from"../layer/Layer.js";import{listen,unlistenByKey}from"../events.js";import{replaceChildren}from"../dom.js";class CompositeMapRenderer extends MapRenderer{constructor(e){super(e),this.fontChangeListenerKey_=listen(checkedFonts,ObjectEventType.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=CLASS_UNSELECTABLE+" ol-layers";const r=e.getViewport();r.insertBefore(this.element_,r.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const r=this.getMap();if(r.hasListener(e)){const n=new RenderEvent(e,void 0,t);r.dispatchEvent(n)}}disposeInternal(){unlistenByKey(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(e),this.dispatchRenderEvent(RenderEventType.PRECOMPOSE,e);const t=e.layerStatesArray.sort((function(e,t){return e.zIndex-t.zIndex})),r=e.viewState;this.children_.length=0;const n=[];let s=null;for(let i=0,o=t.length;i<o;++i){const o=t[i];if(e.layerIndex=i,!inView(o,r)||o.sourceState!=SourceState.READY&&o.sourceState!=SourceState.UNDEFINED)continue;const l=o.layer,d=l.render(e,s);d&&(d!==s&&(this.children_.push(d),s=d),"getDeclutter"in l&&n.push(l))}for(let t=n.length-1;t>=0;--t)n[t].renderDeclutter(e);replaceChildren(this.element_,this.children_),this.dispatchRenderEvent(RenderEventType.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}forEachLayerAtPixel(e,t,r,n,s){const i=t.viewState,o=t.layerStatesArray;for(let l=o.length-1;l>=0;--l){const d=o[l],a=d.layer;if(a.hasRenderer()&&inView(d,i)&&s(a)){const s=a.getRenderer().getDataAtPixel(e,t,r);if(s){const e=n(a,s);if(e)return e}}}}}export default CompositeMapRenderer;
//# sourceMappingURL=/sm/8f633e463335b55f9905d98a0707ef0468f2e26111ea9cb63f6b2608a11bd8ea.map