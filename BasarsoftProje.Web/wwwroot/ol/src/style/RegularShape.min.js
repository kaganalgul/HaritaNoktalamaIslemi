/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/src/style/RegularShape.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import ImageState from"../ImageState.js";import ImageStyle from"./Image.js";import{asArray}from"../color.js";import{asColorLike}from"../colorlike.js";import{createCanvasContext2D}from"../dom.js";import{defaultFillStyle,defaultLineJoin,defaultLineWidth,defaultMiterLimit,defaultStrokeStyle}from"../render/canvas.js";class RegularShape extends ImageStyle{constructor(t){super({opacity:1,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0]}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=void 0!==t.fill?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=void 0!==t.radius?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=void 0!==t.angle?t.angle:0,this.stroke_=void 0!==t.stroke?t.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const t=this.getScale(),e=new RegularShape({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_;if(!t)return null;const e=this.getDisplacement();return[t[0]/2-e[0],t[1]/2+e[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(t){let e=this.canvas_[t];if(!e){const i=this.renderOptions_,s=createCanvasContext2D(i.size*t,i.size*t);this.draw_(i,s,t),e=s.canvas,this.canvas_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return ImageState.LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(0===e||this.points_===1/0||"bevel"!==t&&"miter"!==t)return e;let s=this.radius_,a=void 0===this.radius2_?s:this.radius2_;if(s<a){const t=s;s=a,a=t}const r=void 0===this.radius2_?this.points_:2*this.points_,n=2*Math.PI/r,o=a*Math.sin(n),l=s-Math.sqrt(a*a-o*o),h=Math.sqrt(o*o+l*l),d=h/o;if("miter"===t&&d<=i)return d*e;const c=e/2/d,u=e/2*(l/h),_=Math.sqrt((s+c)*(s+c)+u*u)-s;if(void 0===this.radius2_||"bevel"===t)return 2*_;const g=s*Math.sin(n),f=a-Math.sqrt(s*s-g*g),m=Math.sqrt(g*g+f*f)/g;if(m<=i){const t=m*e/2-a-s;return 2*Math.max(_,t)}return 2*_}createRenderOptions(){let t,e=defaultLineJoin,i=0,s=null,a=0,r=0;this.stroke_&&(t=this.stroke_.getColor(),null===t&&(t=defaultStrokeStyle),t=asColorLike(t),r=this.stroke_.getWidth(),void 0===r&&(r=defaultLineWidth),s=this.stroke_.getLineDash(),a=this.stroke_.getLineDashOffset(),e=this.stroke_.getLineJoin(),void 0===e&&(e=defaultLineJoin),i=this.stroke_.getMiterLimit(),void 0===i&&(i=defaultMiterLimit));const n=this.calculateLineJoinSize_(e,r,i),o=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:t,strokeWidth:r,size:Math.ceil(2*o+n),lineDash:s,lineDashOffset:a,lineJoin:e,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let t=this.fill_.getColor();null===t&&(t=defaultFillStyle),e.fillStyle=asColorLike(t),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,e.setLineDash&&t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){if(this.fill_){let e=this.fill_.getColor(),i=0;if("string"==typeof e&&(e=asArray(e)),null===e?i=1:Array.isArray(e)&&(i=4===e.length?e[3]:1),0===i){const e=createCanvasContext2D(t.size,t.size);this.hitDetectionCanvas_=e.canvas,this.drawHitDetectionCanvas_(t,e)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(t){let e=this.points_;const i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const s=void 0===this.radius2_?i:this.radius2_;void 0!==this.radius2_&&(e*=2);const a=this.angle_-Math.PI/2,r=2*Math.PI/e;for(let n=0;n<e;n++){const e=a+n*r,o=n%2==0?i:s;t.lineTo(o*Math.cos(e),o*Math.sin(e))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=defaultFillStyle,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}}export default RegularShape;
//# sourceMappingURL=/sm/7d424cbf0f222139459c6bbb56714095c571dbe92abcb5c63c689fbfd5423c69.map