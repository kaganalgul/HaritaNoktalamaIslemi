/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/src/style/IconImage.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import EventTarget from"../events/Target.js";import EventType from"../events/EventType.js";import ImageState from"../ImageState.js";import{asString}from"../color.js";import{createCanvasContext2D}from"../dom.js";import{shared as iconImageCache}from"./IconImageCache.js";import{listenImage}from"../Image.js";let taintedTestContext=null;class IconImage extends EventTarget{constructor(t,e,i,a,s,n){super(),this.hitDetectionImage_=null,this.image_=t||new Image,null!==a&&(this.image_.crossOrigin=a),this.canvas_={},this.color_=n,this.unlisten_=null,this.imageState_=s,this.size_=i,this.src_=e,this.tainted_}isTainted_(){if(void 0===this.tainted_&&this.imageState_===ImageState.LOADED){taintedTestContext||(taintedTestContext=createCanvasContext2D(1,1)),taintedTestContext.drawImage(this.image_,0,0);try{taintedTestContext.getImageData(0,0,1,1),this.tainted_=!1}catch(t){taintedTestContext=null,this.tainted_=!0}}return!0===this.tainted_}dispatchChangeEvent_(){this.dispatchEvent(EventType.CHANGE)}handleImageError_(){this.imageState_=ImageState.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=ImageState.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(t){return this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=createCanvasContext2D(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_==ImageState.IDLE){this.imageState_=ImageState.LOADING;try{this.image_.src=this.src_}catch(t){this.handleImageError_()}this.unlisten_=listenImage(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==ImageState.LOADED)return;const e=document.createElement("canvas");this.canvas_[t]=e,e.width=Math.ceil(this.image_.width*t),e.height=Math.ceil(this.image_.height*t);const i=e.getContext("2d");if(i.scale(t,t),i.drawImage(this.image_,0,0),i.globalCompositeOperation="multiply","multiply"===i.globalCompositeOperation||this.isTainted_())i.fillStyle=asString(this.color_),i.fillRect(0,0,e.width/t,e.height/t),i.globalCompositeOperation="destination-in",i.drawImage(this.image_,0,0);else{const t=i.getImageData(0,0,e.width,e.height),a=t.data,s=this.color_[0]/255,n=this.color_[1]/255,h=this.color_[2]/255,g=this.color_[3];for(let t=0,e=a.length;t<e;t+=4)a[t]*=s,a[t+1]*=n,a[t+2]*=h,a[t+3]*=g;i.putImageData(t,0,0)}}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}export function get(t,e,i,a,s,n){let h=iconImageCache.get(e,a,n);return h||(h=new IconImage(t,e,i,a,s,n),iconImageCache.set(e,a,n,h)),h}export default IconImage;
//# sourceMappingURL=/sm/094edc5ac7a0a312f7b3949cd98d3588c8b4adac9f91da99f220540e3cb475d9.map