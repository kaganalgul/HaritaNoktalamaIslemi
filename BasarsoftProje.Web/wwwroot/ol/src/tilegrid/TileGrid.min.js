/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/src/tilegrid/TileGrid.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import TileRange,{createOrUpdate as createOrUpdateTileRange}from"../TileRange.js";import{DEFAULT_TILE_SIZE}from"./common.js";import{assert}from"../asserts.js";import{ceil,clamp,floor}from"../math.js";import{createOrUpdate,getTopLeft}from"../extent.js";import{createOrUpdate as createOrUpdateTileCoord}from"../tilecoord.js";import{isSorted,linearFindNearest}from"../array.js";import{toSize}from"../size.js";const tmpTileCoord=[0,0,0],DECIMALS=5;class TileGrid{constructor(t){let e;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,assert(isSorted(this.resolutions_,(function(t,e){return e-t}),!0),17),!t.origins)for(let t=0,i=this.resolutions_.length-1;t<i;++t)if(e){if(this.resolutions_[t]/this.resolutions_[t+1]!==e){e=void 0;break}}else e=this.resolutions_[t]/this.resolutions_[t+1];this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,assert(this.origins_.length==this.resolutions_.length,20));const i=t.extent;void 0===i||this.origin_||this.origins_||(this.origin_=getTopLeft(i)),assert(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,assert(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:DEFAULT_TILE_SIZE,assert(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==i?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map((function(t,e){const o=new TileRange(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1));if(i){const t=this.getTileRangeForExtentAndZ(i,e);o.minX=Math.max(t.minX,o.minX),o.maxX=Math.min(t.maxX,o.maxX),o.minY=Math.max(t.minY,o.minY),o.maxY=Math.min(t.maxY,o.maxY)}return o}),this):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const o=this.getTileRangeForExtentAndZ(t,e);for(let t=o.minX,r=o.maxX;t<=r;++t)for(let r=o.minY,s=o.maxY;r<=s;++r)i([e,t,r])}forEachTileCoordParentTileRange(t,e,i,o){let r,s,n,l=null,h=t[0]-1;for(2===this.zoomFactor_?(s=t[1],n=t[2]):l=this.getTileCoordExtent(t,o);h>=this.minZoom;){if(2===this.zoomFactor_?(s=Math.floor(s/2),n=Math.floor(n/2),r=createOrUpdateTileRange(s,s,n,n,i)):r=this.getTileRangeForExtentAndZ(l,h,i),e(h,r))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){const i=2*t[1],o=2*t[2];return createOrUpdateTileRange(i,i+1,o,o+1,e)}const o=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const o=t[0],r=t[1],s=t[2];if(e===o)return createOrUpdateTileRange(r,s,r,s,i);if(this.zoomFactor_){const t=Math.pow(this.zoomFactor_,e-o),n=Math.floor(r*t),l=Math.floor(s*t);if(e<o)return createOrUpdateTileRange(n,n,l,l,i);const h=Math.floor(t*(r+1))-1,a=Math.floor(t*(s+1))-1;return createOrUpdateTileRange(n,h,l,a,i)}const n=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,e,i)}getTileRangeExtent(t,e,i){const o=this.getOrigin(t),r=this.getResolution(t),s=toSize(this.getTileSize(t),this.tmpSize_),n=o[0]+e.minX*s[0]*r,l=o[0]+(e.maxX+1)*s[0]*r,h=o[1]+e.minY*s[1]*r,a=o[1]+(e.maxY+1)*s[1]*r;return createOrUpdate(n,h,l,a,i)}getTileRangeForExtentAndZ(t,e,i){const o=tmpTileCoord;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,o);const r=o[1],s=o[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,o),createOrUpdateTileRange(r,o[1],s,o[2],i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),o=toSize(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*o[0]*i,e[1]-(t[2]+.5)*o[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),o=this.getResolution(t[0]),r=toSize(this.getTileSize(t[0]),this.tmpSize_),s=i[0]+t[1]*r[0]*o,n=i[1]-(t[2]+1)*r[1]*o,l=s+r[0]*o,h=n+r[1]*o;return createOrUpdate(s,n,l,h,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,o,r){const s=this.getZForResolution(i),n=i/this.getResolution(s),l=this.getOrigin(s),h=toSize(this.getTileSize(s),this.tmpSize_);let a=n*(t-l[0])/i/h[0],g=n*(l[1]-e)/i/h[1];return o?(a=ceil(a,5)-1,g=ceil(g,5)-1):(a=floor(a,5),g=floor(g,5)),createOrUpdateTileCoord(s,a,g,r)}getTileCoordForXYAndZ_(t,e,i,o,r){const s=this.getOrigin(i),n=this.getResolution(i),l=toSize(this.getTileSize(i),this.tmpSize_);let h=(t-s[0])/n/l[0],a=(s[1]-e)/n/l[1];return o?(h=ceil(h,5)-1,a=ceil(a,5)-1):(h=floor(h,5),a=floor(a,5)),createOrUpdateTileCoord(i,h,a,r)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const i=linearFindNearest(this.resolutions_,t,e||0);return clamp(i,this.minZoom,this.maxZoom)}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let o=this.minZoom;o<e;++o)i[o]=this.getTileRangeForExtentAndZ(t,o);this.fullTileRanges_=i}}export default TileGrid;
//# sourceMappingURL=/sm/84750a4ca83508bc464a44a2774e078acabaa9bd3201b37534dbe9fe67dad04b.map