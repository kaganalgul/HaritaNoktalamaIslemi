/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/src/interaction/Select.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import Collection from"../Collection.js";import CollectionEventType from"../CollectionEventType.js";import Event from"../events/Event.js";import GeometryType from"../geom/GeometryType.js";import Interaction from"./Interaction.js";import VectorLayer from"../layer/Vector.js";import{TRUE}from"../functions.js";import{clear}from"../obj.js";import{createEditingStyle}from"../style/Style.js";import{extend,includes}from"../array.js";import{getUid}from"../util.js";import{never,shiftKeyOnly,singleClick}from"../events/condition.js";const SelectEventType={SELECT:"select"};export class SelectEvent extends Event{constructor(e,t,i,r){super(e),this.selected=t,this.deselected=i,this.mapBrowserEvent=r}}const originalFeatureStyles={};class Select extends Interaction{constructor(e){super(),this.on,this.once,this.un;const t=e||{};let i;if(this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=t.condition?t.condition:singleClick,this.addCondition_=t.addCondition?t.addCondition:never,this.removeCondition_=t.removeCondition?t.removeCondition:never,this.toggleCondition_=t.toggleCondition?t.toggleCondition:shiftKeyOnly,this.multi_=!!t.multi&&t.multi,this.filter_=t.filter?t.filter:TRUE,this.hitTolerance_=t.hitTolerance?t.hitTolerance:0,this.style_=void 0!==t.style?t.style:getDefaultStyleFunction(),this.features_=t.features||new Collection,t.layers)if("function"==typeof t.layers)i=t.layers;else{const e=t.layers;i=function(t){return includes(e,t)}}else i=TRUE;this.layerFilter_=i,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[getUid(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[getUid(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(CollectionEventType.ADD,this.boundAddFeature_),this.features_.addEventListener(CollectionEventType.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(CollectionEventType.ADD,this.boundAddFeature_),this.features_.removeEventListener(CollectionEventType.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const e=this.getMap().getAllLayers().find((function(e){if(e instanceof VectorLayer&&e.getSource()&&e.getSource().hasFeature(t))return e}));e&&this.addFeatureLayerAssociation_(t,e)}}removeFeature_(e){const t=e.element;this.style_&&this.restorePreviousStyle_(t)}getStyle(){return this.style_}applySelectedStyle_(e){const t=getUid(e);t in originalFeatureStyles||(originalFeatureStyles[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let i=t.length-1;i>=0;--i){const r=t[i];if(r!==this&&r instanceof Select&&r.getStyle()&&-1!==r.getFeatures().getArray().lastIndexOf(e))return void e.setStyle(r.getStyle())}const i=getUid(e);e.setStyle(originalFeatureStyles[i]),delete originalFeatureStyles[i]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[getUid(e)]}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),i=this.removeCondition_(e),r=this.toggleCondition_(e),s=!t&&!i&&!r,o=e.map,n=this.getFeatures(),l=[],a=[];if(s){clear(this.featureLayerAssociation_),o.forEachFeatureAtPixel(e.pixel,function(e,t){if(this.filter_(e,t))return this.addFeatureLayerAssociation_(e,t),a.push(e),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let e=n.getLength()-1;e>=0;--e){const t=n.item(e),i=a.indexOf(t);i>-1?a.splice(i,1):(n.remove(t),l.push(t))}0!==a.length&&n.extend(a)}else{o.forEachFeatureAtPixel(e.pixel,function(e,s){if(this.filter_(e,s))return!t&&!r||includes(n.getArray(),e)?(i||r)&&includes(n.getArray(),e)&&(l.push(e),this.removeFeatureLayerAssociation_(e)):(this.addFeatureLayerAssociation_(e,s),a.push(e)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let e=l.length-1;e>=0;--e)n.remove(l[e]);n.extend(a)}return(a.length>0||l.length>0)&&this.dispatchEvent(new SelectEvent(SelectEventType.SELECT,a,l,e)),!0}}function getDefaultStyleFunction(){const e=createEditingStyle();return extend(e[GeometryType.POLYGON],e[GeometryType.LINE_STRING]),extend(e[GeometryType.GEOMETRY_COLLECTION],e[GeometryType.LINE_STRING]),function(t){return t.getGeometry()?e[t.getGeometry().getType()]:null}}export default Select;
//# sourceMappingURL=/sm/007a776b2a75c21e9bba7689d369bb186222e0bb8191052a48fb4a05cac0bf75.map