/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/src/interaction/DragAndDrop.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import Event from"../events/Event.js";import EventType from"../events/EventType.js";import FormatType from"../format/FormatType.js";import Interaction from"./Interaction.js";import{TRUE}from"../functions.js";import{get as getProjection}from"../proj.js";import{listen,unlistenByKey}from"../events.js";const DragAndDropEventType={ADD_FEATURES:"addfeatures"};export class DragAndDropEvent extends Event{constructor(t,e,s,r){super(t),this.features=s,this.file=e,this.projection=r}}class DragAndDrop extends Interaction{constructor(t){const e=t||{};super({handleEvent:TRUE}),this.on,this.once,this.un,this.readAsBuffer_=!1,this.formats_=[];const s=e.formatConstructors?e.formatConstructors:[];for(let t=0,e=s.length;t<e;++t){let e=s[t];"function"==typeof e&&(e=new e),this.formats_.push(e),this.readAsBuffer_=this.readAsBuffer_||e.getType()===FormatType.ARRAY_BUFFER}this.projection_=e.projection?getProjection(e.projection):null,this.dropListenKeys_=null,this.source_=e.source||null,this.target=e.target?e.target:null}handleResult_(t,e){const s=e.target.result,r=this.getMap();let n,i=this.projection_;if(!i){i=r.getView().getProjection()}const o=this.formats_;for(let e=0,r=o.length;e<r;++e){const r=o[e];let a=s;this.readAsBuffer_&&r.getType()!==FormatType.ARRAY_BUFFER&&(void 0===n&&(n=(new TextDecoder).decode(s)),a=n);const h=this.tryReadFeatures_(r,a,{featureProjection:i});if(h&&h.length>0){this.source_&&(this.source_.clear(),this.source_.addFeatures(h)),this.dispatchEvent(new DragAndDropEvent(DragAndDropEventType.ADD_FEATURES,t,h,i));break}}}registerListeners_(){const t=this.getMap();if(t){const e=this.target?this.target:t.getViewport();this.dropListenKeys_=[listen(e,EventType.DROP,this.handleDrop,this),listen(e,EventType.DRAGENTER,this.handleStop,this),listen(e,EventType.DRAGOVER,this.handleStop,this),listen(e,EventType.DROP,this.handleStop,this)]}}setActive(t){!this.getActive()&&t&&this.registerListeners_(),this.getActive()&&!t&&this.unregisterListeners_(),super.setActive(t)}setMap(t){this.unregisterListeners_(),super.setMap(t),this.getActive()&&this.registerListeners_()}tryReadFeatures_(t,e,s){try{return t.readFeatures(e,s)}catch(t){return null}}unregisterListeners_(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(unlistenByKey),this.dropListenKeys_=null)}handleDrop(t){const e=t.dataTransfer.files;for(let t=0,s=e.length;t<s;++t){const s=e.item(t),r=new FileReader;r.addEventListener(EventType.LOAD,this.handleResult_.bind(this,s)),this.readAsBuffer_?r.readAsArrayBuffer(s):r.readAsText(s)}}handleStop(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"}}export default DragAndDrop;
//# sourceMappingURL=/sm/d1b3ca87d5cb122aa4e1e67a91889f658c9a7a210c404c5065acadae70d2a6db.map