/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/src/source/TileImage.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import EventType from"../events/EventType.js";import ImageTile from"../ImageTile.js";import ReprojTile from"../reproj/Tile.js";import TileCache from"../TileCache.js";import TileState from"../TileState.js";import UrlTile from"./UrlTile.js";import{ENABLE_RASTER_REPROJECTION}from"../reproj/common.js";import{equivalent,get as getProjection}from"../proj.js";import{getKey,getKeyZXY}from"../tilecoord.js";import{getForProjection as getTileGridForProjection}from"../tilegrid.js";import{getUid}from"../util.js";class TileImage extends UrlTile{constructor(e){let t=void 0===e.imageSmoothing||e.imageSmoothing;void 0!==e.interpolate&&(t=e.interpolate),super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:defaultTileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:t,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=void 0!==e.crossOrigin?e.crossOrigin:null,this.tileClass=void 0!==e.tileClass?e.tileClass:ImageTile,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(!ENABLE_RASTER_REPROJECTION)return super.canExpireCache();if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){if(!ENABLE_RASTER_REPROJECTION)return void super.expireCache(e,t);const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const e in this.tileCacheForProjection){const r=this.tileCacheForProjection[e];r.expireCache(r==i?t:{})}}getGutterForProjection(e){return ENABLE_RASTER_REPROJECTION&&this.getProjection()&&e&&!equivalent(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return!(ENABLE_RASTER_REPROJECTION&&this.getProjection()&&e&&!equivalent(this.getProjection(),e))&&super.getOpaque(e)}getTileGridForProjection(e){if(!ENABLE_RASTER_REPROJECTION)return super.getTileGridForProjection(e);const t=this.getProjection();if(!this.tileGrid||t&&!equivalent(t,e)){const t=getUid(e);return t in this.tileGridForProjection||(this.tileGridForProjection[t]=getTileGridForProjection(e)),this.tileGridForProjection[t]}return this.tileGrid}getTileCacheForProjection(e){if(!ENABLE_RASTER_REPROJECTION)return super.getTileCacheForProjection(e);const t=this.getProjection();if(!t||equivalent(t,e))return this.tileCache;{const t=getUid(e);return t in this.tileCacheForProjection||(this.tileCacheForProjection[t]=new TileCache(this.tileCache.highWaterMark)),this.tileCacheForProjection[t]}}createTile_(e,t,i,r,o,n){const s=[e,t,i],l=this.getTileCoordForTileUrlFunction(s,o),c=l?this.tileUrlFunction(l,r,o):void 0,a=new this.tileClass(s,void 0!==c?TileState.IDLE:TileState.EMPTY,void 0!==c?c:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return a.key=n,a.addEventListener(EventType.CHANGE,this.handleTileChange.bind(this)),a}getTile(e,t,i,r,o){const n=this.getProjection();if(ENABLE_RASTER_REPROJECTION&&n&&o&&!equivalent(n,o)){const s=this.getTileCacheForProjection(o),l=[e,t,i];let c;const a=getKey(l);s.containsKey(a)&&(c=s.get(a));const h=this.getKey();if(c&&c.key==h)return c;{const e=this.getTileGridForProjection(n),t=this.getTileGridForProjection(o),i=this.getTileCoordForTileUrlFunction(l,o),T=new ReprojTile(n,e,o,t,l,i,this.getTilePixelRatio(r),this.getGutter(),function(e,t,i,r){return this.getTileInternal(e,t,i,r,n)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return T.key=h,c?(T.interimTile=c,T.refreshInterimChain(),s.replace(a,T)):s.set(a,T),T}}return this.getTileInternal(e,t,i,r,n||o)}getTileInternal(e,t,i,r,o){let n=null;const s=getKeyZXY(e,t,i),l=this.getKey();if(this.tileCache.containsKey(s)){if(n=this.tileCache.get(s),n.key!=l){const c=n;n=this.createTile_(e,t,i,r,o,l),c.getState()==TileState.IDLE?n.interimTile=c.interimTile:n.interimTile=c,n.refreshInterimChain(),this.tileCache.replace(s,n)}}else n=this.createTile_(e,t,i,r,o,l),this.tileCache.set(s,n);return n}setRenderReprojectionEdges(e){if(ENABLE_RASTER_REPROJECTION&&this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(e,t){if(ENABLE_RASTER_REPROJECTION){const i=getProjection(e);if(i){const e=getUid(i);e in this.tileGridForProjection||(this.tileGridForProjection[e]=t)}}}}function defaultTileLoadFunction(e,t){e.getImage().src=t}export default TileImage;
//# sourceMappingURL=/sm/d874c05fed0f79967cd213effe8ee7f8f33bc81b5e84c975419d2627872460d6.map