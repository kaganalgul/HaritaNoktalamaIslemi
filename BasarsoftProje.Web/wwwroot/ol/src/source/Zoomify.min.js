/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/src/source/Zoomify.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{DEFAULT_TILE_SIZE}from"../tilegrid/common.js";import ImageTile from"../ImageTile.js";import TileGrid from"../tilegrid/TileGrid.js";import TileImage from"./TileImage.js";import TileState from"../TileState.js";import{assert}from"../asserts.js";import{createCanvasContext2D}from"../dom.js";import{createFromTileUrlFunctions,expandUrl}from"../tileurlfunction.js";import{getCenter}from"../extent.js";import{toSize}from"../size.js";const TierSizeCalculation={DEFAULT:"default",TRUNCATED:"truncated"};export class CustomTile extends ImageTile{constructor(e,t,i,o,r,n,s){super(t,i,o,r,n,s),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==TileState.LOADED){const t=this.tileSize_;if(e.width==t[0]&&e.height==t[1])return this.zoomifyImage_=e,e;{const i=createCanvasContext2D(t[0],t[1]);return i.drawImage(e,0,0),this.zoomifyImage_=i.canvas,i.canvas}}return e}}class Zoomify extends TileImage{constructor(e){const t=e;let i=void 0===t.imageSmoothing||t.imageSmoothing;void 0!==t.interpolate&&(i=t.interpolate);const o=t.size,r=void 0!==t.tierSizeCalculation?t.tierSizeCalculation:TierSizeCalculation.DEFAULT,n=t.tilePixelRatio||1,s=o[0],l=o[1],a=[],c=t.tileSize||DEFAULT_TILE_SIZE;let m=c*n;switch(r){case TierSizeCalculation.DEFAULT:for(;s>m||l>m;)a.push([Math.ceil(s/m),Math.ceil(l/m)]),m+=m;break;case TierSizeCalculation.TRUNCATED:let e=s,t=l;for(;e>m||t>m;)a.push([Math.ceil(e/m),Math.ceil(t/m)]),e>>=1,t>>=1;break;default:assert(!1,53)}a.push([1,1]),a.reverse();const u=[n],T=[0];for(let e=1,t=a.length;e<t;e++)u.push(n<<e),T.push(a[e-1][0]*a[e-1][1]+T[e-1]);u.reverse();const p=new TileGrid({tileSize:c,extent:t.extent||[0,-l,s,0],resolutions:u});let g=t.url;g&&-1==g.indexOf("{TileGroup}")&&-1==g.indexOf("{tileIndex}")&&(g+="{TileGroup}/{z}-{x}-{y}.jpg");const h=expandUrl(g);let d=c*n;const f=createFromTileUrlFunctions(h.map((function(e){return function(t,i,o){if(t){const i=t[0],o=t[1],r=t[2],n=o+r*a[i][0],s={z:i,x:o,y:r,tileIndex:n,TileGroup:"TileGroup"+((n+T[i])/d|0)};return e.replace(/\{(\w+?)\}/g,(function(e,t){return s[t]}))}}}))),z=CustomTile.bind(null,toSize(c*n));super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:i,projection:t.projection,tilePixelRatio:n,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:z,tileGrid:p,tileUrlFunction:f,transition:t.transition}),this.zDirection=t.zDirection;const I=f(p.getTileCoordForCoordAndResolution(getCenter(p.getExtent()),u[u.length-1]),1,null),S=new Image;S.addEventListener("error",function(){d=c,this.changed()}.bind(this)),S.src=I}}export default Zoomify;
//# sourceMappingURL=/sm/bd4c3130fea105380d5668e34da770fe556f568824fc4218d78a5369b9ad40ed.map