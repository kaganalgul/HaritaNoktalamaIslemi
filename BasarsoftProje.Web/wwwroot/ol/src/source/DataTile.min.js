/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/src/source/DataTile.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import DataTile from"../DataTile.js";import EventType from"../events/EventType.js";import TileEventType from"./TileEventType.js";import TileSource,{TileSourceEvent}from"./Tile.js";import TileState from"../TileState.js";import{assign}from"../obj.js";import{createXYZ,extentFromProjection}from"../tilegrid.js";import{getKeyZXY}from"../tilecoord.js";import{getUid}from"../util.js";import{toPromise}from"../functions.js";class DataTileSource extends TileSource{constructor(e){const t=void 0===e.projection?"EPSG:3857":e.projection;let i=e.tileGrid;void 0===i&&t&&(i=createXYZ({extent:extentFromProjection(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:i,opaque:e.opaque,state:e.state,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate}),this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=void 0===e.bandCount?4:e.bandCount}setLoader(e){this.loader_=e}getTile(e,t,i,o,n){const a=getKeyZXY(e,t,i);if(this.tileCache.containsKey(a))return this.tileCache.get(a);const r=this.loader_;const l=new DataTile(assign({tileCoord:[e,t,i],loader:function(){return toPromise((function(){return r(e,t,i)}))}},this.tileOptions));return l.key=this.getKey(),l.addEventListener(EventType.CHANGE,this.handleTileChange_),this.tileCache.set(a,l),l}handleTileChange_(e){const t=e.target,i=getUid(t),o=t.getState();let n;o==TileState.LOADING?(this.tileLoadingKeys_[i]=!0,n=TileEventType.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],n=o==TileState.ERROR?TileEventType.TILELOADERROR:o==TileState.LOADED?TileEventType.TILELOADEND:void 0),n&&this.dispatchEvent(new TileSourceEvent(n,t))}}export default DataTileSource;
//# sourceMappingURL=/sm/ee72e48a82bee0bc46551e21e33028be25589cccee5029ee45a4dddba2427548.map