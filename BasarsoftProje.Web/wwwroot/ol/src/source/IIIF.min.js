/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/src/source/IIIF.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import TileGrid from"../tilegrid/TileGrid.js";import TileImage from"./TileImage.js";import{CustomTile}from"./Zoomify.js";import{DEFAULT_TILE_SIZE}from"../tilegrid/common.js";import{Versions}from"../format/IIIFInfo.js";import{assert}from"../asserts.js";import{getTopLeft}from"../extent.js";import{includes}from"../array.js";import{toSize}from"../size.js";function formatPercentage(e){return e.toLocaleString("en",{maximumFractionDigits:10})}class IIIF extends TileImage{constructor(e){const t=e||{};let i=void 0===t.imageSmoothing||t.imageSmoothing;void 0!==t.interpolate&&(i=t.interpolate);let r=t.url||"";r+=r.lastIndexOf("/")===r.length-1||""===r?"":"/";const o=t.version||Versions.VERSION2,s=t.sizes||[],n=t.size;assert(null!=n&&Array.isArray(n)&&2==n.length&&!isNaN(n[0])&&n[0]>0&&!isNaN(n[1])&&n[1]>0,60);const l=n[0],a=n[1],c=t.tileSize,u=t.tilePixelRatio||1,m=t.format||"jpg",f=t.quality||(t.version==Versions.VERSION1?"native":"default");let g=t.resolutions||[];const h=t.supports||[],p=t.extent||[0,-a,l,0],d=null!=s&&Array.isArray(s)&&s.length>0,I=void 0!==c&&("number"==typeof c&&Number.isInteger(c)&&c>0||Array.isArray(c)&&c.length>0),y=null!=h&&Array.isArray(h)&&(includes(h,"regionByPx")||includes(h,"regionByPct"))&&(includes(h,"sizeByWh")||includes(h,"sizeByH")||includes(h,"sizeByW")||includes(h,"sizeByPct"));let z,N,T;if(g.sort((function(e,t){return t-e})),I||y)if(null!=c&&("number"==typeof c&&Number.isInteger(c)&&c>0?(z=c,N=c):Array.isArray(c)&&c.length>0&&((1==c.length||null==c[1]&&Number.isInteger(c[0]))&&(z=c[0],N=c[0]),2==c.length&&(Number.isInteger(c[0])&&Number.isInteger(c[1])?(z=c[0],N=c[1]):null==c[0]&&Number.isInteger(c[1])&&(z=c[1],N=c[1])))),void 0!==z&&void 0!==N||(z=DEFAULT_TILE_SIZE,N=DEFAULT_TILE_SIZE),0==g.length){T=Math.max(Math.ceil(Math.log(l/z)/Math.LN2),Math.ceil(Math.log(a/N)/Math.LN2));for(let e=T;e>=0;e--)g.push(Math.pow(2,e))}else{const e=Math.max(...g);T=Math.round(Math.log(e)/Math.LN2)}else if(z=l,N=a,g=[],d){s.sort((function(e,t){return e[0]-t[0]})),T=-1;const e=[];for(let t=0;t<s.length;t++){const i=l/s[t][0];g.length>0&&g[g.length-1]==i?e.push(t):(g.push(i),T++)}if(e.length>0)for(let t=0;t<e.length;t++)s.splice(e[t]-t,1)}else g.push(1),s.push([l,a]),T=0;const S=new TileGrid({tileSize:[z,N],extent:p,origin:getTopLeft(p),resolutions:g}),x=CustomTile.bind(null,toSize(c||256).map((function(e){return e*u})));super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:i,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:t.state,tileClass:x,tileGrid:S,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:function(e,t,i){let n,c;const u=e[0];if(u>T)return;const p=e[1],S=e[2],x=g[u];if(!(void 0===p||void 0===S||void 0===x||p<0||Math.ceil(l/x/z)<=p||S<0||Math.ceil(a/x/N)<=S)){if(y||I){const e=p*z*x,t=S*N*x;let i=z*x,r=N*x,s=z,u=N;if(e+i>l&&(i=l-e),t+r>a&&(r=a-t),e+z*x>l&&(s=Math.floor((l-e+x-1)/x)),t+N*x>a&&(u=Math.floor((a-t+x-1)/x)),0==e&&i==l&&0==t&&r==a)n="full";else if(!y||includes(h,"regionByPx"))n=e+","+t+","+i+","+r;else if(includes(h,"regionByPct")){n="pct:"+formatPercentage(e/l*100)+","+formatPercentage(t/a*100)+","+formatPercentage(i/l*100)+","+formatPercentage(r/a*100)}o!=Versions.VERSION3||y&&!includes(h,"sizeByWh")?!y||includes(h,"sizeByW")?c=s+",":includes(h,"sizeByH")?c=","+u:includes(h,"sizeByWh")?c=s+","+u:includes(h,"sizeByPct")&&(c="pct:"+formatPercentage(100/x)):c=s+","+u}else if(n="full",d){const e=s[u][0],t=s[u][1];c=o==Versions.VERSION3?e==l&&t==a?"max":e+","+t:e==l?"full":e+","}else c=o==Versions.VERSION3?"max":"full";return r+n+"/"+c+"/0/"+f+"."+m}},transition:t.transition}),this.zDirection=t.zDirection}}export default IIIF;
//# sourceMappingURL=/sm/4326a80cd6cc3ff5c42db9a2e7106e39a6b0477e910218d1a6f02e4b71a57f28.map