/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/src/source/TileArcGISRest.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import TileImage from"./TileImage.js";import{appendParams}from"../uri.js";import{assign}from"../obj.js";import{createEmpty}from"../extent.js";import{modulo}from"../math.js";import{scale as scaleSize,toSize}from"../size.js";import{hash as tileCoordHash}from"../tilecoord.js";class TileArcGISRest extends TileImage{constructor(t){const e=t||{};let i=void 0===e.imageSmoothing||e.imageSmoothing;void 0!==e.interpolate&&(i=e.interpolate),super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:i,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.params_=e.params||{},this.hidpi_=void 0===e.hidpi||e.hidpi,this.tmpExtent_=createEmpty(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let t=0;const e=[];for(const i in this.params_)e[t++]=i+"-"+this.params_[i];return e.join("/")}getParams(){return this.params_}getRequestUrl_(t,e,i,r,o,s){const a=this.urls;if(!a)return;const n=o.getCode().split(/:(?=\d+$)/).pop();let l;if(s.SIZE=e[0]+","+e[1],s.BBOX=i.join(","),s.BBOXSR=n,s.IMAGESR=n,s.DPI=Math.round(s.DPI?s.DPI*r:90*r),1==a.length)l=a[0];else{l=a[modulo(tileCoordHash(t),a.length)]}const p=l.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return appendParams(p,s)}getTilePixelRatio(t){return this.hidpi_?t:1}updateParams(t){assign(this.params_,t),this.setKey(this.getKeyForParams_())}tileUrlFunction(t,e,i){let r=this.getTileGrid();if(r||(r=this.getTileGridForProjection(i)),r.getResolutions().length<=t[0])return;1==e||this.hidpi_||(e=1);const o=r.getTileCoordExtent(t,this.tmpExtent_);let s=toSize(r.getTileSize(t[0]),this.tmpSize);1!=e&&(s=scaleSize(s,e,this.tmpSize));const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return assign(a,this.params_),this.getRequestUrl_(t,s,o,e,i,a)}}export default TileArcGISRest;
//# sourceMappingURL=/sm/b659089ea71ba332c5700f60e5d03ce79377ddfb8e9d67b23dff9e300fceb93a.map