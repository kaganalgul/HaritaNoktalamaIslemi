/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/src/source/BingMaps.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import SourceState from"./State.js";import TileImage from"./TileImage.js";import{applyTransform,intersects}from"../extent.js";import{createFromTileUrlFunctions}from"../tileurlfunction.js";import{createOrUpdate}from"../tilecoord.js";import{createXYZ,extentFromProjection}from"../tilegrid.js";import{get as getProjection,getTransformFromProjections}from"../proj.js";import{jsonp as requestJSONP}from"../net.js";export function quadKey(e){const t=e[0],i=new Array(t);let o,r,s=1<<t-1;for(o=0;o<t;++o)r=48,e[1]&s&&(r+=1),e[2]&s&&(r+=2),i[o]=String.fromCharCode(r),s>>=1;return i.join("")}const TOS_ATTRIBUTION='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class BingMaps extends TileImage{constructor(e){const t=void 0!==e.hidpi&&e.hidpi;let i=void 0===e.imageSmoothing||e.imageSmoothing;void 0!==e.interpolate&&(i=e.interpolate),super({cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:i,opaque:!0,projection:getProjection("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:SourceState.LOADING,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.hidpi_=t,this.culture_=void 0!==e.culture?e.culture:"en-us",this.maxZoom_=void 0!==e.maxZoom?e.maxZoom:-1,this.apiKey_=e.key,this.imagerySet_=e.imagerySet;const o="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;requestJSONP(o,this.handleImageryMetadataResponse.bind(this),void 0,"jsonp")}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(e){if(200!=e.statusCode||"OK"!=e.statusDescription||"ValidCredentials"!=e.authenticationResultCode||1!=e.resourceSets.length||1!=e.resourceSets[0].resources.length)return void this.setState(SourceState.ERROR);const t=e.resourceSets[0].resources[0],i=-1==this.maxZoom_?t.zoomMax:this.maxZoom_,o=this.getProjection(),r=extentFromProjection(o),s=this.hidpi_?2:1,a=t.imageWidth==t.imageHeight?t.imageWidth/s:[t.imageWidth/s,t.imageHeight/s],n=createXYZ({extent:r,minZoom:t.zoomMin,maxZoom:i,tileSize:a});this.tileGrid=n;const c=this.culture_,m=this.hidpi_;if(this.tileUrlFunction=createFromTileUrlFunctions(t.imageUrlSubdomains.map((function(e){const i=[0,0,0],o=t.imageUrl.replace("{subdomain}",e).replace("{culture}",c);return function(e,t,r){if(e){createOrUpdate(e[0],e[1],e[2],i);let t=o;return m&&(t+="&dpi=d1&device=mobile"),t.replace("{quadkey}",quadKey(i))}}}))),t.imageryProviders){const e=getTransformFromProjections(getProjection("EPSG:4326"),this.getProjection());this.setAttributions(function(i){const o=[],r=i.viewState,s=this.getTileGrid(),a=s.getZForResolution(r.resolution,this.zDirection),n=s.getTileCoordForCoordAndZ(r.center,a)[0];return t.imageryProviders.map((function(t){let r=!1;const s=t.coverageAreas;for(let t=0,o=s.length;t<o;++t){const o=s[t];if(n>=o.zoomMin&&n<=o.zoomMax){const t=o.bbox,s=[t[1],t[0],t[3],t[2]],a=applyTransform(s,e);if(intersects(a,i.extent)){r=!0;break}}}r&&o.push(t.attribution)})),o.push(TOS_ATTRIBUTION),o}.bind(this))}this.setState(SourceState.READY)}}export default BingMaps;
//# sourceMappingURL=/sm/ec1965f350b309374d1afc10bdffc66d4e19661a6c0e40f5d64a381ffa7bae48.map