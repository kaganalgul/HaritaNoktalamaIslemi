/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/src/source/WMTS.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import TileImage from"./TileImage.js";import WMTSRequestEncoding from"./WMTSRequestEncoding.js";import{appendParams}from"../uri.js";import{assign}from"../obj.js";import{containsExtent}from"../extent.js";import{createFromCapabilitiesMatrixSet}from"../tilegrid/WMTS.js";import{createFromTileUrlFunctions,expandUrl}from"../tileurlfunction.js";import{equivalent,get as getProjection,transformExtent}from"../proj.js";import{find,findIndex,includes}from"../array.js";class WMTS extends TileImage{constructor(e){let t=void 0===e.imageSmoothing||e.imageSmoothing;void 0!==e.interpolate&&(t=e.interpolate);const i=void 0!==e.requestEncoding?e.requestEncoding:WMTSRequestEncoding.KVP,n=e.tileGrid;let r=e.urls;void 0===r&&void 0!==e.url&&(r=expandUrl(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:t,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:n,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:r,wrapX:void 0!==e.wrapX&&e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.version_=void 0!==e.version?e.version:"1.0.0",this.format_=void 0!==e.format?e.format:"image/jpeg",this.dimensions_=void 0!==e.dimensions?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=i,this.setKey(this.getKeyForDimensions_()),r&&r.length>0&&(this.tileUrlFunction=createFromTileUrlFunctions(r.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const t=e.join("\n");this.setTileUrlFunction(createFromTileUrlFunctions(e.map(this.createFromWMTSTemplate.bind(this))),t)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){let e=0;const t=[];for(const i in this.dimensions_)t[e++]=i+"-"+this.dimensions_[i];return t.join("/")}updateDimensions(e){assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const t=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t==WMTSRequestEncoding.KVP&&assign(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t==WMTSRequestEncoding.KVP?appendParams(e,i):e.replace(/\{(\w+?)\}/g,(function(e,t){return t.toLowerCase()in i?i[t.toLowerCase()]:e}));const n=this.tileGrid,r=this.dimensions_;return function(i,o,s){if(i){const o={TileMatrix:n.getMatrixId(i[0]),TileCol:i[1],TileRow:i[2]};assign(o,r);let s=e;return s=t==WMTSRequestEncoding.KVP?appendParams(s,o):s.replace(/\{(\w+?)\}/g,(function(e,t){return o[t]})),s}}}}export default WMTS;export function optionsFromCapabilities(e,t){const i=e.Contents.Layer,n=find(i,(function(e,i,n){return e.Identifier==t.layer}));if(null===n)return null;const r=e.Contents.TileMatrixSet;let o;o=n.TileMatrixSetLink.length>1?findIndex(n.TileMatrixSetLink,"projection"in t?function(e,i,n){const o=find(r,(function(t){return t.Identifier==e.TileMatrixSet})).SupportedCRS,s=getProjection(o),a=getProjection(t.projection);return s&&a?equivalent(s,a):o==t.projection}:function(e,i,n){return e.TileMatrixSet==t.matrixSet}):0,o<0&&(o=0);const s=n.TileMatrixSetLink[o].TileMatrixSet,a=n.TileMatrixSetLink[o].TileMatrixSetLimits;let l=n.Format[0];"format"in t&&(l=t.format),o=findIndex(n.Style,(function(e,i,n){return"style"in t?e.Title==t.style:e.isDefault})),o<0&&(o=0);const c=n.Style[o].Identifier,u={};"Dimension"in n&&n.Dimension.forEach((function(e,t,i){const n=e.Identifier;let r=e.Default;void 0===r&&(r=e.Value[0]),u[n]=r}));const d=e.Contents.TileMatrixSet,m=find(d,(function(e,t,i){return e.Identifier==s}));let f;const p=m.SupportedCRS;if(p&&(f=getProjection(p)),"projection"in t){const e=getProjection(t.projection);e&&(f&&!equivalent(e,f)||(f=e))}let g=!1;const T="ne"==f.getAxisOrientation().substr(0,2);let h=m.TileMatrix[0],S={MinTileCol:0,MinTileRow:0,MaxTileCol:h.MatrixWidth-1,MaxTileRow:h.MatrixHeight-1};if(a){S=a[a.length-1];const e=find(m.TileMatrix,(e=>e.Identifier===S.TileMatrix||m.Identifier+":"+e.Identifier===S.TileMatrix));e&&(h=e)}const x=28e-5*h.ScaleDenominator/f.getMetersPerUnit(),M=T?[h.TopLeftCorner[1],h.TopLeftCorner[0]]:h.TopLeftCorner,E=h.TileWidth*x,j=h.TileHeight*x,y=m.BoundingBox;let _=[M[0]+E*S.MinTileCol,M[1]-j*(1+S.MaxTileRow),M[0]+E*(1+S.MaxTileCol),M[1]-j*S.MinTileRow];if(void 0!==y&&!containsExtent(y,_)){const e=n.WGS84BoundingBox,t=getProjection("EPSG:4326").getExtent();if(_=y,e)g=e[0]===t[0]&&e[2]===t[2];else{const e=transformExtent(y,m.SupportedCRS,"EPSG:4326");g=e[0]-1e-10<=t[0]&&e[2]+1e-10>=t[2]}}const C=createFromCapabilitiesMatrixSet(m,_,a),R=[];let P=t.requestEncoding;if(P=void 0!==P?P:"","OperationsMetadata"in e&&"GetTile"in e.OperationsMetadata){const t=e.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let e=0,i=t.length;e<i;++e)if(t[e].Constraint){const i=find(t[e].Constraint,(function(e){return"GetEncoding"==e.name})).AllowedValues.Value;if(""===P&&(P=i[0]),P!==WMTSRequestEncoding.KVP)break;includes(i,WMTSRequestEncoding.KVP)&&R.push(t[e].href)}else t[e].href&&(P=WMTSRequestEncoding.KVP,R.push(t[e].href))}return 0===R.length&&(P=WMTSRequestEncoding.REST,n.ResourceURL.forEach((function(e){"tile"===e.resourceType&&(l=e.format,R.push(e.template))}))),{urls:R,layer:t.layer,matrixSet:s,format:l,projection:f,requestEncoding:P,tileGrid:C,style:c,dimensions:u,wrapX:g,crossOrigin:t.crossOrigin}}
//# sourceMappingURL=/sm/94c35c0ebe2ac2141fb93c93d2eeeb612aa86894238d9db68e389a45f46bdcb5.map