/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/src/reproj.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{IMAGE_SMOOTHING_DISABLED}from"./renderer/canvas/common.js";import{assign}from"./obj.js";import{containsCoordinate,createEmpty,extend,forEachCorner,getCenter,getHeight,getTopLeft,getWidth}from"./extent.js";import{createCanvasContext2D}from"./dom.js";import{getPointResolution,transform}from"./proj.js";import{solveLinearSystem}from"./math.js";let brokenDiagonalRendering_;function drawTestTriangle(e,t,n,o,r){e.beginPath(),e.moveTo(0,0),e.lineTo(t,n),e.lineTo(o,r),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,o)+1,Math.max(n,r)),e.restore()}function verifyBrokenDiagonalRendering(e,t){return Math.abs(e[4*t]-210)>2||Math.abs(e[4*t+3]-191.25)>2}function isBrokenDiagonalRendering(){if(void 0===brokenDiagonalRendering_){const e=document.createElement("canvas").getContext("2d");e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",drawTestTriangle(e,4,5,4,0),drawTestTriangle(e,4,5,0,5);const t=e.getImageData(0,0,3,3).data;brokenDiagonalRendering_=verifyBrokenDiagonalRendering(t,0)||verifyBrokenDiagonalRendering(t,4)||verifyBrokenDiagonalRendering(t,8)}return brokenDiagonalRendering_}export function calculateSourceResolution(e,t,n,o){const r=transform(n,t,e);let i=getPointResolution(t,o,n);const a=t.getMetersPerUnit();void 0!==a&&(i*=a);const s=e.getMetersPerUnit();void 0!==s&&(i/=s);const c=e.getExtent();if(!c||containsCoordinate(c,r)){const t=getPointResolution(e,i,r)/i;isFinite(t)&&t>0&&(i/=t)}return i}export function calculateSourceExtentResolution(e,t,n,o){const r=getCenter(n);let i=calculateSourceResolution(e,t,r,o);return(!isFinite(i)||i<=0)&&forEachCorner(n,(function(n){return i=calculateSourceResolution(e,t,n,o),isFinite(i)&&i>0})),i}export function render(e,t,n,o,r,i,a,s,c,g,l,u){const m=createCanvasContext2D(Math.round(n*e),Math.round(n*t));if(u||assign(m,IMAGE_SMOOTHING_DISABLED),0===c.length)return m.canvas;function f(e){return Math.round(e*n)/n}m.scale(n,n),m.globalCompositeOperation="lighter";const d=createEmpty();c.forEach((function(e,t,n){extend(d,e.extent)}));const h=getWidth(d),T=getHeight(d),v=createCanvasContext2D(Math.round(n*h/o),Math.round(n*T/o));u||assign(v,IMAGE_SMOOTHING_DISABLED);const p=n/o;c.forEach((function(e,t,n){const o=e.extent[0]-d[0],r=-(e.extent[3]-d[3]),i=getWidth(e.extent),a=getHeight(e.extent);e.image.width>0&&e.image.height>0&&v.drawImage(e.image,g,g,e.image.width-2*g,e.image.height-2*g,o*p,r*p,i*p,a*p)}));const D=getTopLeft(a);return s.getTriangles().forEach((function(e,t,r){const a=e.source,s=e.target;let c=a[0][0],g=a[0][1],l=a[1][0],h=a[1][1],T=a[2][0],p=a[2][1];const x=f((s[0][0]-D[0])/i),R=f(-(s[0][1]-D[1])/i),E=f((s[1][0]-D[0])/i),M=f(-(s[1][1]-D[1])/i),C=f((s[2][0]-D[0])/i),b=f(-(s[2][1]-D[1])/i),S=c,k=g;c=0,g=0,l-=S,h-=k,T-=S,p-=k;const I=solveLinearSystem([[l,h,0,0,E-x],[T,p,0,0,C-x],[0,0,l,h,M-R],[0,0,T,p,b-R]]);if(I){if(m.save(),m.beginPath(),isBrokenDiagonalRendering()||!u){m.moveTo(E,M);const e=4,t=x-E,n=R-M;for(let o=0;o<e;o++)m.lineTo(E+f((o+1)*t/e),M+f(o*n/(e-1))),o!=e-1&&m.lineTo(E+f((o+1)*t/e),M+f((o+1)*n/(e-1)));m.lineTo(C,b)}else m.moveTo(E,M),m.lineTo(x,R),m.lineTo(C,b);m.clip(),m.transform(I[0],I[2],I[1],I[3],x,R),m.translate(d[0]-S,d[3]-k),m.scale(o/n,-o/n),m.drawImage(v.canvas,0,0),m.restore()}})),l&&(m.save(),m.globalCompositeOperation="source-over",m.strokeStyle="black",m.lineWidth=1,s.getTriangles().forEach((function(e,t,n){const o=e.target,r=(o[0][0]-D[0])/i,a=-(o[0][1]-D[1])/i,s=(o[1][0]-D[0])/i,c=-(o[1][1]-D[1])/i,g=(o[2][0]-D[0])/i,l=-(o[2][1]-D[1])/i;m.beginPath(),m.moveTo(s,c),m.lineTo(r,a),m.lineTo(g,l),m.closePath(),m.stroke()})),m.restore()),m.canvas}
//# sourceMappingURL=/sm/01eb7f030a10ee4d8a1807128aeac7c4e0c4ea560ee8e8b11283f4232415ed18.map