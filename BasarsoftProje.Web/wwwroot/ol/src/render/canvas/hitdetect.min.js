/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/src/render/canvas/hitdetect.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import CanvasImmediateRenderer from"./Immediate.js";import GeometryType from"../../geom/GeometryType.js";import IconAnchorUnits from"../../style/IconAnchorUnits.js";import{Icon}from"../../style.js";import{clamp}from"../../math.js";import{createCanvasContext2D}from"../../dom.js";import{intersects}from"../../extent.js";import{numberSafeCompareFunction}from"../../array.js";export const HIT_DETECT_RESOLUTION=.5;export function createHitDetectionImageData(t,e,o,n,r,a,i){const c=.5*t[0],s=.5*t[1],m=createCanvasContext2D(c,s);m.imageSmoothingEnabled=!1;const l=m.canvas,h=new CanvasImmediateRenderer(m,.5,r,null,i),g=o.length,f=Math.floor(16777215/g),p={};for(let t=1;t<=g;++t){const e=o[t-1],i=e.getStyleFunction()||n;if(!n)continue;let c=i(e,a);if(!c)continue;Array.isArray(c)||(c=[c]);const s="#"+("000000"+(t*f).toString(16)).slice(-6);for(let t=0,o=c.length;t<o;++t){const o=c[t],n=o.getGeometryFunction()(e);if(!n||!intersects(r,n.getExtent()))continue;const a=o.clone(),i=a.getFill();i&&i.setColor(s);const m=a.getStroke();m&&(m.setColor(s),m.setLineDash(null)),a.setText(void 0);const l=o.getImage();if(l&&0!==l.getOpacity()){const t=l.getImageSize();if(!t)continue;const e=createCanvasContext2D(t[0],t[1],void 0,{alpha:!1}),o=e.canvas;e.fillStyle=s,e.fillRect(0,0,o.width,o.height),a.setImage(new Icon({img:o,imgSize:t,anchor:l.getAnchor(),anchorXUnits:IconAnchorUnits.PIXELS,anchorYUnits:IconAnchorUnits.PIXELS,offset:l.getOrigin(),opacity:1,size:l.getSize(),scale:l.getScale(),rotation:l.getRotation(),rotateWithView:l.getRotateWithView()}))}const h=a.getZIndex()||0;let g=p[h];g||(g={},p[h]=g,g[GeometryType.POLYGON]=[],g[GeometryType.CIRCLE]=[],g[GeometryType.LINE_STRING]=[],g[GeometryType.POINT]=[]),g[n.getType().replace("Multi","")].push(n,a)}}const y=Object.keys(p).map(Number).sort(numberSafeCompareFunction);for(let t=0,o=y.length;t<o;++t){const o=p[y[t]];for(const t in o){const n=o[t];for(let t=0,o=n.length;t<o;t+=2){h.setStyle(n[t+1]);for(let o=0,r=e.length;o<r;++o)h.setTransform(e[o]),h.drawGeometry(n[t])}}}return m.getImageData(0,0,l.width,l.height)}export function hitDetect(t,e,o){const n=[];if(o){const r=Math.floor(.5*Math.round(t[0])),a=Math.floor(.5*Math.round(t[1])),i=4*(clamp(r,0,o.width-1)+clamp(a,0,o.height-1)*o.width),c=o.data[i],s=o.data[i+1],m=o.data[i+2]+256*(s+256*c),l=Math.floor(16777215/e.length);m&&m%l==0&&n.push(e[m/l-1])}return n}
//# sourceMappingURL=/sm/a8db24d1d8bbefd73b8f2a9a76d2da8d06f87e1c3a9589d61f1de9098b70069d.map