/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/renderer/canvas/VectorLayer.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();import CanvasBuilderGroup from"../../render/canvas/BuilderGroup.js";import CanvasLayerRenderer from"./Layer.js";import ExecutorGroup from"../../render/canvas/ExecutorGroup.js";import ViewHint from"../../ViewHint.js";import{HIT_DETECT_RESOLUTION,createHitDetectionImageData,hitDetect}from"../../render/canvas/hitdetect.js";import{apply,makeInverse,makeScale,toString as transformToString}from"../../transform.js";import{buffer,containsExtent,createEmpty,getWidth,intersects as intersectsExtent,wrapX as wrapExtentX}from"../../extent.js";import{cssOpacity}from"../../css.js";import{defaultOrder as defaultRenderOrder,getTolerance as getRenderTolerance,getSquaredTolerance as getSquaredRenderTolerance,renderFeature}from"../vector.js";import{equals}from"../../array.js";import{fromUserExtent,getTransformFromProjections,getUserProjection,toUserExtent,toUserResolution}from"../../proj.js";import{getUid}from"../../util.js";import{wrapX as wrapCoordinateX}from"../../coordinate.js";var CanvasVectorLayerRenderer=function(e){function t(t){var r=e.call(this,t)||this;return r.boundHandleStyleImageChange_=r.handleStyleImageChange_.bind(r),r.animatingOrInteracting_,r.dirty_=!1,r.hitDetectionImageData_=null,r.renderedFeatures_=null,r.renderedRevision_=-1,r.renderedResolution_=NaN,r.renderedExtent_=createEmpty(),r.wrappedRenderedExtent_=createEmpty(),r.renderedRotation_,r.renderedCenter_=null,r.renderedProjection_=null,r.renderedRenderOrder_=null,r.replayGroup_=null,r.replayGroupChanged=!0,r.declutterExecutorGroup=null,r.clipping=!0,r}return __extends(t,e),t.prototype.renderWorlds=function(e,t,r){var n=t.extent,i=t.viewState,a=i.center,o=i.resolution,s=i.projection,d=i.rotation,u=s.getExtent(),c=this.getLayer().getSource(),l=t.pixelRatio,h=t.viewHints,p=!(h[ViewHint.ANIMATING]||h[ViewHint.INTERACTING]),f=this.context,g=Math.round(t.size[0]*l),_=Math.round(t.size[1]*l),m=c.getWrapX()&&s.canWrapX(),y=m?getWidth(u):null,v=m?Math.ceil((n[2]-u[2])/y)+1:1,x=m?Math.floor((n[0]-u[0])/y):0;do{var E=this.getRenderTransform(a,o,d,l,g,_,x*y);e.execute(f,1,E,d,p,void 0,r)}while(++x<v)},t.prototype.renderDeclutter=function(e){this.declutterExecutorGroup&&this.renderWorlds(this.declutterExecutorGroup,e,e.declutterTree)},t.prototype.renderFrame=function(e,t){var r=e.pixelRatio,n=e.layerStatesArray[e.layerIndex];makeScale(this.pixelTransform,1/r,1/r),makeInverse(this.inversePixelTransform,this.pixelTransform);var i=transformToString(this.pixelTransform);this.useContainer(t,i,n.opacity,this.getBackground(e));var a=this.context,o=a.canvas,s=this.replayGroup_,d=this.declutterExecutorGroup;if((!s||s.isEmpty())&&(!d||d.isEmpty()))return null;var u=Math.round(e.size[0]*r),c=Math.round(e.size[1]*r);o.width!=u||o.height!=c?(o.width=u,o.height=c,o.style.transform!==i&&(o.style.transform=i)):this.containerReused||a.clearRect(0,0,u,c),this.preRender(a,e);var l=e.viewState,h=l.projection,p=!1,f=!0;if(n.extent&&this.clipping){var g=fromUserExtent(n.extent,h);(p=(f=intersectsExtent(g,e.extent))&&!containsExtent(g,e.extent))&&this.clipUnrotated(a,e,g)}f&&this.renderWorlds(s,e),p&&a.restore(),this.postRender(a,e);var _=cssOpacity(n.opacity),m=this.container;return _!==m.style.opacity&&(m.style.opacity=_),this.renderedRotation_!==l.rotation&&(this.renderedRotation_=l.rotation,this.hitDetectionImageData_=null),this.container},t.prototype.getFeatures=function(e){return new Promise(function(t){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){var r=[this.context.canvas.width,this.context.canvas.height];apply(this.pixelTransform,r);var n=this.renderedCenter_,i=this.renderedResolution_,a=this.renderedRotation_,o=this.renderedProjection_,s=this.wrappedRenderedExtent_,d=this.getLayer(),u=[],c=r[0]*HIT_DETECT_RESOLUTION,l=r[1]*HIT_DETECT_RESOLUTION;u.push(this.getRenderTransform(n,i,a,HIT_DETECT_RESOLUTION,c,l,0).slice());var h=d.getSource(),p=o.getExtent();if(h.getWrapX()&&o.canWrapX()&&!containsExtent(p,s)){for(var f=s[0],g=getWidth(p),_=0,m=void 0;f<p[0];)m=g*--_,u.push(this.getRenderTransform(n,i,a,HIT_DETECT_RESOLUTION,c,l,m).slice()),f+=g;for(_=0,f=s[2];f>p[2];)m=g*++_,u.push(this.getRenderTransform(n,i,a,HIT_DETECT_RESOLUTION,c,l,m).slice()),f-=g}this.hitDetectionImageData_=createHitDetectionImageData(r,u,this.renderedFeatures_,d.getStyleFunction(),s,i,a)}t(hitDetect(e,this.renderedFeatures_,this.hitDetectionImageData_))}.bind(this))},t.prototype.forEachFeatureAtCoordinate=function(e,t,r,n,i){var a=this;if(this.replayGroup_){var o,s=t.viewState.resolution,d=t.viewState.rotation,u=this.getLayer(),c={},l=function(e,t,r){var a=getUid(e),o=c[a];if(o){if(!0!==o&&r<o.distanceSq){if(0===r)return c[a]=!0,i.splice(i.lastIndexOf(o),1),n(e,u,t);o.geometry=t,o.distanceSq=r}}else{if(0===r)return c[a]=!0,n(e,u,t);i.push(c[a]={feature:e,layer:u,geometry:t,distanceSq:r,callback:n})}},h=[this.replayGroup_];return this.declutterExecutorGroup&&h.push(this.declutterExecutorGroup),h.some((function(n){return o=n.forEachFeatureAtCoordinate(e,s,d,r,l,n===a.declutterExecutorGroup&&t.declutterTree?t.declutterTree.all().map((function(e){return e.value})):null)})),o}},t.prototype.handleFontsChanged=function(){var e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()},t.prototype.handleStyleImageChange_=function(e){this.renderIfReadyAndVisible()},t.prototype.prepareFrame=function(e){var t=this.getLayer(),r=t.getSource();if(!r)return!1;var n=e.viewHints[ViewHint.ANIMATING],i=e.viewHints[ViewHint.INTERACTING],a=t.getUpdateWhileAnimating(),o=t.getUpdateWhileInteracting();if(!this.dirty_&&!a&&n||!o&&i)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;var s=e.extent,d=e.viewState,u=d.projection,c=d.resolution,l=e.pixelRatio,h=t.getRevision(),p=t.getRenderBuffer(),f=t.getRenderOrder();void 0===f&&(f=defaultRenderOrder);var g=d.center.slice(),_=buffer(s,p*c),m=_.slice(),y=[_.slice()],v=u.getExtent();if(r.getWrapX()&&u.canWrapX()&&!containsExtent(v,e.extent)){var x=getWidth(v),E=Math.max(getWidth(_)/2,x);_[0]=v[0]-E,_[2]=v[2]+E,wrapCoordinateX(g,u);var R=wrapExtentX(y[0],u);R[0]<v[0]&&R[2]<v[2]?y.push([R[0]+x,R[1],R[2]+x,R[3]]):R[0]>v[0]&&R[2]>v[2]&&y.push([R[0]-x,R[1],R[2]-x,R[3]])}if(!this.dirty_&&this.renderedResolution_==c&&this.renderedRevision_==h&&this.renderedRenderOrder_==f&&containsExtent(this.wrappedRenderedExtent_,_))return equals(this.renderedExtent_,m)||(this.hitDetectionImageData_=null,this.renderedExtent_=m),this.renderedCenter_=g,this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var T,I=new CanvasBuilderGroup(getRenderTolerance(c,l),_,c,l);this.getLayer().getDeclutter()&&(T=new CanvasBuilderGroup(getRenderTolerance(c,l),_,c,l));var w,S=getUserProjection();if(S){for(var C=0,O=y.length;C<O;++C){var G=y[C],D=toUserExtent(G,u);r.loadFeatures(D,toUserResolution(c,u),S)}w=getTransformFromProjections(S,u)}else for(C=0,O=y.length;C<O;++C)r.loadFeatures(y[C],c,u);var j=getSquaredRenderTolerance(c,l),F=function(e){var r,n=e.getStyleFunction()||t.getStyleFunction();if(n&&(r=n(e,c)),r){var i=this.renderFeature(e,j,r,I,w,T);this.dirty_=this.dirty_||i}}.bind(this),H=toUserExtent(_,u),U=r.getFeaturesInExtent(H);f&&U.sort(f);for(C=0,O=U.length;C<O;++C)F(U[C]);this.renderedFeatures_=U;var L=I.finish(),N=new ExecutorGroup(_,c,l,r.getOverlaps(),L,t.getRenderBuffer());return T&&(this.declutterExecutorGroup=new ExecutorGroup(_,c,l,r.getOverlaps(),T.finish(),t.getRenderBuffer())),this.renderedResolution_=c,this.renderedRevision_=h,this.renderedRenderOrder_=f,this.renderedExtent_=m,this.wrappedRenderedExtent_=_,this.renderedCenter_=g,this.renderedProjection_=u,this.replayGroup_=N,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0},t.prototype.renderFeature=function(e,t,r,n,i,a){if(!r)return!1;var o=!1;if(Array.isArray(r))for(var s=0,d=r.length;s<d;++s)o=renderFeature(n,e,r[s],t,this.boundHandleStyleImageChange_,i,a)||o;else o=renderFeature(n,e,r,t,this.boundHandleStyleImageChange_,i,a);return o},t}(CanvasLayerRenderer);export default CanvasVectorLayerRenderer;
//# sourceMappingURL=/sm/44495d4aafd52fe6bb3b9ab8d2a91ec95f3e48488cfe25fbc8303682b5f3b8f9.map