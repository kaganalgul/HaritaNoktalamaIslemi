/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/renderer/webgl/Layer.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();import LayerProperty from"../../layer/Property.js";import LayerRenderer from"../Layer.js";import RenderEvent from"../../render/Event.js";import RenderEventType from"../../render/EventType.js";import WebGLHelper from"../../webgl/Helper.js";import{apply as applyTransform,compose as composeTransform,create as createTransform}from"../../transform.js";import{containsCoordinate}from"../../extent.js";export var WebGLWorkerMessageType={GENERATE_BUFFERS:"GENERATE_BUFFERS"};var WebGLLayerRenderer=function(e){function t(t,r){var n=e.call(this,t)||this,o=r||{};return n.inversePixelTransform_=createTransform(),n.pixelContext_=null,n.postProcesses_=o.postProcesses,n.uniforms_=o.uniforms,n.helper,t.addChangeListener(LayerProperty.MAP,n.removeHelper_.bind(n)),n.dispatchPreComposeEvent=n.dispatchPreComposeEvent.bind(n),n.dispatchPostComposeEvent=n.dispatchPostComposeEvent.bind(n),n}return __extends(t,e),t.prototype.dispatchPreComposeEvent=function(e,t){var r=this.getLayer();if(r.hasListener(RenderEventType.PRECOMPOSE)){var n=new RenderEvent(RenderEventType.PRECOMPOSE,void 0,t,e);r.dispatchEvent(n)}},t.prototype.dispatchPostComposeEvent=function(e,t){var r=this.getLayer();if(r.hasListener(RenderEventType.POSTCOMPOSE)){var n=new RenderEvent(RenderEventType.POSTCOMPOSE,void 0,t,e);r.dispatchEvent(n)}},t.prototype.reset=function(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)},t.prototype.removeHelper_=function(){this.helper&&(this.helper.dispose(),delete this.helper)},t.prototype.prepareFrame=function(e){if(this.getLayer().getSource()){for(var r=!0,n=-1,o=void 0,a=0,i=e.layerStatesArray.length;a<i;a++){var s=e.layerStatesArray[a].layer,p=s.getRenderer();if(p instanceof t){var h=s.getClassName();if((r||h!==o)&&(n+=1,r=!1),o=h,p===this)break}else r=!0}var l="map/"+e.mapId+"/group/"+n;this.helper&&this.helper.canvasCacheKeyMatches(l)||(this.helper&&this.helper.dispose(),this.helper=new WebGLHelper({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:l}),o&&(this.helper.getCanvas().className=o),this.afterHelperCreated())}return this.prepareFrameInternal(e)},t.prototype.afterHelperCreated=function(){},t.prototype.prepareFrameInternal=function(e){return!0},t.prototype.disposeInternal=function(){this.removeHelper_(),e.prototype.disposeInternal.call(this)},t.prototype.dispatchRenderEvent_=function(e,t,r){var n=this.getLayer();if(n.hasListener(e)){composeTransform(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);var o=new RenderEvent(e,this.inversePixelTransform_,r,t);n.dispatchEvent(o)}},t.prototype.preRender=function(e,t){this.dispatchRenderEvent_(RenderEventType.PRERENDER,e,t)},t.prototype.postRender=function(e,t){this.dispatchRenderEvent_(RenderEventType.POSTRENDER,e,t)},t.prototype.getDataAtPixel=function(e,t,r){var n=applyTransform([t.pixelRatio,0,0,t.pixelRatio,0,0],e.slice()),o=this.helper.getGL();if(!o)return null;var a=this.getLayer().getExtent();if(a){var i=applyTransform(t.pixelToCoordinateTransform,e.slice());if(!containsCoordinate(a,i))return null}var s=o.getContextAttributes();if(!s||!s.preserveDrawingBuffer)return new Uint8Array;var p,h=Math.round(n[0]),l=Math.round(n[1]),f=this.pixelContext_;if(!f){var c=document.createElement("canvas");c.width=1,c.height=1,f=c.getContext("2d"),this.pixelContext_=f}f.clearRect(0,0,1,1);try{f.drawImage(o.canvas,h,l,1,1,0,0,1,1),p=f.getImageData(0,0,1,1).data}catch(e){return p}return 0===p[3]?null:p},t}(LayerRenderer),tmpArray_=[],bufferPositions_={vertexPosition:0,indexPosition:0};function writePointVertex(e,t,r,n,o){e[t+0]=r,e[t+1]=n,e[t+2]=o}export function writePointFeatureToBuffers(e,t,r,n,o,a){var i=3+o,s=e[t+0],p=e[t+1],h=tmpArray_;h.length=o;for(var l=0;l<h.length;l++)h[l]=e[t+2+l];var f=a?a.vertexPosition:0,c=a?a.indexPosition:0,d=f/i;return writePointVertex(r,f,s,p,0),h.length&&r.set(h,f+3),writePointVertex(r,f+=i,s,p,1),h.length&&r.set(h,f+3),writePointVertex(r,f+=i,s,p,2),h.length&&r.set(h,f+3),writePointVertex(r,f+=i,s,p,3),h.length&&r.set(h,f+3),f+=i,n[c++]=d,n[c++]=d+1,n[c++]=d+3,n[c++]=d+1,n[c++]=d+2,n[c++]=d+3,bufferPositions_.vertexPosition=f,bufferPositions_.indexPosition=c,bufferPositions_}export function getBlankImageData(){var e=document.createElement("canvas").getContext("2d").createImageData(1,1);return e.data[0]=255,e.data[1]=255,e.data[2]=255,e.data[3]=255,e}export function colorEncodeId(e,t){var r=t||[],n=256,o=255;return r[0]=Math.floor(e/n/n/n)/o,r[1]=Math.floor(e/n/n)%n/o,r[2]=Math.floor(e/n)%n/o,r[3]=e%n/o,r}export function colorDecodeId(e){var t=0,r=256,n=255;return t+=Math.round(e[0]*r*r*r*n),t+=Math.round(e[1]*r*r*n),t+=Math.round(e[2]*r*n),t+=Math.round(e[3]*n)}export default WebGLLayerRenderer;
//# sourceMappingURL=/sm/5aa15495c82df974b9e3d7536e114756016404dfa9541ed8235cbfff7bff53f7.map