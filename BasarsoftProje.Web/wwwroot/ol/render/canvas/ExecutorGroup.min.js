/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/render/canvas/ExecutorGroup.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import BuilderType from"./BuilderType.js";import Executor from"./Executor.js";import{buffer,createEmpty,extendCoordinate}from"../../extent.js";import{compose as composeTransform,create as createTransform}from"../../transform.js";import{createCanvasContext2D}from"../../dom.js";import{isEmpty}from"../../obj.js";import{numberSafeCompareFunction}from"../../array.js";import{transform2D}from"../../geom/flat/transform.js";var ORDER=[BuilderType.POLYGON,BuilderType.CIRCLE,BuilderType.LINE_STRING,BuilderType.IMAGE,BuilderType.TEXT,BuilderType.DEFAULT],ExecutorGroup=function(){function e(e,t,r,o,i,n){this.maxExtent_=e,this.overlaps_=o,this.pixelRatio_=r,this.resolution_=t,this.renderBuffer_=n,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=createTransform(),this.createExecutors_(i)}return e.prototype.clip=function(e,t){var r=this.getClipCoords(t);e.beginPath(),e.moveTo(r[0],r[1]),e.lineTo(r[2],r[3]),e.lineTo(r[4],r[5]),e.lineTo(r[6],r[7]),e.clip()},e.prototype.createExecutors_=function(e){for(var t in e){var r=this.executorsByZIndex_[t];void 0===r&&(r={},this.executorsByZIndex_[t]=r);var o=e[t];for(var i in o){var n=o[i];r[i]=new Executor(this.resolution_,this.pixelRatio_,this.overlaps_,n)}}},e.prototype.hasExecutors=function(e){for(var t in this.executorsByZIndex_)for(var r=this.executorsByZIndex_[t],o=0,i=e.length;o<i;++o)if(e[o]in r)return!0;return!1},e.prototype.forEachFeatureAtCoordinate=function(e,t,r,o,i,n){var a=2*(o=Math.round(o))+1,s=composeTransform(this.hitDetectionTransform_,o+.5,o+.5,1/t,-1/t,-r,-e[0],-e[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=createCanvasContext2D(a,a));var u,f=this.hitDetectionContext_;f.canvas.width!==a||f.canvas.height!==a?(f.canvas.width=a,f.canvas.height=a):c||f.clearRect(0,0,a,a),void 0!==this.renderBuffer_&&(u=createEmpty(),extendCoordinate(u,e),buffer(u,t*(this.renderBuffer_+o),u));var p,x=getPixelIndexArray(o);function h(e,t){for(var r=f.getImageData(0,0,a,a).data,s=0,c=x.length;s<c;s++)if(r[x[s]]>0){if(!n||p!==BuilderType.IMAGE&&p!==BuilderType.TEXT||-1!==n.indexOf(e)){var u=(x[s]-3)/4,h=o-u%a,m=o-(u/a|0),l=i(e,t,h*h+m*m);if(l)return l}f.clearRect(0,0,a,a);break}}var m,l,d,y,v,_=Object.keys(this.executorsByZIndex_).map(Number);for(_.sort(numberSafeCompareFunction),m=_.length-1;m>=0;--m){var E=_[m].toString();for(d=this.executorsByZIndex_[E],l=ORDER.length-1;l>=0;--l)if(void 0!==(y=d[p=ORDER[l]])&&(v=y.executeHitDetection(f,s,r,h,u)))return v}},e.prototype.getClipCoords=function(e){var t=this.maxExtent_;if(!t)return null;var r=t[0],o=t[1],i=t[2],n=t[3],a=[r,o,r,n,i,n,i,o];return transform2D(a,0,8,2,e,a),a},e.prototype.isEmpty=function(){return isEmpty(this.executorsByZIndex_)},e.prototype.execute=function(e,t,r,o,i,n,a){var s=Object.keys(this.executorsByZIndex_).map(Number);s.sort(numberSafeCompareFunction),this.maxExtent_&&(e.save(),this.clip(e,r));var c,u,f,p,x,h,m=n||ORDER;for(a&&s.reverse(),c=0,u=s.length;c<u;++c){var l=s[c].toString();for(x=this.executorsByZIndex_[l],f=0,p=m.length;f<p;++f){void 0!==(h=x[m[f]])&&h.execute(e,t,r,o,i,a)}}this.maxExtent_&&e.restore()},e}(),circlePixelIndexArrayCache={};export function getPixelIndexArray(e){if(void 0!==circlePixelIndexArrayCache[e])return circlePixelIndexArrayCache[e];for(var t=2*e+1,r=e*e,o=new Array(r+1),i=0;i<=e;++i)for(var n=0;n<=e;++n){var a=i*i+n*n;if(a>r)break;var s=o[a];s||(s=[],o[a]=s),s.push(4*((e+i)*t+(e+n))+3),i>0&&s.push(4*((e-i)*t+(e+n))+3),n>0&&(s.push(4*((e+i)*t+(e-n))+3),i>0&&s.push(4*((e-i)*t+(e-n))+3))}for(var c=[],u=(i=0,o.length);i<u;++i)o[i]&&c.push.apply(c,o[i]);return circlePixelIndexArrayCache[e]=c,c}export default ExecutorGroup;
//# sourceMappingURL=/sm/392043b06b172c062c521c5b0122f13781fd868a9e92c6dd2bcd238bf4a6d694.map