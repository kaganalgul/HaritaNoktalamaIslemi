/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/render/canvas/Builder.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();import CanvasInstruction from"./Instruction.js";import GeometryType from"../../geom/GeometryType.js";import Relationship from"../../extent/Relationship.js";import VectorContext from"../VectorContext.js";import{asColorLike}from"../../colorlike.js";import{buffer,clone,containsCoordinate,coordinateRelationship}from"../../extent.js";import{defaultFillStyle,defaultLineCap,defaultLineDash,defaultLineDashOffset,defaultLineJoin,defaultLineWidth,defaultMiterLimit,defaultStrokeStyle}from"../canvas.js";import{equals,reverseSubArray}from"../../array.js";import{inflateCoordinates,inflateCoordinatesArray,inflateMultiCoordinatesArray}from"../../geom/flat/inflate.js";var CanvasBuilder=function(t){function e(e,i,n,o){var r=t.call(this)||this;return r.tolerance=e,r.maxExtent=i,r.pixelRatio=o,r.maxLineWidth=0,r.resolution=n,r.beginGeometryInstruction1_=null,r.beginGeometryInstruction2_=null,r.bufferedMaxExtent_=null,r.instructions=[],r.coordinates=[],r.tmpCoordinate_=[],r.hitDetectionInstructions=[],r.state={},r}return __extends(e,t),e.prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return 1==e?t:t.map((function(t){return t*e}))},e.prototype.appendFlatPointCoordinates=function(t,e){for(var i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,o=this.coordinates,r=o.length,s=0,a=t.length;s<a;s+=e)n[0]=t[s],n[1]=t[s+1],containsCoordinate(i,n)&&(o[r++]=n[0],o[r++]=n[1]);return r},e.prototype.appendFlatLineCoordinates=function(t,e,i,n,o,r){var s=this.coordinates,a=s.length,u=this.getBufferedMaxExtent();r&&(e+=n);var l,h,c,p=t[e],f=t[e+1],d=this.tmpCoordinate_,y=!0;for(l=e+n;l<i;l+=n)d[0]=t[l],d[1]=t[l+1],(c=coordinateRelationship(u,d))!==h?(y&&(s[a++]=p,s[a++]=f,y=!1),s[a++]=d[0],s[a++]=d[1]):c===Relationship.INTERSECTING?(s[a++]=d[0],s[a++]=d[1],y=!1):y=!0,p=d[0],f=d[1],h=c;return(o&&y||l===e+n)&&(s[a++]=p,s[a++]=f),a},e.prototype.drawCustomCoordinates_=function(t,e,i,n,o){for(var r=0,s=i.length;r<s;++r){var a=i[r],u=this.appendFlatLineCoordinates(t,e,a,n,!1,!1);o.push(u),e=a}return e},e.prototype.drawCustom=function(t,e,i,n){this.beginGeometry(t,e);var o,r,s,a,u,l=t.getType(),h=t.getStride(),c=this.coordinates.length;switch(l){case GeometryType.MULTI_POLYGON:o=t.getOrientedFlatCoordinates(),a=[];var p=t.getEndss();u=0;for(var f=0,d=p.length;f<d;++f){var y=[];u=this.drawCustomCoordinates_(o,u,p[f],h,y),a.push(y)}this.instructions.push([CanvasInstruction.CUSTOM,c,a,t,i,inflateMultiCoordinatesArray]),this.hitDetectionInstructions.push([CanvasInstruction.CUSTOM,c,a,t,n||i,inflateMultiCoordinatesArray]);break;case GeometryType.POLYGON:case GeometryType.MULTI_LINE_STRING:s=[],o=l==GeometryType.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),u=this.drawCustomCoordinates_(o,0,t.getEnds(),h,s),this.instructions.push([CanvasInstruction.CUSTOM,c,s,t,i,inflateCoordinatesArray]),this.hitDetectionInstructions.push([CanvasInstruction.CUSTOM,c,s,t,n||i,inflateCoordinatesArray]);break;case GeometryType.LINE_STRING:case GeometryType.CIRCLE:o=t.getFlatCoordinates(),r=this.appendFlatLineCoordinates(o,0,o.length,h,!1,!1),this.instructions.push([CanvasInstruction.CUSTOM,c,r,t,i,inflateCoordinates]),this.hitDetectionInstructions.push([CanvasInstruction.CUSTOM,c,r,t,n||i,inflateCoordinates]);break;case GeometryType.MULTI_POINT:o=t.getFlatCoordinates(),(r=this.appendFlatPointCoordinates(o,h))>c&&(this.instructions.push([CanvasInstruction.CUSTOM,c,r,t,i,inflateCoordinates]),this.hitDetectionInstructions.push([CanvasInstruction.CUSTOM,c,r,t,n||i,inflateCoordinates]));break;case GeometryType.POINT:o=t.getFlatCoordinates(),this.coordinates.push(o[0],o[1]),r=this.coordinates.length,this.instructions.push([CanvasInstruction.CUSTOM,c,r,t,i]),this.hitDetectionInstructions.push([CanvasInstruction.CUSTOM,c,r,t,n||i])}this.endGeometry(e)},e.prototype.beginGeometry=function(t,e){this.beginGeometryInstruction1_=[CanvasInstruction.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[CanvasInstruction.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},e.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},e.prototype.reverseHitDetectionInstructions=function(){var t,e=this.hitDetectionInstructions;e.reverse();var i,n,o=e.length,r=-1;for(t=0;t<o;++t)(n=(i=e[t])[0])==CanvasInstruction.END_GEOMETRY?r=t:n==CanvasInstruction.BEGIN_GEOMETRY&&(i[2]=t,reverseSubArray(this.hitDetectionInstructions,r,t),r=-1)},e.prototype.setFillStrokeStyle=function(t,e){var i=this.state;if(t){var n=t.getColor();i.fillStyle=asColorLike(n||defaultFillStyle)}else i.fillStyle=void 0;if(e){var o=e.getColor();i.strokeStyle=asColorLike(o||defaultStrokeStyle);var r=e.getLineCap();i.lineCap=void 0!==r?r:defaultLineCap;var s=e.getLineDash();i.lineDash=s?s.slice():defaultLineDash;var a=e.getLineDashOffset();i.lineDashOffset=a||defaultLineDashOffset;var u=e.getLineJoin();i.lineJoin=void 0!==u?u:defaultLineJoin;var l=e.getWidth();i.lineWidth=void 0!==l?l:defaultLineWidth;var h=e.getMiterLimit();i.miterLimit=void 0!==h?h:defaultMiterLimit,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0},e.prototype.createFill=function(t){var e=t.fillStyle,i=[CanvasInstruction.SET_FILL_STYLE,e];return"string"!=typeof e&&i.push(!0),i},e.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))},e.prototype.createStroke=function(t){return[CanvasInstruction.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]},e.prototype.updateFillStyle=function(t,e){var i=t.fillStyle;"string"==typeof i&&t.currentFillStyle==i||(void 0!==i&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)},e.prototype.updateStrokeStyle=function(t,e){var i=t.strokeStyle,n=t.lineCap,o=t.lineDash,r=t.lineDashOffset,s=t.lineJoin,a=t.lineWidth,u=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=n||o!=t.currentLineDash&&!equals(t.currentLineDash,o)||t.currentLineDashOffset!=r||t.currentLineJoin!=s||t.currentLineWidth!=a||t.currentMiterLimit!=u)&&(void 0!==i&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=o,t.currentLineDashOffset=r,t.currentLineJoin=s,t.currentLineWidth=a,t.currentMiterLimit=u)},e.prototype.endGeometry=function(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var e=[CanvasInstruction.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)},e.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=clone(this.maxExtent),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;buffer(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},e}(VectorContext);export default CanvasBuilder;
//# sourceMappingURL=/sm/9e4a9c6af37dc4cd5560e21291247646af07ed8bc078f405f1c4bbef0caacbfd.map