/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/render/canvas/TextBuilder.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();import CanvasBuilder from"./Builder.js";import CanvasInstruction from"./Instruction.js";import GeometryType from"../../geom/GeometryType.js";import TextPlacement from"../../style/TextPlacement.js";import{asColorLike}from"../../colorlike.js";import{defaultFillStyle,defaultFont,defaultLineCap,defaultLineDash,defaultLineDashOffset,defaultLineJoin,defaultLineWidth,defaultMiterLimit,defaultPadding,defaultStrokeStyle,defaultTextAlign,defaultTextBaseline,registerFont}from"../canvas.js";import{getUid}from"../../util.js";import{intersects}from"../../extent.js";import{matchingChunk}from"../../geom/flat/straightchunk.js";export var TEXT_ALIGN={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};var CanvasTextBuilder=function(t){function e(e,i,s,a){var l=t.call(this,e,i,s,a)||this;return l.labels_=null,l.text_="",l.textOffsetX_=0,l.textOffsetY_=0,l.textRotateWithView_=void 0,l.textRotation_=0,l.textFillState_=null,l.fillStates={},l.textStrokeState_=null,l.strokeStates={},l.textState_={},l.textStates={},l.textKey_="",l.fillKey_="",l.strokeKey_="",l.declutterImageWithText_=void 0,l}return __extends(e,t),e.prototype.finish=function(){var e=t.prototype.finish.call(this);return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e},e.prototype.drawText=function(t,e){var i=this.textFillState_,s=this.textStrokeState_,a=this.textState_;if(""!==this.text_&&a&&(i||s)){var l=this.coordinates,n=l.length,o=t.getType(),r=null,h=t.getStride();if(a.placement!==TextPlacement.LINE||o!=GeometryType.LINE_STRING&&o!=GeometryType.MULTI_LINE_STRING&&o!=GeometryType.POLYGON&&o!=GeometryType.MULTI_POLYGON){var f=a.overflow?null:[];switch(o){case GeometryType.POINT:case GeometryType.MULTI_POINT:r=t.getFlatCoordinates();break;case GeometryType.LINE_STRING:r=t.getFlatMidpoint();break;case GeometryType.CIRCLE:r=t.getCenter();break;case GeometryType.MULTI_LINE_STRING:r=t.getFlatMidpoints(),h=2;break;case GeometryType.POLYGON:r=t.getFlatInteriorPoint(),a.overflow||f.push(r[2]/this.resolution),h=3;break;case GeometryType.MULTI_POLYGON:var d=t.getFlatInteriorPoints();r=[];for(k=0,T=d.length;k<T;k+=3)a.overflow||f.push(d[k+2]/this.resolution),r.push(d[k],d[k+1]);if(0===r.length)return;h=2}if((F=this.appendFlatPointCoordinates(r,h))===n)return;if(f&&(F-n)/2!=r.length/h){var u=n/2;f=f.filter((function(t,e){var i=l[2*(u+e)]===r[e*h]&&l[2*(u+e)+1]===r[e*h+1];return i||--u,i}))}this.saveTextStates_(),(a.backgroundFill||a.backgroundStroke)&&(this.setFillStrokeStyle(a.backgroundFill,a.backgroundStroke),a.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),a.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);var g=a.padding;if(g!=defaultPadding&&(a.scale[0]<0||a.scale[1]<0)){var _=a.padding[0],c=a.padding[1],x=a.padding[2],p=a.padding[3];a.scale[0]<0&&(c=-c,p=-p),a.scale[1]<0&&(_=-_,x=-x),g=[_,c,x,p]}var y=this.pixelRatio;this.instructions.push([CanvasInstruction.DRAW_IMAGE,n,F,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterImageWithText_,g==defaultPadding?defaultPadding:g.map((function(t){return t*y})),!!a.backgroundFill,!!a.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]);var S=1/y;this.hitDetectionInstructions.push([CanvasInstruction.DRAW_IMAGE,n,F,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[S,S],NaN,this.declutterImageWithText_,g,!!a.backgroundFill,!!a.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]),this.endGeometry(e)}else{if(!intersects(this.getBufferedMaxExtent(),t.getExtent()))return;var m=void 0;if(r=t.getFlatCoordinates(),o==GeometryType.LINE_STRING)m=[r.length];else if(o==GeometryType.MULTI_LINE_STRING)m=t.getEnds();else if(o==GeometryType.POLYGON)m=t.getEnds().slice(0,1);else if(o==GeometryType.MULTI_POLYGON){var v=t.getEndss();m=[];for(var k=0,T=v.length;k<T;++k)m.push(v[k][0])}this.beginGeometry(t,e);for(var L=a.textAlign,I=0,N=void 0,O=0,G=m.length;O<G;++O){if(null==L){var C=matchingChunk(a.maxAngle,r,I,m[O],h);I=C[0],N=C[1]}else N=m[O];for(var k=I;k<N;k+=h)l.push(r[k],r[k+1]);var F=l.length;I=m[O],this.drawChars_(n,F),n=F}this.endGeometry(e)}}},e.prototype.saveTextStates_=function(){var t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,s=this.strokeKey_;t&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));var a=this.textKey_;a in this.textStates||(this.textStates[a]={font:e.font,textAlign:e.textAlign||defaultTextAlign,textBaseline:e.textBaseline||defaultTextBaseline,scale:e.scale});var l=this.fillKey_;i&&(l in this.fillStates||(this.fillStates[l]={fillStyle:i.fillStyle}))},e.prototype.drawChars_=function(t,e){var i=this.textStrokeState_,s=this.textState_,a=this.strokeKey_,l=this.textKey_,n=this.fillKey_;this.saveTextStates_();var o=this.pixelRatio,r=TEXT_ALIGN[s.textBaseline],h=this.textOffsetY_*o,f=this.text_,d=i?i.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([CanvasInstruction.DRAW_CHARS,t,e,r,s.overflow,n,s.maxAngle,o,h,a,d*o,f,l,1]),this.hitDetectionInstructions.push([CanvasInstruction.DRAW_CHARS,t,e,r,s.overflow,n,s.maxAngle,1,h,a,d,f,l,1/o])},e.prototype.setTextStyle=function(t,e){var i,s,a;if(t){var l=t.getFill();l?((s=this.textFillState_)||(s={},this.textFillState_=s),s.fillStyle=asColorLike(l.getColor()||defaultFillStyle)):(s=null,this.textFillState_=s);var n=t.getStroke();if(n){(a=this.textStrokeState_)||(a={},this.textStrokeState_=a);var o=n.getLineDash(),r=n.getLineDashOffset(),h=n.getWidth(),f=n.getMiterLimit();a.lineCap=n.getLineCap()||defaultLineCap,a.lineDash=o?o.slice():defaultLineDash,a.lineDashOffset=void 0===r?defaultLineDashOffset:r,a.lineJoin=n.getLineJoin()||defaultLineJoin,a.lineWidth=void 0===h?defaultLineWidth:h,a.miterLimit=void 0===f?defaultMiterLimit:f,a.strokeStyle=asColorLike(n.getColor()||defaultStrokeStyle)}else a=null,this.textStrokeState_=a;i=this.textState_;var d=t.getFont()||defaultFont;registerFont(d);var u=t.getScaleArray();i.overflow=t.getOverflow(),i.font=d,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.textBaseline=t.getTextBaseline()||defaultTextBaseline,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||defaultPadding,i.scale=void 0===u?[1,1]:u;var g=t.getOffsetX(),_=t.getOffsetY(),c=t.getRotateWithView(),x=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===g?0:g,this.textOffsetY_=void 0===_?0:_,this.textRotateWithView_=void 0!==c&&c,this.textRotation_=void 0===x?0:x,this.strokeKey_=a?("string"==typeof a.strokeStyle?a.strokeStyle:getUid(a.strokeStyle))+a.lineCap+a.lineDashOffset+"|"+a.lineWidth+a.lineJoin+a.miterLimit+"["+a.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.textBaseline||"?"),this.fillKey_=s?"string"==typeof s.fillStyle?s.fillStyle:"|"+getUid(s.fillStyle):""}else this.text_="";this.declutterImageWithText_=e},e}(CanvasBuilder);export default CanvasTextBuilder;
//# sourceMappingURL=/sm/52268f7468d1254ed63c4761234a5cd17ec942ce62b9dac710efafe32a58eefc.map