/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/render/canvas/Immediate.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}();import GeometryType from"../../geom/GeometryType.js";import VectorContext from"../VectorContext.js";import{asColorLike}from"../../colorlike.js";import{compose as composeTransform,create as createTransform}from"../../transform.js";import{defaultFillStyle,defaultFont,defaultLineCap,defaultLineDash,defaultLineDashOffset,defaultLineJoin,defaultLineWidth,defaultMiterLimit,defaultStrokeStyle,defaultTextAlign,defaultTextBaseline}from"../canvas.js";import{equals}from"../../array.js";import{intersects}from"../../extent.js";import{transform2D}from"../../geom/flat/transform.js";import{transformGeom2D}from"../../geom/SimpleGeometry.js";var CanvasImmediateRenderer=function(t){function e(e,i,a,s,o,r,n){var l=t.call(this)||this;return l.context_=e,l.pixelRatio_=i,l.extent_=a,l.transform_=s,l.viewRotation_=o,l.squaredTolerance_=r,l.userTransform_=n,l.contextFillState_=null,l.contextStrokeState_=null,l.contextTextState_=null,l.fillState_=null,l.strokeState_=null,l.image_=null,l.imageAnchorX_=0,l.imageAnchorY_=0,l.imageHeight_=0,l.imageOpacity_=0,l.imageOriginX_=0,l.imageOriginY_=0,l.imageRotateWithView_=!1,l.imageRotation_=0,l.imageScale_=[0,0],l.imageWidth_=0,l.text_="",l.textOffsetX_=0,l.textOffsetY_=0,l.textRotateWithView_=!1,l.textRotation_=0,l.textScale_=[0,0],l.textFillState_=null,l.textStrokeState_=null,l.textState_=null,l.pixelCoordinates_=[],l.tmpLocalTransform_=createTransform(),l}return __extends(e,t),e.prototype.drawImages_=function(t,e,i,a){if(this.image_){var s=transform2D(t,e,i,a,this.transform_,this.pixelCoordinates_),o=this.context_,r=this.tmpLocalTransform_,n=o.globalAlpha;1!=this.imageOpacity_&&(o.globalAlpha=n*this.imageOpacity_);var l=this.imageRotation_;this.imageRotateWithView_&&(l+=this.viewRotation_);for(var h=0,_=s.length;h<_;h+=2){var f=s[h]-this.imageAnchorX_,m=s[h+1]-this.imageAnchorY_;if(0!==l||1!=this.imageScale_[0]||1!=this.imageScale_[1]){var g=f+this.imageAnchorX_,x=m+this.imageAnchorY_;composeTransform(r,g,x,1,1,l,-g,-x),o.setTransform.apply(o,r),o.translate(g,x),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,f,m,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(o.globalAlpha=n)}},e.prototype.drawText_=function(t,e,i,a){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var s=transform2D(t,e,i,a,this.transform_,this.pixelCoordinates_),o=this.context_,r=this.textRotation_;for(this.textRotateWithView_&&(r+=this.viewRotation_);e<i;e+=a){var n=s[e]+this.textOffsetX_,l=s[e+1]+this.textOffsetY_;if(0!==r||1!=this.textScale_[0]||1!=this.textScale_[1]){var h=composeTransform(this.tmpLocalTransform_,n,l,1,1,r,-n,-l);o.setTransform.apply(o,h),o.translate(n,l),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&o.strokeText(this.text_,n,l),this.textFillState_&&o.fillText(this.text_,n,l)}}},e.prototype.moveToLineTo_=function(t,e,i,a,s){var o=this.context_,r=transform2D(t,e,i,a,this.transform_,this.pixelCoordinates_);o.moveTo(r[0],r[1]);var n=r.length;s&&(n-=2);for(var l=2;l<n;l+=2)o.lineTo(r[l],r[l+1]);return s&&o.closePath(),i},e.prototype.drawRings_=function(t,e,i,a){for(var s=0,o=i.length;s<o;++s)e=this.moveToLineTo_(t,e,i[s],a,!0);return e},e.prototype.drawCircle=function(t){if(intersects(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=transformGeom2D(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],a=e[3]-e[1],s=Math.sqrt(i*i+a*a),o=this.context_;o.beginPath(),o.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}},e.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},e.prototype.setTransform=function(t){this.transform_=t},e.prototype.drawGeometry=function(t){switch(t.getType()){case GeometryType.POINT:this.drawPoint(t);break;case GeometryType.LINE_STRING:this.drawLineString(t);break;case GeometryType.POLYGON:this.drawPolygon(t);break;case GeometryType.MULTI_POINT:this.drawMultiPoint(t);break;case GeometryType.MULTI_LINE_STRING:this.drawMultiLineString(t);break;case GeometryType.MULTI_POLYGON:this.drawMultiPolygon(t);break;case GeometryType.GEOMETRY_COLLECTION:this.drawGeometryCollection(t);break;case GeometryType.CIRCLE:this.drawCircle(t)}},e.prototype.drawFeature=function(t,e){var i=e.getGeometryFunction()(t);i&&intersects(this.extent_,i.getExtent())&&(this.setStyle(e),this.drawGeometry(i))},e.prototype.drawGeometryCollection=function(t){for(var e=t.getGeometriesArray(),i=0,a=e.length;i<a;++i)this.drawGeometry(e[i])},e.prototype.drawPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)},e.prototype.drawMultiPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)},e.prototype.drawLineString=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),intersects(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){var a=t.getFlatMidpoint();this.drawText_(a,0,2,2)}}},e.prototype.drawMultiLineString=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getExtent();if(intersects(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var i=this.context_,a=t.getFlatCoordinates(),s=0,o=t.getEnds(),r=t.getStride();i.beginPath();for(var n=0,l=o.length;n<l;++n)s=this.moveToLineTo_(a,s,o[n],r,!1);i.stroke()}if(""!==this.text_){var h=t.getFlatMidpoints();this.drawText_(h,0,h.length,2)}}},e.prototype.drawPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),intersects(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var i=t.getFlatInteriorPoint();this.drawText_(i,0,2,2)}}},e.prototype.drawMultiPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),intersects(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getOrientedFlatCoordinates(),a=0,s=t.getEndss(),o=t.getStride();e.beginPath();for(var r=0,n=s.length;r<n;++r){var l=s[r];a=this.drawRings_(i,a,l,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var h=t.getFlatInteriorPoints();this.drawText_(h,0,h.length,2)}}},e.prototype.setContextFillState_=function(t){var e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},e.prototype.setContextStrokeState_=function(t){var e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),e.setLineDash&&(equals(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset)),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},e.prototype.setContextTextState_=function(t){var e=this.context_,i=this.contextTextState_,a=t.textAlign?t.textAlign:defaultTextAlign;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=a&&(i.textAlign=a,e.textAlign=a),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=a,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:a,textBaseline:t.textBaseline})},e.prototype.setFillStrokeStyle=function(t,e){var i=this;if(t){var a=t.getColor();this.fillState_={fillStyle:asColorLike(a||defaultFillStyle)}}else this.fillState_=null;if(e){var s=e.getColor(),o=e.getLineCap(),r=e.getLineDash(),n=e.getLineDashOffset(),l=e.getLineJoin(),h=e.getWidth(),_=e.getMiterLimit(),f=r||defaultLineDash;this.strokeState_={lineCap:void 0!==o?o:defaultLineCap,lineDash:1===this.pixelRatio_?f:f.map((function(t){return t*i.pixelRatio_})),lineDashOffset:(n||defaultLineDashOffset)*this.pixelRatio_,lineJoin:void 0!==l?l:defaultLineJoin,lineWidth:(void 0!==h?h:defaultLineWidth)*this.pixelRatio_,miterLimit:void 0!==_?_:defaultMiterLimit,strokeStyle:asColorLike(s||defaultStrokeStyle)}}else this.strokeState_=null},e.prototype.setImageStyle=function(t){var e;if(t&&(e=t.getSize())){var i=t.getAnchor(),a=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=i[0]*this.pixelRatio_,this.imageAnchorY_=i[1]*this.pixelRatio_,this.imageHeight_=e[1]*this.pixelRatio_,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=a[0],this.imageOriginY_=a[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScaleArray(),this.imageWidth_=e[0]*this.pixelRatio_}else this.image_=null},e.prototype.setTextStyle=function(t){if(t){var e=t.getFill();if(e){var i=e.getColor();this.textFillState_={fillStyle:asColorLike(i||defaultFillStyle)}}else this.textFillState_=null;var a=t.getStroke();if(a){var s=a.getColor(),o=a.getLineCap(),r=a.getLineDash(),n=a.getLineDashOffset(),l=a.getLineJoin(),h=a.getWidth(),_=a.getMiterLimit();this.textStrokeState_={lineCap:void 0!==o?o:defaultLineCap,lineDash:r||defaultLineDash,lineDashOffset:n||defaultLineDashOffset,lineJoin:void 0!==l?l:defaultLineJoin,lineWidth:void 0!==h?h:defaultLineWidth,miterLimit:void 0!==_?_:defaultMiterLimit,strokeStyle:asColorLike(s||defaultStrokeStyle)}}else this.textStrokeState_=null;var f=t.getFont(),m=t.getOffsetX(),g=t.getOffsetY(),x=t.getRotateWithView(),S=t.getRotation(),d=t.getScaleArray(),c=t.getText(),p=t.getTextAlign(),u=t.getTextBaseline();this.textState_={font:void 0!==f?f:defaultFont,textAlign:void 0!==p?p:defaultTextAlign,textBaseline:void 0!==u?u:defaultTextBaseline},this.text_=void 0!==c?c:"",this.textOffsetX_=void 0!==m?this.pixelRatio_*m:0,this.textOffsetY_=void 0!==g?this.pixelRatio_*g:0,this.textRotateWithView_=void 0!==x&&x,this.textRotation_=void 0!==S?S:0,this.textScale_=[this.pixelRatio_*d[0],this.pixelRatio_*d[1]]}else this.text_=""},e}(VectorContext);export default CanvasImmediateRenderer;
//# sourceMappingURL=/sm/5254a8ff37318ff7a80f1e6363b8c7e8d441b45e43cd145a284597a49bf1adda.map