/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/layer/WebGLTile.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])},e(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();import BaseTileLayer from"./BaseTile.js";import LayerProperty from"../layer/Property.js";import WebGLTileLayerRenderer,{Attributes,Uniforms}from"../renderer/webgl/TileLayer.js";import{PALETTE_TEXTURE_ARRAY,ValueTypes,expressionToGlsl,getStringNumberEquivalent,uniformNameForVariable}from"../style/expressions.js";import{assign}from"../obj.js";function parseStyle(e,r){var t="\n    attribute vec2 "+Attributes.TEXTURE_COORD+";\n    uniform mat4 "+Uniforms.TILE_TRANSFORM+";\n    uniform float "+Uniforms.DEPTH+";\n\n    varying vec2 v_textureCoord;\n\n    void main() {\n      v_textureCoord = "+Attributes.TEXTURE_COORD+";\n      gl_Position = "+Uniforms.TILE_TRANSFORM+" * vec4("+Attributes.TEXTURE_COORD+", "+Uniforms.DEPTH+", 1.0);\n    }\n  ",n={inFragmentShader:!0,variables:[],attributes:[],stringLiteralsMap:{},functions:{},bandCount:r},o=[];if(void 0!==e.color){var a=expressionToGlsl(n,e.color,ValueTypes.COLOR);o.push("color = "+a+";")}if(void 0!==e.contrast){var s=expressionToGlsl(n,e.contrast,ValueTypes.NUMBER);o.push("color.rgb = clamp(("+s+" + 1.0) * color.rgb - ("+s+" / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));")}if(void 0!==e.exposure){var i=expressionToGlsl(n,e.exposure,ValueTypes.NUMBER);o.push("color.rgb = clamp(("+i+" + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));")}if(void 0!==e.saturation){var l=expressionToGlsl(n,e.saturation,ValueTypes.NUMBER);o.push("\n      float saturation = "+l+" + 1.0;\n      float sr = (1.0 - saturation) * 0.2126;\n      float sg = (1.0 - saturation) * 0.7152;\n      float sb = (1.0 - saturation) * 0.0722;\n      mat3 saturationMatrix = mat3(\n        sr + saturation, sr, sr,\n        sg, sg + saturation, sg,\n        sb, sb, sb + saturation\n      );\n      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n    ")}if(void 0!==e.gamma){var u=expressionToGlsl(n,e.gamma,ValueTypes.NUMBER);o.push("color.rgb = pow(color.rgb, vec3(1.0 / "+u+"));")}if(void 0!==e.brightness){var c=expressionToGlsl(n,e.brightness,ValueTypes.NUMBER);o.push("color.rgb = clamp(color.rgb + "+c+", vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));")}var f={},p=n.variables.length;if(p>1&&!e.variables)throw new Error("Missing variables in style (expected "+n.variables+")");for(var v=function(r){var t=n.variables[r];if(!(t in e.variables))throw new Error("Missing '"+t+"' in style variables");var o=uniformNameForVariable(t);f[o]=function(){var r=e.variables[t];return"string"==typeof r&&(r=getStringNumberEquivalent(n,r)),void 0!==r?r:-9999999}},T=0;T<p;++T)v(T);var m=Object.keys(f).map((function(e){return"uniform float "+e+";"})),g=Math.ceil(r/4);m.push("uniform sampler2D "+Uniforms.TILE_TEXTURE_ARRAY+"["+g+"];"),n.paletteTextures&&m.push("uniform sampler2D "+PALETTE_TEXTURE_ARRAY+"["+n.paletteTextures.length+"];");var h=Object.keys(n.functions).map((function(e){return n.functions[e]}));return{vertexShader:t,fragmentShader:"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    #else\n    precision mediump float;\n    #endif\n\n    varying vec2 v_textureCoord;\n    uniform float "+Uniforms.TRANSITION_ALPHA+";\n    uniform float "+Uniforms.TEXTURE_PIXEL_WIDTH+";\n    uniform float "+Uniforms.TEXTURE_PIXEL_HEIGHT+";\n    uniform float "+Uniforms.RESOLUTION+";\n    uniform float "+Uniforms.ZOOM+";\n\n    "+m.join("\n")+"\n\n    "+h.join("\n")+"\n\n    void main() {\n      vec4 color = texture2D("+Uniforms.TILE_TEXTURE_ARRAY+"[0],  v_textureCoord);\n\n      "+o.join("\n")+"\n\n      if (color.a == 0.0) {\n        discard;\n      }\n\n      gl_FragColor = color;\n      gl_FragColor.rgb *= gl_FragColor.a;\n      gl_FragColor *= "+Uniforms.TRANSITION_ALPHA+";\n    }",uniforms:f,paletteTextures:n.paletteTextures}}var WebGLTileLayer=function(e){function r(r){var t=this,n=r?assign({},r):{},o=n.style||{};delete n.style;var a=n.cacheSize;return delete n.cacheSize,(t=e.call(this,n)||this).style_=o,t.cacheSize_=a,t.styleVariables_=t.style_.variables||{},t.addChangeListener(LayerProperty.SOURCE,t.handleSourceUpdate_),t}return __extends(r,e),r.prototype.handleSourceUpdate_=function(){this.setStyle(this.style_)},r.prototype.getSourceBandCount_=function(){var e=this.getSource();return e&&"bandCount"in e?e.bandCount:4},r.prototype.createRenderer=function(){var e=parseStyle(this.style_,this.getSourceBandCount_());return new WebGLTileLayerRenderer(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.cacheSize_,paletteTextures:e.paletteTextures})},r.prototype.setStyle=function(e){this.style_=e;var r=parseStyle(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,uniforms:r.uniforms,paletteTextures:r.paletteTextures}),this.changed()},r.prototype.updateStyleVariables=function(e){assign(this.styleVariables_,e),this.changed()},r}(BaseTileLayer);WebGLTileLayer.prototype.dispose;export default WebGLTileLayer;
//# sourceMappingURL=/sm/2c63687aa712bbc36b2e109a91b769f123139b2478a4a5e82917af2e6db08405.map