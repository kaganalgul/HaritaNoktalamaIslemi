/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/layer/Graticule.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var t=function(e,a){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])},t(e,a)};return function(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function i(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();import Collection from"../Collection.js";import EventType from"../render/EventType.js";import Feature from"../Feature.js";import Fill from"../style/Fill.js";import GeometryLayout from"../geom/GeometryLayout.js";import LineString from"../geom/LineString.js";import Point from"../geom/Point.js";import Stroke from"../style/Stroke.js";import Style from"../style/Style.js";import Text from"../style/Text.js";import VectorLayer from"./Vector.js";import VectorSource from"../source/Vector.js";import{applyTransform,approximatelyEquals,containsCoordinate,containsExtent,equals,getCenter,getHeight,getIntersection,getWidth,intersects,isEmpty,wrapX as wrapExtentX}from"../extent.js";import{assign}from"../obj.js";import{clamp}from"../math.js";import{degreesToStringHDMS}from"../coordinate.js";import{equivalent as equivalentProjection,get as getProjection,getTransform}from"../proj.js";import{getVectorContext}from"../render.js";import{meridian,parallel}from"../geom/flat/geodesic.js";var DEFAULT_STROKE_STYLE=new Stroke({color:"rgba(0,0,0,0.2)"}),INTERVALS=[90,45,30,20,10,5,2,1,.5,.2,.1,.05,.01,.005,.002,.001],Graticule=function(t){function e(e){var a=this,i=e||{},o=assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},i);return delete o.maxLines,delete o.strokeStyle,delete o.targetSize,delete o.showLabels,delete o.lonLabelFormatter,delete o.latLabelFormatter,delete o.lonLabelPosition,delete o.latLabelPosition,delete o.lonLabelStyle,delete o.latLabelStyle,delete o.intervals,(a=t.call(this,o)||this).projection_=null,a.maxLat_=1/0,a.maxLon_=1/0,a.minLat_=-1/0,a.minLon_=-1/0,a.maxX_=1/0,a.maxY_=1/0,a.minX_=-1/0,a.minY_=-1/0,a.targetSize_=void 0!==i.targetSize?i.targetSize:100,a.maxLines_=void 0!==i.maxLines?i.maxLines:100,a.meridians_=[],a.parallels_=[],a.strokeStyle_=void 0!==i.strokeStyle?i.strokeStyle:DEFAULT_STROKE_STYLE,a.fromLonLatTransform_=void 0,a.toLonLatTransform_=void 0,a.projectionCenterLonLat_=null,a.bottomLeft_=null,a.bottomRight_=null,a.topLeft_=null,a.topRight_=null,a.meridiansLabels_=null,a.parallelsLabels_=null,i.showLabels&&(a.lonLabelFormatter_=null==i.lonLabelFormatter?degreesToStringHDMS.bind(a,"EW"):i.lonLabelFormatter,a.latLabelFormatter_=null==i.latLabelFormatter?degreesToStringHDMS.bind(a,"NS"):i.latLabelFormatter,a.lonLabelPosition_=null==i.lonLabelPosition?0:i.lonLabelPosition,a.latLabelPosition_=null==i.latLabelPosition?1:i.latLabelPosition,a.lonLabelStyleBase_=new Style({text:void 0!==i.lonLabelStyle?i.lonLabelStyle.clone():new Text({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new Fill({color:"rgba(0,0,0,1)"}),stroke:new Stroke({color:"rgba(255,255,255,1)",width:3})})}),a.lonLabelStyle_=function(t){var e=t.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(e),this.lonLabelStyleBase_}.bind(a),a.latLabelStyleBase_=new Style({text:void 0!==i.latLabelStyle?i.latLabelStyle.clone():new Text({font:"12px Calibri,sans-serif",textAlign:"right",fill:new Fill({color:"rgba(0,0,0,1)"}),stroke:new Stroke({color:"rgba(255,255,255,1)",width:3})})}),a.latLabelStyle_=function(t){var e=t.get("graticule_label");return this.latLabelStyleBase_.getText().setText(e),this.latLabelStyleBase_}.bind(a),a.meridiansLabels_=[],a.parallelsLabels_=[],a.addEventListener(EventType.POSTRENDER,a.drawLabels_.bind(a))),a.intervals_=void 0!==i.intervals?i.intervals:INTERVALS,a.setSource(new VectorSource({loader:a.loaderFunction.bind(a),strategy:a.strategyFunction.bind(a),features:new Collection,overlaps:!1,useSpatialIndex:!1,wrapX:i.wrapX})),a.featurePool_=[],a.lineStyle_=new Style({stroke:a.strokeStyle_}),a.loadedExtent_=null,a.renderedExtent_=null,a.setRenderOrder(null),a}return __extends(e,t),e.prototype.strategyFunction=function(t,e){var a=t.slice();return this.projection_&&this.getSource().getWrapX()&&wrapExtentX(a,this.projection_),this.loadedExtent_&&(approximatelyEquals(this.loadedExtent_,a,e)?a=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[a]},e.prototype.loaderFunction=function(t,e,a){this.loadedExtent_=t;var i=this.getSource(),o=this.getExtent()||[-1/0,-1/0,1/0,1/0],r=getIntersection(o,t);if(!(this.renderedExtent_&&equals(this.renderedExtent_,r)||(this.renderedExtent_=r,isEmpty(r)))){var n=getCenter(r),s=e*e/4;(!this.projection_||!equivalentProjection(this.projection_,a))&&this.updateProjectionInfo_(a),this.createGraticule_(r,n,e,s);var l,h=this.meridians_.length+this.parallels_.length;for(this.meridiansLabels_&&(h+=this.meridians_.length),this.parallelsLabels_&&(h+=this.parallels_.length);h>this.featurePool_.length;)l=new Feature,this.featurePool_.push(l);var _=i.getFeaturesCollection();_.clear();var m,L,p=0;for(m=0,L=this.meridians_.length;m<L;++m)(l=this.featurePool_[p++]).setGeometry(this.meridians_[m]),l.setStyle(this.lineStyle_),_.push(l);for(m=0,L=this.parallels_.length;m<L;++m)(l=this.featurePool_[p++]).setGeometry(this.parallels_[m]),l.setStyle(this.lineStyle_),_.push(l)}},e.prototype.addMeridian_=function(t,e,a,i,o,r){var n=this.getMeridian_(t,e,a,i,r);if(intersects(n.getExtent(),o)){if(this.meridiansLabels_){var s=this.lonLabelFormatter_(t);r in this.meridiansLabels_?this.meridiansLabels_[r].text=s:this.meridiansLabels_[r]={geom:new Point([]),text:s}}this.meridians_[r++]=n}return r},e.prototype.addParallel_=function(t,e,a,i,o,r){var n=this.getParallel_(t,e,a,i,r);if(intersects(n.getExtent(),o)){if(this.parallelsLabels_){var s=this.latLabelFormatter_(t);r in this.parallelsLabels_?this.parallelsLabels_[r].text=s:this.parallelsLabels_[r]={geom:new Point([]),text:s}}this.parallels_[r++]=n}return r},e.prototype.drawLabels_=function(t){var e=t.frameState.viewState.rotation,a=t.frameState.extent,i=getCenter(a),o=a;if(e){var r=getWidth(a),n=getHeight(a),s=Math.abs(Math.cos(e)),l=Math.abs(Math.sin(e)),h=(l*n-s*r)/(l*l-s*s),_=(l*r-s*n)/(l*l-s*s);o=[i[0]-h/2,i[1]-_/2,i[0]+h/2,i[1]+_/2]}var m=0,L=0,p=this.latLabelPosition_<.5,d=this.projection_.getExtent(),c=getWidth(d);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!containsExtent(d,a)&&(m=Math.floor((a[0]-d[0])/c),L=Math.ceil((a[2]-d[2])/c),p=p!==Math.abs(e)>Math.PI/2);for(var f=getVectorContext(t),g=m;g<=L;++g){var u=this.meridians_.length+this.parallels_.length,b=void 0,x=void 0,y=void 0,v=void 0;if(this.meridiansLabels_)for(x=0,y=this.meridiansLabels_.length;x<y;++x){var S=this.meridians_[x];if(e||0!==g)(P=S.clone()).translate(g*c,0),P.rotate(-e,i),(v=this.getMeridianPoint_(P,o,x)).rotate(e,i);else v=this.getMeridianPoint_(S,a,x);(b=this.featurePool_[u++]).setGeometry(v),b.set("graticule_label",this.meridiansLabels_[x].text),f.drawFeature(b,this.lonLabelStyle_(b))}if(this.parallelsLabels_&&(g===m&&p||g===L&&!p))for(x=0,y=this.parallels_.length;x<y;++x){var P;S=this.parallels_[x];if(e||0!==g)(P=S.clone()).translate(g*c,0),P.rotate(-e,i),(v=this.getParallelPoint_(P,o,x)).rotate(e,i);else v=this.getParallelPoint_(S,a,x);(b=this.featurePool_[u++]).setGeometry(v),b.set("graticule_label",this.parallelsLabels_[x].text),f.drawFeature(b,this.latLabelStyle_(b))}}},e.prototype.createGraticule_=function(t,e,a,i){var o=this.getInterval_(a);if(-1==o)return this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),void(this.parallelsLabels_&&(this.parallelsLabels_.length=0));var r=!1,n=this.projection_.getExtent(),s=getWidth(n);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!containsExtent(n,t)&&(getWidth(t)>=s?(t[0]=n[0],t[2]=n[2]):r=!0);var l=[clamp(e[0],this.minX_,this.maxX_),clamp(e[1],this.minY_,this.maxY_)],h=this.toLonLatTransform_(l);isNaN(h[1])&&(h[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);var _,m,L,p,d=clamp(h[0],this.minLon_,this.maxLon_),c=clamp(h[1],this.minLat_,this.maxLat_),f=this.maxLines_,g=t;r||(g=[clamp(t[0],this.minX_,this.maxX_),clamp(t[1],this.minY_,this.maxY_),clamp(t[2],this.minX_,this.maxX_),clamp(t[3],this.minY_,this.maxY_)]);var u=applyTransform(g,this.toLonLatTransform_,void 0,8),b=u[3],x=u[2],y=u[1],v=u[0];if(r||(containsCoordinate(g,this.bottomLeft_)&&(v=this.minLon_,y=this.minLat_),containsCoordinate(g,this.bottomRight_)&&(x=this.maxLon_,y=this.minLat_),containsCoordinate(g,this.topLeft_)&&(v=this.minLon_,b=this.maxLat_),containsCoordinate(g,this.topRight_)&&(x=this.maxLon_,b=this.maxLat_),b=clamp(b,c,this.maxLat_),x=clamp(x,d,this.maxLon_),y=clamp(y,this.minLat_,c),v=clamp(v,this.minLon_,d)),d=Math.floor(d/o)*o,p=clamp(d,this.minLon_,this.maxLon_),m=this.addMeridian_(p,y,b,i,t,0),_=0,r)for(;(p-=o)>=v&&_++<f;)m=this.addMeridian_(p,y,b,i,t,m);else for(;p!=this.minLon_&&_++<f;)p=Math.max(p-o,this.minLon_),m=this.addMeridian_(p,y,b,i,t,m);if(p=clamp(d,this.minLon_,this.maxLon_),_=0,r)for(;(p+=o)<=x&&_++<f;)m=this.addMeridian_(p,y,b,i,t,m);else for(;p!=this.maxLon_&&_++<f;)p=Math.min(p+o,this.maxLon_),m=this.addMeridian_(p,y,b,i,t,m);for(this.meridians_.length=m,this.meridiansLabels_&&(this.meridiansLabels_.length=m),c=Math.floor(c/o)*o,L=clamp(c,this.minLat_,this.maxLat_),m=this.addParallel_(L,v,x,i,t,0),_=0;L!=this.minLat_&&_++<f;)L=Math.max(L-o,this.minLat_),m=this.addParallel_(L,v,x,i,t,m);for(L=clamp(c,this.minLat_,this.maxLat_),_=0;L!=this.maxLat_&&_++<f;)L=Math.min(L+o,this.maxLat_),m=this.addParallel_(L,v,x,i,t,m);this.parallels_.length=m,this.parallelsLabels_&&(this.parallelsLabels_.length=m)},e.prototype.getInterval_=function(t){for(var e=this.projectionCenterLonLat_[0],a=this.projectionCenterLonLat_[1],i=-1,o=Math.pow(this.targetSize_*t,2),r=[],n=[],s=0,l=this.intervals_.length;s<l;++s){var h=clamp(this.intervals_[s]/2,0,90),_=clamp(a,-90+h,90-h);if(r[0]=e-h,r[1]=_-h,n[0]=e+h,n[1]=_+h,this.fromLonLatTransform_(r,r),this.fromLonLatTransform_(n,n),Math.pow(n[0]-r[0],2)+Math.pow(n[1]-r[1],2)<=o)break;i=this.intervals_[s]}return i},e.prototype.getMeridian_=function(t,e,a,i,o){var r=meridian(t,e,a,this.projection_,i),n=this.meridians_[o];return n?(n.setFlatCoordinates(GeometryLayout.XY,r),n.changed()):(n=new LineString(r,GeometryLayout.XY),this.meridians_[o]=n),n},e.prototype.getMeridianPoint_=function(t,e,a){var i=t.getFlatCoordinates(),o=1,r=i.length-1;i[o]>i[r]&&(o=r,r=1);var n=Math.max(e[1],i[o]),s=Math.min(e[3],i[r]),l=clamp(e[1]+Math.abs(e[1]-e[3])*this.lonLabelPosition_,n,s),h=[i[o-1]+(i[r-1]-i[o-1])*(l-i[o])/(i[r]-i[o]),l],_=this.meridiansLabels_[a].geom;return _.setCoordinates(h),_},e.prototype.getMeridians=function(){return this.meridians_},e.prototype.getParallel_=function(t,e,a,i,o){var r=parallel(t,e,a,this.projection_,i),n=this.parallels_[o];return n?(n.setFlatCoordinates(GeometryLayout.XY,r),n.changed()):n=new LineString(r,GeometryLayout.XY),n},e.prototype.getParallelPoint_=function(t,e,a){var i=t.getFlatCoordinates(),o=0,r=i.length-2;i[o]>i[r]&&(o=r,r=0);var n=Math.max(e[0],i[o]),s=Math.min(e[2],i[r]),l=clamp(e[0]+Math.abs(e[0]-e[2])*this.latLabelPosition_,n,s),h=[l,i[o+1]+(i[r+1]-i[o+1])*(l-i[o])/(i[r]-i[o])],_=this.parallelsLabels_[a].geom;return _.setCoordinates(h),_},e.prototype.getParallels=function(){return this.parallels_},e.prototype.updateProjectionInfo_=function(t){var e=getProjection("EPSG:4326"),a=t.getWorldExtent();this.maxLat_=a[3],this.maxLon_=a[2],this.minLat_=a[1],this.minLon_=a[0];var i=getTransform(t,e);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=i;else{var o=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(t,e,a){for(var r=a||2,n=i(t,e,r),s=0,l=n.length;s<l;s+=r)n[s]<o&&(n[s]+=360);return n}}this.fromLonLatTransform_=getTransform(e,t);var r=applyTransform([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=r[0],this.maxX_=r[2],this.minY_=r[1],this.maxY_=r[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(getCenter(t.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=t},e}(VectorLayer);export default Graticule;
//# sourceMappingURL=/sm/411d48a987726bd2de03ccdb09e72618a99da002eebe3f079765b2e809c2cfe5.map