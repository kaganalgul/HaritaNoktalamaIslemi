/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/interaction/Draw.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var e=function(t,o){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},e(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();import Circle from"../geom/Circle.js";import Event from"../events/Event.js";import EventType from"../events/EventType.js";import Feature from"../Feature.js";import GeometryType from"../geom/GeometryType.js";import InteractionProperty from"./Property.js";import LineString from"../geom/LineString.js";import MapBrowserEvent from"../MapBrowserEvent.js";import MapBrowserEventType from"../MapBrowserEventType.js";import MultiLineString from"../geom/MultiLineString.js";import MultiPoint from"../geom/MultiPoint.js";import MultiPolygon from"../geom/MultiPolygon.js";import Point from"../geom/Point.js";import PointerInteraction from"./Pointer.js";import Polygon,{fromCircle,makeRegular}from"../geom/Polygon.js";import VectorLayer from"../layer/Vector.js";import VectorSource from"../source/Vector.js";import{FALSE,TRUE}from"../functions.js";import{always,noModifierKeys,shiftKeyOnly}from"../events/condition.js";import{boundingExtent,getBottomLeft,getBottomRight,getTopLeft,getTopRight}from"../extent.js";import{createEditingStyle}from"../style/Style.js";import{fromUserCoordinate,getUserProjection}from"../proj.js";import{squaredDistance as squaredCoordinateDistance}from"../coordinate.js";var Mode={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",CIRCLE:"Circle"},DrawEventType={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"},DrawEvent=function(e){function t(t,o){var i=e.call(this,t)||this;return i.feature=o,i}return __extends(t,e),t}(Event);export{DrawEvent};var Draw=function(e){function t(t){var o=this,i=t;i.stopDown||(i.stopDown=FALSE),(o=e.call(this,i)||this).on,o.once,o.un,o.shouldHandle_=!1,o.downPx_=null,o.downTimeout_,o.lastDragTime_,o.pointerType_,o.freehand_=!1,o.source_=t.source?t.source:null,o.features_=t.features?t.features:null,o.snapTolerance_=t.snapTolerance?t.snapTolerance:12,o.type_=t.type,o.mode_=getMode(o.type_),o.stopClick_=!!t.stopClick,o.minPoints_=t.minPoints?t.minPoints:o.mode_===Mode.POLYGON?3:2,o.maxPoints_=o.mode_===Mode.CIRCLE?2:t.maxPoints?t.maxPoints:1/0,o.finishCondition_=t.finishCondition?t.finishCondition:TRUE;var r=t.geometryFunction;if(!r){var n,s=o.mode_;if(s===Mode.CIRCLE)r=function(e,t,o){var i=t||new Circle([NaN,NaN]),r=fromUserCoordinate(e[0],o),n=squaredCoordinateDistance(r,fromUserCoordinate(e[e.length-1],o));i.setCenterAndRadius(r,Math.sqrt(n));var s=getUserProjection();return s&&i.transform(o,s),i};else s===Mode.POINT?n=Point:s===Mode.LINE_STRING?n=LineString:s===Mode.POLYGON&&(n=Polygon),r=function(e,t,o){return t?s===Mode.POLYGON?e[0].length?t.setCoordinates([e[0].concat([e[0][0]])]):t.setCoordinates([]):t.setCoordinates(e):t=new n(e),t}}return o.geometryFunction_=r,o.dragVertexDelay_=void 0!==t.dragVertexDelay?t.dragVertexDelay:500,o.finishCoordinate_=null,o.sketchFeature_=null,o.sketchPoint_=null,o.sketchCoords_=null,o.sketchLine_=null,o.sketchLineCoords_=null,o.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36,o.overlay_=new VectorLayer({source:new VectorSource({useSpatialIndex:!1,wrapX:!!t.wrapX&&t.wrapX}),style:t.style?t.style:getDefaultStyleFunction(),updateWhileInteracting:!0}),o.geometryName_=t.geometryName,o.condition_=t.condition?t.condition:noModifierKeys,o.freehandCondition_,t.freehand?o.freehandCondition_=always:o.freehandCondition_=t.freehandCondition?t.freehandCondition:shiftKeyOnly,o.addChangeListener(InteractionProperty.ACTIVE,o.updateState_),o}return __extends(t,e),t.prototype.setMap=function(t){e.prototype.setMap.call(this,t),this.updateState_()},t.prototype.getOverlay=function(){return this.overlay_},t.prototype.handleEvent=function(t){t.originalEvent.type===EventType.CONTEXTMENU&&t.originalEvent.preventDefault(),this.freehand_=this.mode_!==Mode.POINT&&this.freehandCondition_(t);var o=t.type===MapBrowserEventType.POINTERMOVE,i=!0;!this.freehand_&&this.lastDragTime_&&t.type===MapBrowserEventType.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=t.pixel,this.shouldHandle_=!this.freehand_,o=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0));return this.freehand_&&t.type===MapBrowserEventType.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(t.coordinate),i=!1):this.freehand_&&t.type===MapBrowserEventType.POINTERDOWN?i=!1:o&&this.getPointerCount()<2?(i=t.type===MapBrowserEventType.POINTERMOVE)&&this.freehand_?(this.handlePointerMove_(t),this.shouldHandle_&&t.originalEvent.preventDefault()):("mouse"===t.originalEvent.pointerType||t.type===MapBrowserEventType.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(t):t.type===MapBrowserEventType.DBLCLICK&&(i=!1),e.prototype.handleEvent.call(this,t)&&i},t.prototype.handleDownEvent=function(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new MapBrowserEvent(MapBrowserEventType.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)},t.prototype.handleUpEvent=function(e){var t=!0;if(0===this.getPointerCount())if(this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e),this.shouldHandle_){var o=!this.finishCoordinate_;o&&this.startDrawing_(e.coordinate),!o&&this.freehand_?this.finishDrawing():this.freehand_||o&&this.mode_!==Mode.POINT||(this.atFinish_(e.pixel)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing();return!t&&this.stopClick_&&e.preventDefault(),t},t.prototype.handlePointerMove_=function(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var t=this.downPx_,o=e.pixel,i=t[0]-o[0],r=t[1]-o[1],n=i*i+r*r;if(this.shouldHandle_=this.freehand_?n>this.squaredClickTolerance_:n<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?this.modifyDrawing_(e.coordinate):this.createOrUpdateSketchPoint_(e.coordinate.slice())},t.prototype.atFinish_=function(e){var t=!1;if(this.sketchFeature_){var o=!1,i=[this.finishCoordinate_],r=this.mode_;if(r===Mode.POINT)t=!0;else if(r===Mode.CIRCLE)t=2===this.sketchCoords_.length;else if(r===Mode.LINE_STRING)o=this.sketchCoords_.length>this.minPoints_;else if(r===Mode.POLYGON){var n=this.sketchCoords_;o=n[0].length>this.minPoints_,i=[n[0][0],n[0][n[0].length-2]]}if(o)for(var s=this.getMap(),a=0,h=i.length;a<h;a++){var d=i[a],c=s.getPixelFromCoordinate(d),_=e[0]-c[0],p=e[1]-c[1],l=this.freehand_?1:this.snapTolerance_;if(t=Math.sqrt(_*_+p*p)<=l){this.finishCoordinate_=d;break}}}return t},t.prototype.createOrUpdateSketchPoint_=function(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new Feature(new Point(e)),this.updateSketchFeatures_())},t.prototype.createOrUpdateCustomSketchLine_=function(e){this.sketchLine_||(this.sketchLine_=new Feature);var t=e.getLinearRing(0),o=this.sketchLine_.getGeometry();o?(o.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),o.changed()):(o=new LineString(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(o))},t.prototype.startDrawing_=function(e){var t=this.getMap().getView().getProjection();this.finishCoordinate_=e,this.mode_===Mode.POINT?this.sketchCoords_=e.slice():this.mode_===Mode.POLYGON?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Feature(new LineString(this.sketchLineCoords_)));var o=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new Feature,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(o),this.updateSketchFeatures_(),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWSTART,this.sketchFeature_))},t.prototype.modifyDrawing_=function(e){var t,o,i=this.getMap(),r=this.sketchFeature_.getGeometry(),n=i.getView().getProjection();(this.mode_===Mode.POINT?o=this.sketchCoords_:this.mode_===Mode.POLYGON?(o=(t=this.sketchCoords_[0])[t.length-1],this.atFinish_(i.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):o=(t=this.sketchCoords_)[t.length-1],o[0]=e[0],o[1]=e[1],this.geometryFunction_(this.sketchCoords_,r,n),this.sketchPoint_)&&this.sketchPoint_.getGeometry().setCoordinates(e);if(r.getType()===GeometryType.POLYGON&&this.mode_!==Mode.POLYGON)this.createOrUpdateCustomSketchLine_(r);else if(this.sketchLineCoords_){this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_)}this.updateSketchFeatures_()},t.prototype.addToDrawing_=function(e){var t,o,i=this.sketchFeature_.getGeometry(),r=this.getMap().getView().getProjection(),n=this.mode_;n===Mode.LINE_STRING||n===Mode.CIRCLE?(this.finishCoordinate_=e.slice(),(o=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?o.pop():t=!0),o.push(e.slice()),this.geometryFunction_(o,i,r)):n===Mode.POLYGON&&((o=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?o.pop():t=!0),o.push(e.slice()),t&&(this.finishCoordinate_=o[0]),this.geometryFunction_(this.sketchCoords_,i,r)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),t&&this.finishDrawing()},t.prototype.removeLastPoint=function(){if(this.sketchFeature_){var e,t=this.sketchFeature_.getGeometry(),o=this.getMap().getView().getProjection(),i=this.mode_;if(i===Mode.LINE_STRING||i===Mode.CIRCLE){if((e=this.sketchCoords_).splice(-2,1),e.length>=2){this.finishCoordinate_=e[e.length-2].slice();var r=this.finishCoordinate_.slice();e[e.length-1]=r,this.createOrUpdateSketchPoint_(r)}this.geometryFunction_(e,t,o),t.getType()===GeometryType.POLYGON&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(i===Mode.POLYGON){(e=this.sketchCoords_[0]).splice(-2,1);var n=this.sketchLine_.getGeometry();if(e.length>=2){r=e[e.length-2].slice();e[e.length-1]=r,this.createOrUpdateSketchPoint_(r)}n.setCoordinates(e),this.geometryFunction_(this.sketchCoords_,t,o)}1===e.length&&this.abortDrawing(),this.updateSketchFeatures_()}},t.prototype.finishDrawing=function(){var e=this.abortDrawing_();if(e){var t=this.sketchCoords_,o=e.getGeometry(),i=this.getMap().getView().getProjection();this.mode_===Mode.LINE_STRING?(t.pop(),this.geometryFunction_(t,o,i)):this.mode_===Mode.POLYGON&&(t[0].pop(),this.geometryFunction_(t,o,i),t=o.getCoordinates()),this.type_===GeometryType.MULTI_POINT?e.setGeometry(new MultiPoint([t])):this.type_===GeometryType.MULTI_LINE_STRING?e.setGeometry(new MultiLineString([t])):this.type_===GeometryType.MULTI_POLYGON&&e.setGeometry(new MultiPolygon([t])),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)}},t.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),e},t.prototype.abortDrawing=function(){var e=this.abortDrawing_();e&&this.dispatchEvent(new DrawEvent(DrawEventType.DRAWABORT,e))},t.prototype.appendCoordinates=function(e){var t,o=this.mode_,i=!this.sketchFeature_;if(i&&this.startDrawing_(e[0]),o===Mode.LINE_STRING||o===Mode.CIRCLE)t=this.sketchCoords_;else{if(o!==Mode.POLYGON)return;t=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}i&&t.shift(),t.pop();for(var r=0;r<e.length;r++)this.addToDrawing_(e[r]);var n=e[e.length-1];this.addToDrawing_(n),this.modifyDrawing_(n)},t.prototype.extend=function(e){var t=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=t.getCoordinates();var o=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=o.slice(),this.sketchCoords_.push(o.slice()),this.sketchPoint_=new Feature(new Point(o)),this.updateSketchFeatures_(),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWSTART,this.sketchFeature_))},t.prototype.updateSketchFeatures_=function(){var e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);var t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)},t.prototype.updateState_=function(){var e=this.getMap(),t=this.getActive();e&&t||this.abortDrawing(),this.overlay_.setMap(t?e:null)},t}(PointerInteraction);function getDefaultStyleFunction(){var e=createEditingStyle();return function(t,o){return e[t.getGeometry().getType()]}}export function createRegularPolygon(e,t){return function(o,i,r){var n=fromUserCoordinate(o[0],r),s=fromUserCoordinate(o[o.length-1],r),a=Math.sqrt(squaredCoordinateDistance(n,s)),h=i||fromCircle(new Circle(n),e),d=t;if(!t&&0!==t){var c=s[0]-n[0],_=s[1]-n[1];d=Math.atan2(_,c)}makeRegular(h,n,a,d);var p=getUserProjection();return p&&h.transform(r,p),h}}export function createBox(){return function(e,t,o){var i=boundingExtent([e[0],e[e.length-1]].map((function(e){return fromUserCoordinate(e,o)}))),r=[[getBottomLeft(i),getBottomRight(i),getTopRight(i),getTopLeft(i),getBottomLeft(i)]],n=t;n?n.setCoordinates(r):n=new Polygon(r);var s=getUserProjection();return s&&n.transform(o,s),n}}function getMode(e){switch(e){case GeometryType.POINT:case GeometryType.MULTI_POINT:return Mode.POINT;case GeometryType.LINE_STRING:case GeometryType.MULTI_LINE_STRING:return Mode.LINE_STRING;case GeometryType.POLYGON:case GeometryType.MULTI_POLYGON:return Mode.POLYGON;case GeometryType.CIRCLE:return Mode.CIRCLE;default:throw new Error("Invalid type: "+e)}}export default Draw;
//# sourceMappingURL=/sm/afd1537c727477cd8db9157f96829117212436ccd4469269150648f129582538.map