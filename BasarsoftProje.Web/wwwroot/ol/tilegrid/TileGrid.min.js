/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/tilegrid/TileGrid.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import TileRange,{createOrUpdate as createOrUpdateTileRange}from"../TileRange.js";import{DEFAULT_TILE_SIZE}from"./common.js";import{assert}from"../asserts.js";import{ceil,clamp,floor}from"../math.js";import{createOrUpdate,getTopLeft}from"../extent.js";import{createOrUpdate as createOrUpdateTileCoord}from"../tilecoord.js";import{isSorted,linearFindNearest}from"../array.js";import{toSize}from"../size.js";var tmpTileCoord=[0,0,0],DECIMALS=5,TileGrid=function(){function t(t){var e;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,assert(isSorted(this.resolutions_,(function(t,e){return e-t}),!0),17),!t.origins)for(var i=0,o=this.resolutions_.length-1;i<o;++i)if(e){if(this.resolutions_[i]/this.resolutions_[i+1]!==e){e=void 0;break}}else e=this.resolutions_[i]/this.resolutions_[i+1];this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,assert(this.origins_.length==this.resolutions_.length,20));var r=t.extent;void 0===r||this.origin_||this.origins_||(this.origin_=getTopLeft(r)),assert(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,assert(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:DEFAULT_TILE_SIZE,assert(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==r?r:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map((function(t,e){var i=new TileRange(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1));if(r){var o=this.getTileRangeForExtentAndZ(r,e);i.minX=Math.max(o.minX,i.minX),i.maxX=Math.min(o.maxX,i.maxX),i.minY=Math.max(o.minY,i.minY),i.maxY=Math.min(o.maxY,i.maxY)}return i}),this):r&&this.calculateTileRanges_(r)}return t.prototype.forEachTileCoord=function(t,e,i){for(var o=this.getTileRangeForExtentAndZ(t,e),r=o.minX,n=o.maxX;r<=n;++r)for(var s=o.minY,l=o.maxY;s<=l;++s)i([e,r,s])},t.prototype.forEachTileCoordParentTileRange=function(t,e,i,o){var r,n,s,l=null,a=t[0]-1;for(2===this.zoomFactor_?(n=t[1],s=t[2]):l=this.getTileCoordExtent(t,o);a>=this.minZoom;){if(2===this.zoomFactor_?(n=Math.floor(n/2),s=Math.floor(s/2),r=createOrUpdateTileRange(n,n,s,s,i)):r=this.getTileRangeForExtentAndZ(l,a,i),e(a,r))return!0;--a}return!1},t.prototype.getExtent=function(){return this.extent_},t.prototype.getMaxZoom=function(){return this.maxZoom},t.prototype.getMinZoom=function(){return this.minZoom},t.prototype.getOrigin=function(t){return this.origin_?this.origin_:this.origins_[t]},t.prototype.getResolution=function(t){return this.resolutions_[t]},t.prototype.getResolutions=function(){return this.resolutions_},t.prototype.getTileCoordChildTileRange=function(t,e,i){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){var o=2*t[1],r=2*t[2];return createOrUpdateTileRange(o,o+1,r,r+1,e)}var n=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,t[0]+1,e)}return null},t.prototype.getTileRangeForTileCoordAndZ=function(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;var o=t[0],r=t[1],n=t[2];if(e===o)return createOrUpdateTileRange(r,n,r,n,i);if(this.zoomFactor_){var s=Math.pow(this.zoomFactor_,e-o),l=Math.floor(r*s),a=Math.floor(n*s);if(e<o)return createOrUpdateTileRange(l,l,a,a,i);var h=Math.floor(s*(r+1))-1,g=Math.floor(s*(n+1))-1;return createOrUpdateTileRange(l,h,a,g,i)}var u=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(u,e,i)},t.prototype.getTileRangeExtent=function(t,e,i){var o=this.getOrigin(t),r=this.getResolution(t),n=toSize(this.getTileSize(t),this.tmpSize_),s=o[0]+e.minX*n[0]*r,l=o[0]+(e.maxX+1)*n[0]*r,a=o[1]+e.minY*n[1]*r,h=o[1]+(e.maxY+1)*n[1]*r;return createOrUpdate(s,a,l,h,i)},t.prototype.getTileRangeForExtentAndZ=function(t,e,i){var o=tmpTileCoord;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,o);var r=o[1],n=o[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,o),createOrUpdateTileRange(r,o[1],n,o[2],i)},t.prototype.getTileCoordCenter=function(t){var e=this.getOrigin(t[0]),i=this.getResolution(t[0]),o=toSize(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*o[0]*i,e[1]-(t[2]+.5)*o[1]*i]},t.prototype.getTileCoordExtent=function(t,e){var i=this.getOrigin(t[0]),o=this.getResolution(t[0]),r=toSize(this.getTileSize(t[0]),this.tmpSize_),n=i[0]+t[1]*r[0]*o,s=i[1]-(t[2]+1)*r[1]*o,l=n+r[0]*o,a=s+r[1]*o;return createOrUpdate(n,s,l,a,e)},t.prototype.getTileCoordForCoordAndResolution=function(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)},t.prototype.getTileCoordForXYAndResolution_=function(t,e,i,o,r){var n=this.getZForResolution(i),s=i/this.getResolution(n),l=this.getOrigin(n),a=toSize(this.getTileSize(n),this.tmpSize_),h=s*(t-l[0])/i/a[0],g=s*(l[1]-e)/i/a[1];return o?(h=ceil(h,DECIMALS)-1,g=ceil(g,DECIMALS)-1):(h=floor(h,DECIMALS),g=floor(g,DECIMALS)),createOrUpdateTileCoord(n,h,g,r)},t.prototype.getTileCoordForXYAndZ_=function(t,e,i,o,r){var n=this.getOrigin(i),s=this.getResolution(i),l=toSize(this.getTileSize(i),this.tmpSize_),a=(t-n[0])/s/l[0],h=(n[1]-e)/s/l[1];return o?(a=ceil(a,DECIMALS)-1,h=ceil(h,DECIMALS)-1):(a=floor(a,DECIMALS),h=floor(h,DECIMALS)),createOrUpdateTileCoord(i,a,h,r)},t.prototype.getTileCoordForCoordAndZ=function(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)},t.prototype.getTileCoordResolution=function(t){return this.resolutions_[t[0]]},t.prototype.getTileSize=function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]},t.prototype.getFullTileRange=function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null},t.prototype.getZForResolution=function(t,e){var i=linearFindNearest(this.resolutions_,t,e||0);return clamp(i,this.minZoom,this.maxZoom)},t.prototype.calculateTileRanges_=function(t){for(var e=this.resolutions_.length,i=new Array(e),o=this.minZoom;o<e;++o)i[o]=this.getTileRangeForExtentAndZ(t,o);this.fullTileRanges_=i},t}();export default TileGrid;
//# sourceMappingURL=/sm/46335ba71706650911c85ca20cb63ac4d8f23d1de0d8242415f4ddaaf2e8216e.map