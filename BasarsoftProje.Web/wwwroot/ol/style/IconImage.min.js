/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/style/IconImage.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}();import EventTarget from"../events/Target.js";import EventType from"../events/EventType.js";import ImageState from"../ImageState.js";import{asString}from"../color.js";import{createCanvasContext2D}from"../dom.js";import{shared as iconImageCache}from"./IconImageCache.js";import{listenImage}from"../Image.js";var taintedTestContext=null,IconImage=function(t){function e(e,i,a,n,o,s){var r=t.call(this)||this;return r.hitDetectionImage_=null,r.image_=e||new Image,null!==n&&(r.image_.crossOrigin=n),r.canvas_={},r.color_=s,r.unlisten_=null,r.imageState_=o,r.size_=a,r.src_=i,r.tainted_,r}return __extends(e,t),e.prototype.isTainted_=function(){if(void 0===this.tainted_&&this.imageState_===ImageState.LOADED){taintedTestContext||(taintedTestContext=createCanvasContext2D(1,1)),taintedTestContext.drawImage(this.image_,0,0);try{taintedTestContext.getImageData(0,0,1,1),this.tainted_=!1}catch(t){taintedTestContext=null,this.tainted_=!0}}return!0===this.tainted_},e.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(EventType.CHANGE)},e.prototype.handleImageError_=function(){this.imageState_=ImageState.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.handleImageLoad_=function(){this.imageState_=ImageState.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.getImage=function(t){return this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_},e.prototype.getPixelRatio=function(t){return this.replaceColor_(t),this.canvas_[t]?t:1},e.prototype.getImageState=function(){return this.imageState_},e.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var t=this.size_[0],e=this.size_[1],i=createCanvasContext2D(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},e.prototype.getSize=function(){return this.size_},e.prototype.getSrc=function(){return this.src_},e.prototype.load=function(){if(this.imageState_==ImageState.IDLE){this.imageState_=ImageState.LOADING;try{this.image_.src=this.src_}catch(t){this.handleImageError_()}this.unlisten_=listenImage(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},e.prototype.replaceColor_=function(t){if(this.color_&&!this.canvas_[t]&&this.imageState_===ImageState.LOADED){var e=document.createElement("canvas");this.canvas_[t]=e,e.width=Math.ceil(this.image_.width*t),e.height=Math.ceil(this.image_.height*t);var i=e.getContext("2d");if(i.scale(t,t),i.drawImage(this.image_,0,0),i.globalCompositeOperation="multiply","multiply"===i.globalCompositeOperation||this.isTainted_())i.fillStyle=asString(this.color_),i.fillRect(0,0,e.width/t,e.height/t),i.globalCompositeOperation="destination-in",i.drawImage(this.image_,0,0);else{for(var a=i.getImageData(0,0,e.width,e.height),n=a.data,o=this.color_[0]/255,s=this.color_[1]/255,r=this.color_[2]/255,h=this.color_[3],g=0,c=n.length;g<c;g+=4)n[g]*=o,n[g+1]*=s,n[g+2]*=r,n[g+3]*=h;i.putImageData(a,0,0)}}},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(EventTarget);export function get(t,e,i,a,n,o){var s=iconImageCache.get(e,a,o);return s||(s=new IconImage(t,e,i,a,n,o),iconImageCache.set(e,a,o,s)),s}export default IconImage;
//# sourceMappingURL=/sm/34ceb2002acae9af72d040bebd3fe3756c882effd1d2f95732809bb2f2ebe2bd.map