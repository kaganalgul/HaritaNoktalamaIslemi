/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/style/expressions.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import PaletteTexture from"../webgl/PaletteTexture.js";import{Uniforms}from"../renderer/webgl/TileLayer.js";import{asArray,fromString,isStringColor}from"../color.js";import{log2}from"../math.js";export var ValueTypes={NUMBER:1,STRING:2,COLOR:4,BOOLEAN:8,NUMBER_ARRAY:16,ANY:31,NONE:0};export var Operators={};export function getValueType(e){if("number"==typeof e)return ValueTypes.NUMBER;if("boolean"==typeof e)return ValueTypes.BOOLEAN;if("string"==typeof e)return isStringColor(e)?ValueTypes.COLOR|ValueTypes.STRING:ValueTypes.STRING;if(!Array.isArray(e))throw new Error("Unhandled value type: "+JSON.stringify(e));var r=e;if(r.every((function(e){return"number"==typeof e})))return 3===r.length||4===r.length?ValueTypes.COLOR|ValueTypes.NUMBER_ARRAY:ValueTypes.NUMBER_ARRAY;if("string"!=typeof r[0])throw new Error("Expected an expression operator but received: "+JSON.stringify(r));var t=Operators[r[0]];if(void 0===t)throw new Error("Unrecognized expression operator: "+JSON.stringify(r));return t.getReturnType(r.slice(1))}export function isTypeUnique(e){return log2(e)%1==0}export function numberToGlsl(e){var r=e.toString();return-1===r.indexOf(".")?r+".0":r}export function arrayToGlsl(e){if(e.length<2||e.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return"vec"+e.length+"("+e.map(numberToGlsl).join(", ")+")"}export function colorToGlsl(e){var r=asArray(e).slice();return r.length<4&&r.push(1),arrayToGlsl(r.map((function(e,r){return r<3?e/255:e})))}export function getStringNumberEquivalent(e,r){return void 0===e.stringLiteralsMap[r]&&(e.stringLiteralsMap[r]=Object.keys(e.stringLiteralsMap).length),e.stringLiteralsMap[r]}export function stringToGlsl(e,r){return numberToGlsl(getStringNumberEquivalent(e,r))}export function expressionToGlsl(e,r,t){if(Array.isArray(r)&&"string"==typeof r[0]){var s=Operators[r[0]];if(void 0===s)throw new Error("Unrecognized expression operator: "+JSON.stringify(r));return s.toGlsl(e,r.slice(1),t)}var n=getValueType(r);if((n&ValueTypes.NUMBER)>0)return numberToGlsl(r);if((n&ValueTypes.BOOLEAN)>0)return r.toString();if((n&ValueTypes.STRING)>0&&(void 0===t||t==ValueTypes.STRING))return stringToGlsl(e,r.toString());if((n&ValueTypes.COLOR)>0&&(void 0===t||t==ValueTypes.COLOR))return colorToGlsl(r);if((n&ValueTypes.NUMBER_ARRAY)>0)return arrayToGlsl(r);throw new Error("Unexpected expression "+r+" (expected type "+t+")")}function assertNumber(e){if(!(getValueType(e)&ValueTypes.NUMBER))throw new Error("A numeric value was expected, got "+JSON.stringify(e)+" instead")}function assertNumbers(e){for(var r=0;r<e.length;r++)assertNumber(e[r])}function assertString(e){if(!(getValueType(e)&ValueTypes.STRING))throw new Error("A string value was expected, got "+JSON.stringify(e)+" instead")}function assertBoolean(e){if(!(getValueType(e)&ValueTypes.BOOLEAN))throw new Error("A boolean value was expected, got "+JSON.stringify(e)+" instead")}function assertArgsCount(e,r){if(e.length!==r)throw new Error("Exactly "+r+" arguments were expected, got "+e.length+" instead")}function assertArgsMinCount(e,r){if(e.length<r)throw new Error("At least "+r+" arguments were expected, got "+e.length+" instead")}function assertArgsMaxCount(e,r){if(e.length>r)throw new Error("At most "+r+" arguments were expected, got "+e.length+" instead")}function assertArgsEven(e){if(e.length%2!=0)throw new Error("An even amount of arguments was expected, got "+e+" instead")}function assertArgsOdd(e){if(e.length%2==0)throw new Error("An odd amount of arguments was expected, got "+e+" instead")}function assertUniqueInferredType(e,r){if(!isTypeUnique(r))throw new Error("Could not infer only one type from the following expression: "+JSON.stringify(e))}Operators.get={getReturnType:function(e){return ValueTypes.ANY},toGlsl:function(e,r){assertArgsCount(r,1),assertString(r[0]);var t=r[0].toString();return-1===e.attributes.indexOf(t)&&e.attributes.push(t),(e.inFragmentShader?"v_":"a_")+t}};export function uniformNameForVariable(e){return"u_var_"+e}Operators.var={getReturnType:function(e){return ValueTypes.ANY},toGlsl:function(e,r){assertArgsCount(r,1),assertString(r[0]);var t=r[0].toString();return-1===e.variables.indexOf(t)&&e.variables.push(t),uniformNameForVariable(t)}};export var PALETTE_TEXTURE_ARRAY="u_paletteTextures";Operators.palette={getReturnType:function(e){return ValueTypes.COLOR},toGlsl:function(e,r){assertArgsCount(r,2),assertNumber(r[0]);var t=expressionToGlsl(e,r[0]),s=r[1];if(!Array.isArray(s))throw new Error("The second argument of palette must be an array");for(var n=s.length,o=new Uint8Array(4*n),u=0;u<n;u++){var a=s[u],l=void 0;if("string"==typeof a)l=fromString(a);else{if(!Array.isArray(a))throw new Error("The second argument of palette must be an array of strings or colors");var i=a.length;if(4===i)l=a;else{if(3!==i)throw new Error("Expected palette color to have 3 or 4 values, got "+i);l=[a[0],a[1],a[2],1]}}var p=4*u;o[p]=l[0],o[p+1]=l[1],o[p+2]=l[2],o[p+3]=255*l[3]}e.paletteTextures||(e.paletteTextures=[]);var T=PALETTE_TEXTURE_ARRAY+"["+e.paletteTextures.length+"]",f=new PaletteTexture(T,o);return e.paletteTextures.push(f),"texture2D("+T+", vec2(("+t+" + 0.5) / "+n+".0, 0.5))"}};var GET_BAND_VALUE_FUNC="getBandValue";function getEqualOperator(e){return{getReturnType:function(e){return ValueTypes.BOOLEAN},toGlsl:function(r,t){assertArgsCount(t,2);for(var s=ValueTypes.ANY,n=0;n<t.length;n++)s&=getValueType(t[n]);if(s===ValueTypes.NONE)throw new Error("All arguments should be of compatible type, got "+JSON.stringify(t)+" instead");return s&=~ValueTypes.COLOR,"("+expressionToGlsl(r,t[0],s)+" "+e+" "+expressionToGlsl(r,t[1],s)+")"}}}function getDecisionOperator(e){return{getReturnType:function(e){return ValueTypes.BOOLEAN},toGlsl:function(r,t){assertArgsMinCount(t,2);for(var s=0;s<t.length;s++)assertBoolean(t[s]);return"("+t.map((function(e){return expressionToGlsl(r,e)})).join(" "+e+" ")+")"}}}Operators.band={getReturnType:function(e){return ValueTypes.NUMBER},toGlsl:function(e,r){assertArgsMinCount(r,1),assertArgsMaxCount(r,3);var t=r[0];if(!(GET_BAND_VALUE_FUNC in e.functions)){for(var s="",n=e.bandCount||1,o=0;o<n;o++){var u=Math.floor(o/4),a=o%4;a===n-1&&1===a&&(a=3),s+="\n          if (band == "+(o+1)+".0) {\n            return texture2D("+(Uniforms.TILE_TEXTURE_ARRAY+"["+u+"]")+", v_textureCoord + vec2(dx, dy))["+a+"];\n          }\n        "}e.functions[GET_BAND_VALUE_FUNC]="\n        float getBandValue(float band, float xOffset, float yOffset) {\n          float dx = xOffset / "+Uniforms.TEXTURE_PIXEL_WIDTH+";\n          float dy = yOffset / "+Uniforms.TEXTURE_PIXEL_HEIGHT+";\n          "+s+"\n        }\n      "}var l=expressionToGlsl(e,t),i=expressionToGlsl(e,r[1]||0),p=expressionToGlsl(e,r[2]||0);return GET_BAND_VALUE_FUNC+"("+l+", "+i+", "+p+")"}},Operators.time={getReturnType:function(e){return ValueTypes.NUMBER},toGlsl:function(e,r){return assertArgsCount(r,0),"u_time"}},Operators.zoom={getReturnType:function(e){return ValueTypes.NUMBER},toGlsl:function(e,r){return assertArgsCount(r,0),"u_zoom"}},Operators.resolution={getReturnType:function(e){return ValueTypes.NUMBER},toGlsl:function(e,r){return assertArgsCount(r,0),"u_resolution"}},Operators["*"]={getReturnType:function(e){return ValueTypes.NUMBER},toGlsl:function(e,r){return assertArgsCount(r,2),assertNumbers(r),"("+expressionToGlsl(e,r[0])+" * "+expressionToGlsl(e,r[1])+")"}},Operators["/"]={getReturnType:function(e){return ValueTypes.NUMBER},toGlsl:function(e,r){return assertArgsCount(r,2),assertNumbers(r),"("+expressionToGlsl(e,r[0])+" / "+expressionToGlsl(e,r[1])+")"}},Operators["+"]={getReturnType:function(e){return ValueTypes.NUMBER},toGlsl:function(e,r){return assertArgsCount(r,2),assertNumbers(r),"("+expressionToGlsl(e,r[0])+" + "+expressionToGlsl(e,r[1])+")"}},Operators["-"]={getReturnType:function(e){return ValueTypes.NUMBER},toGlsl:function(e,r){return assertArgsCount(r,2),assertNumbers(r),"("+expressionToGlsl(e,r[0])+" - "+expressionToGlsl(e,r[1])+")"}},Operators.clamp={getReturnType:function(e){return ValueTypes.NUMBER},toGlsl:function(e,r){assertArgsCount(r,3),assertNumbers(r);var t=expressionToGlsl(e,r[1]),s=expressionToGlsl(e,r[2]);return"clamp("+expressionToGlsl(e,r[0])+", "+t+", "+s+")"}},Operators["%"]={getReturnType:function(e){return ValueTypes.NUMBER},toGlsl:function(e,r){return assertArgsCount(r,2),assertNumbers(r),"mod("+expressionToGlsl(e,r[0])+", "+expressionToGlsl(e,r[1])+")"}},Operators["^"]={getReturnType:function(e){return ValueTypes.NUMBER},toGlsl:function(e,r){return assertArgsCount(r,2),assertNumbers(r),"pow("+expressionToGlsl(e,r[0])+", "+expressionToGlsl(e,r[1])+")"}},Operators.abs={getReturnType:function(e){return ValueTypes.NUMBER},toGlsl:function(e,r){return assertArgsCount(r,1),assertNumbers(r),"abs("+expressionToGlsl(e,r[0])+")"}},Operators.sin={getReturnType:function(e){return ValueTypes.NUMBER},toGlsl:function(e,r){return assertArgsCount(r,1),assertNumbers(r),"sin("+expressionToGlsl(e,r[0])+")"}},Operators.cos={getReturnType:function(e){return ValueTypes.NUMBER},toGlsl:function(e,r){return assertArgsCount(r,1),assertNumbers(r),"cos("+expressionToGlsl(e,r[0])+")"}},Operators.atan={getReturnType:function(e){return ValueTypes.NUMBER},toGlsl:function(e,r){return assertArgsMinCount(r,1),assertArgsMaxCount(r,2),assertNumbers(r),2===r.length?"atan("+expressionToGlsl(e,r[0])+", "+expressionToGlsl(e,r[1])+")":"atan("+expressionToGlsl(e,r[0])+")"}},Operators[">"]={getReturnType:function(e){return ValueTypes.BOOLEAN},toGlsl:function(e,r){return assertArgsCount(r,2),assertNumbers(r),"("+expressionToGlsl(e,r[0])+" > "+expressionToGlsl(e,r[1])+")"}},Operators[">="]={getReturnType:function(e){return ValueTypes.BOOLEAN},toGlsl:function(e,r){return assertArgsCount(r,2),assertNumbers(r),"("+expressionToGlsl(e,r[0])+" >= "+expressionToGlsl(e,r[1])+")"}},Operators["<"]={getReturnType:function(e){return ValueTypes.BOOLEAN},toGlsl:function(e,r){return assertArgsCount(r,2),assertNumbers(r),"("+expressionToGlsl(e,r[0])+" < "+expressionToGlsl(e,r[1])+")"}},Operators["<="]={getReturnType:function(e){return ValueTypes.BOOLEAN},toGlsl:function(e,r){return assertArgsCount(r,2),assertNumbers(r),"("+expressionToGlsl(e,r[0])+" <= "+expressionToGlsl(e,r[1])+")"}},Operators["=="]=getEqualOperator("=="),Operators["!="]=getEqualOperator("!="),Operators["!"]={getReturnType:function(e){return ValueTypes.BOOLEAN},toGlsl:function(e,r){return assertArgsCount(r,1),assertBoolean(r[0]),"(!"+expressionToGlsl(e,r[0])+")"}},Operators.all=getDecisionOperator("&&"),Operators.any=getDecisionOperator("||"),Operators.between={getReturnType:function(e){return ValueTypes.BOOLEAN},toGlsl:function(e,r){assertArgsCount(r,3),assertNumbers(r);var t=expressionToGlsl(e,r[1]),s=expressionToGlsl(e,r[2]),n=expressionToGlsl(e,r[0]);return"("+n+" >= "+t+" && "+n+" <= "+s+")"}},Operators.array={getReturnType:function(e){return ValueTypes.NUMBER_ARRAY},toGlsl:function(e,r){assertArgsMinCount(r,2),assertArgsMaxCount(r,4),assertNumbers(r);var t=r.map((function(r){return expressionToGlsl(e,r,ValueTypes.NUMBER)}));return"vec"+r.length+"("+t.join(", ")+")"}},Operators.color={getReturnType:function(e){return ValueTypes.COLOR},toGlsl:function(e,r){assertArgsMinCount(r,3),assertArgsMaxCount(r,4),assertNumbers(r);var t=r;3===r.length&&t.push(1);var s=r.map((function(r,t){return expressionToGlsl(e,r,ValueTypes.NUMBER)+(t<3?" / 255.0":"")}));return"vec"+r.length+"("+s.join(", ")+")"}},Operators.interpolate={getReturnType:function(e){for(var r=ValueTypes.COLOR|ValueTypes.NUMBER,t=3;t<e.length;t+=2)r&=getValueType(e[t]);return r},toGlsl:function(e,r,t){assertArgsEven(r),assertArgsMinCount(r,6);var s,n=r[0];switch(n[0]){case"linear":s=1;break;case"exponential":s=n[1];break;default:s=null}if(!s)throw new Error('Invalid interpolation type for "interpolate" operator, received: '+JSON.stringify(n));var o=void 0!==t?t:ValueTypes.ANY,u=Operators.interpolate.getReturnType(r)&o;assertUniqueInferredType(r,u);for(var a=expressionToGlsl(e,r[1]),l=numberToGlsl(s),i="",p=2;p<r.length-2;p+=2){var T=expressionToGlsl(e,r[p]),f=i||expressionToGlsl(e,r[p+1],u),g=expressionToGlsl(e,r[p+2]);i="mix("+f+", "+expressionToGlsl(e,r[p+3],u)+", pow(clamp(("+a+" - "+T+") / ("+g+" - "+T+"), 0.0, 1.0), "+l+"))"}return i}},Operators.match={getReturnType:function(e){for(var r=ValueTypes.ANY,t=2;t<e.length;t+=2)r&=getValueType(e[t]);return r&=getValueType(e[e.length-1])},toGlsl:function(e,r,t){assertArgsEven(r),assertArgsMinCount(r,4);var s=void 0!==t?t:ValueTypes.ANY,n=Operators.match.getReturnType(r)&s;assertUniqueInferredType(r,n);for(var o=expressionToGlsl(e,r[0]),u=expressionToGlsl(e,r[r.length-1],n),a=null,l=r.length-3;l>=1;l-=2){a="("+o+" == "+expressionToGlsl(e,r[l])+" ? "+expressionToGlsl(e,r[l+1],n)+" : "+(a||u)+")"}return a}},Operators.case={getReturnType:function(e){for(var r=ValueTypes.ANY,t=1;t<e.length;t+=2)r&=getValueType(e[t]);return r&=getValueType(e[e.length-1])},toGlsl:function(e,r,t){assertArgsOdd(r),assertArgsMinCount(r,3);var s=void 0!==t?t:ValueTypes.ANY,n=Operators.case.getReturnType(r)&s;assertUniqueInferredType(r,n);for(var o=0;o<r.length-1;o+=2)assertBoolean(r[o]);var u=expressionToGlsl(e,r[r.length-1],n),a=null;for(o=r.length-3;o>=0;o-=2){a="("+expressionToGlsl(e,r[o])+" ? "+expressionToGlsl(e,r[o+1],n)+" : "+(a||u)+")"}return a}};
//# sourceMappingURL=/sm/bd2b52c0f1affec72719c7c6a30756cacf4956ff9d4361603a0e23a14e55295a.map