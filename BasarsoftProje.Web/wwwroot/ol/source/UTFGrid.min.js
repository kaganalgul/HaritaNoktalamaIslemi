/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/source/UTFGrid.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();import EventType from"../events/EventType.js";import SourceState from"./State.js";import Tile from"../Tile.js";import TileSource from"./Tile.js";import TileState from"../TileState.js";import{applyTransform,intersects}from"../extent.js";import{assert}from"../asserts.js";import{createFromTemplates,nullTileUrlFunction}from"../tileurlfunction.js";import{createXYZ,extentFromProjection}from"../tilegrid.js";import{getKeyZXY}from"../tilecoord.js";import{get as getProjection,getTransformFromProjections}from"../proj.js";import{listenOnce}from"../events.js";import{jsonp as requestJSONP}from"../net.js";var CustomTile=function(t){function e(e,i,r,o,n,s){var a=t.call(this,e,i)||this;return a.src_=r,a.extent_=o,a.preemptive_=n,a.grid_=null,a.keys_=null,a.data_=null,a.jsonp_=s,a}return __extends(e,t),e.prototype.getImage=function(){return null},e.prototype.getData=function(t){if(!this.grid_||!this.keys_)return null;var e=(t[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),i=(t[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),r=this.grid_[Math.floor((1-i)*this.grid_.length)];if("string"!=typeof r)return null;var o=r.charCodeAt(Math.floor(e*r.length));o>=93&&o--,o>=35&&o--;var n=null;if((o-=32)in this.keys_){var s=this.keys_[o];n=this.data_&&s in this.data_?this.data_[s]:s}return n},e.prototype.forDataAtCoordinate=function(t,e,i){this.state==TileState.EMPTY&&!0===i?(this.state=TileState.IDLE,listenOnce(this,EventType.CHANGE,(function(i){e(this.getData(t))}),this),this.loadInternal_()):!0===i?setTimeout(function(){e(this.getData(t))}.bind(this),0):e(this.getData(t))},e.prototype.getKey=function(){return this.src_},e.prototype.handleError_=function(){this.state=TileState.ERROR,this.changed()},e.prototype.handleLoad_=function(t){this.grid_=t.grid,this.keys_=t.keys,this.data_=t.data,this.state=TileState.LOADED,this.changed()},e.prototype.loadInternal_=function(){if(this.state==TileState.IDLE)if(this.state=TileState.LOADING,this.jsonp_)requestJSONP(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{var t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",this.src_),t.send()}},e.prototype.onXHRLoad_=function(t){var e=t.target;if(!e.status||e.status>=200&&e.status<300){var i=void 0;try{i=JSON.parse(e.responseText)}catch(t){return void this.handleError_()}this.handleLoad_(i)}else this.handleError_()},e.prototype.onXHRError_=function(t){this.handleError_()},e.prototype.load=function(){this.preemptive_?this.loadInternal_():this.setState(TileState.EMPTY)},e}(Tile);export{CustomTile};var UTFGrid=function(t){function e(e){var i=t.call(this,{projection:getProjection("EPSG:3857"),state:SourceState.LOADING,zDirection:e.zDirection})||this;if(i.preemptive_=void 0===e.preemptive||e.preemptive,i.tileUrlFunction_=nullTileUrlFunction,i.template_=void 0,i.jsonp_=e.jsonp||!1,e.url)if(i.jsonp_)requestJSONP(e.url,i.handleTileJSONResponse.bind(i),i.handleTileJSONError.bind(i));else{var r=new XMLHttpRequest;r.addEventListener("load",i.onXHRLoad_.bind(i)),r.addEventListener("error",i.onXHRError_.bind(i)),r.open("GET",e.url),r.send()}else e.tileJSON?i.handleTileJSONResponse(e.tileJSON):assert(!1,51);return i}return __extends(e,t),e.prototype.onXHRLoad_=function(t){var e=t.target;if(!e.status||e.status>=200&&e.status<300){var i=void 0;try{i=JSON.parse(e.responseText)}catch(t){return void this.handleTileJSONError()}this.handleTileJSONResponse(i)}else this.handleTileJSONError()},e.prototype.onXHRError_=function(t){this.handleTileJSONError()},e.prototype.getTemplate=function(){return this.template_},e.prototype.forDataAtCoordinateAndResolution=function(t,e,i,r){if(this.tileGrid){var o=this.tileGrid.getZForResolution(e,this.zDirection),n=this.tileGrid.getTileCoordForCoordAndZ(t,o);this.getTile(n[0],n[1],n[2],1,this.getProjection()).forDataAtCoordinate(t,i,r)}else!0===r?setTimeout((function(){i(null)}),0):i(null)},e.prototype.handleTileJSONError=function(){this.setState(SourceState.ERROR)},e.prototype.handleTileJSONResponse=function(t){var e,i=getProjection("EPSG:4326"),r=this.getProjection();if(void 0!==t.bounds){var o=getTransformFromProjections(i,r);e=applyTransform(t.bounds,o)}var n=extentFromProjection(r),s=t.minzoom||0,a=t.maxzoom||22,l=createXYZ({extent:n,maxZoom:a,minZoom:s});this.tileGrid=l,this.template_=t.template;var h=t.grids;if(h){if(this.tileUrlFunction_=createFromTemplates(h,l),void 0!==t.attribution){var p=void 0!==e?e:n;this.setAttributions((function(e){return intersects(p,e.extent)?[t.attribution]:null}))}this.setState(SourceState.READY)}else this.setState(SourceState.ERROR)},e.prototype.getTile=function(t,e,i,r,o){var n=getKeyZXY(t,e,i);if(this.tileCache.containsKey(n))return this.tileCache.get(n);var s=[t,e,i],a=this.getTileCoordForTileUrlFunction(s,o),l=this.tileUrlFunction_(a,r,o),h=new CustomTile(s,void 0!==l?TileState.IDLE:TileState.EMPTY,void 0!==l?l:"",this.tileGrid.getTileCoordExtent(s),this.preemptive_,this.jsonp_);return this.tileCache.set(n,h),h},e.prototype.useTile=function(t,e,i){var r=getKeyZXY(t,e,i);this.tileCache.containsKey(r)&&this.tileCache.get(r)},e}(TileSource);export default UTFGrid;
//# sourceMappingURL=/sm/8d05bd676a3991914d4252eaa91c5863ef716aa98c562c98a0154742c57c61a2.map