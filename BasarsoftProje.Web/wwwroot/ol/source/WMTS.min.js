/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/source/WMTS.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();import TileImage from"./TileImage.js";import WMTSRequestEncoding from"./WMTSRequestEncoding.js";import{appendParams}from"../uri.js";import{assign}from"../obj.js";import{containsExtent}from"../extent.js";import{createFromCapabilitiesMatrixSet}from"../tilegrid/WMTS.js";import{createFromTileUrlFunctions,expandUrl}from"../tileurlfunction.js";import{equivalent,get as getProjection,transformExtent}from"../proj.js";import{find,findIndex,includes}from"../array.js";var WMTS=function(t){function e(e){var i=this,n=void 0===e.imageSmoothing||e.imageSmoothing;void 0!==e.interpolate&&(n=e.interpolate);var r=void 0!==e.requestEncoding?e.requestEncoding:WMTSRequestEncoding.KVP,o=e.tileGrid,a=e.urls;return void 0===a&&void 0!==e.url&&(a=expandUrl(e.url)),(i=t.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:n,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:o,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:a,wrapX:void 0!==e.wrapX&&e.wrapX,transition:e.transition,zDirection:e.zDirection})||this).version_=void 0!==e.version?e.version:"1.0.0",i.format_=void 0!==e.format?e.format:"image/jpeg",i.dimensions_=void 0!==e.dimensions?e.dimensions:{},i.layer_=e.layer,i.matrixSet_=e.matrixSet,i.style_=e.style,i.requestEncoding_=r,i.setKey(i.getKeyForDimensions_()),a&&a.length>0&&(i.tileUrlFunction=createFromTileUrlFunctions(a.map(i.createFromWMTSTemplate.bind(i)))),i}return __extends(e,t),e.prototype.setUrls=function(t){this.urls=t;var e=t.join("\n");this.setTileUrlFunction(createFromTileUrlFunctions(t.map(this.createFromWMTSTemplate.bind(this))),e)},e.prototype.getDimensions=function(){return this.dimensions_},e.prototype.getFormat=function(){return this.format_},e.prototype.getLayer=function(){return this.layer_},e.prototype.getMatrixSet=function(){return this.matrixSet_},e.prototype.getRequestEncoding=function(){return this.requestEncoding_},e.prototype.getStyle=function(){return this.style_},e.prototype.getVersion=function(){return this.version_},e.prototype.getKeyForDimensions_=function(){var t=0,e=[];for(var i in this.dimensions_)e[t++]=i+"-"+this.dimensions_[i];return e.join("/")},e.prototype.updateDimensions=function(t){assign(this.dimensions_,t),this.setKey(this.getKeyForDimensions_())},e.prototype.createFromWMTSTemplate=function(t){var e=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};e==WMTSRequestEncoding.KVP&&assign(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t=e==WMTSRequestEncoding.KVP?appendParams(t,i):t.replace(/\{(\w+?)\}/g,(function(t,e){return e.toLowerCase()in i?i[e.toLowerCase()]:t}));var n=this.tileGrid,r=this.dimensions_;return function(i,o,a){if(i){var s={TileMatrix:n.getMatrixId(i[0]),TileCol:i[1],TileRow:i[2]};assign(s,r);var l=t;return l=e==WMTSRequestEncoding.KVP?appendParams(l,s):l.replace(/\{(\w+?)\}/g,(function(t,e){return s[e]}))}}},e}(TileImage);export default WMTS;export function optionsFromCapabilities(t,e){var i=t.Contents.Layer,n=find(i,(function(t,i,n){return t.Identifier==e.layer}));if(null===n)return null;var r,o=t.Contents.TileMatrixSet;(r=n.TileMatrixSetLink.length>1?findIndex(n.TileMatrixSetLink,"projection"in e?function(t,i,n){var r=find(o,(function(e){return e.Identifier==t.TileMatrixSet})).SupportedCRS,a=getProjection(r),s=getProjection(e.projection);return a&&s?equivalent(a,s):r==e.projection}:function(t,i,n){return t.TileMatrixSet==e.matrixSet}):0)<0&&(r=0);var a=n.TileMatrixSetLink[r].TileMatrixSet,s=n.TileMatrixSetLink[r].TileMatrixSetLimits,l=n.Format[0];"format"in e&&(l=e.format),(r=findIndex(n.Style,(function(t,i,n){return"style"in e?t.Title==e.style:t.isDefault})))<0&&(r=0);var u=n.Style[r].Identifier,c={};"Dimension"in n&&n.Dimension.forEach((function(t,e,i){var n=t.Identifier,r=t.Default;void 0===r&&(r=t.Value[0]),c[n]=r}));var p,f=t.Contents.TileMatrixSet,d=find(f,(function(t,e,i){return t.Identifier==a})),m=d.SupportedCRS;if(m&&(p=getProjection(m)),"projection"in e){var g=getProjection(e.projection);g&&(p&&!equivalent(g,p)||(p=g))}var T=!1,h="ne"==p.getAxisOrientation().substr(0,2),S=d.TileMatrix[0],x={MinTileCol:0,MinTileRow:0,MaxTileCol:S.MatrixWidth-1,MaxTileRow:S.MatrixHeight-1};if(s){x=s[s.length-1];var v=find(d.TileMatrix,(function(t){return t.Identifier===x.TileMatrix||d.Identifier+":"+t.Identifier===x.TileMatrix}));v&&(S=v)}var M=28e-5*S.ScaleDenominator/p.getMetersPerUnit(),y=h?[S.TopLeftCorner[1],S.TopLeftCorner[0]]:S.TopLeftCorner,_=S.TileWidth*M,j=S.TileHeight*M,E=d.BoundingBox,C=[y[0]+_*x.MinTileCol,y[1]-j*(1+x.MaxTileRow),y[0]+_*(1+x.MaxTileCol),y[1]-j*x.MinTileRow];if(void 0!==E&&!containsExtent(E,C)){var P=n.WGS84BoundingBox,R=getProjection("EPSG:4326").getExtent();if(C=E,P)T=P[0]===R[0]&&P[2]===R[2];else{var q=transformExtent(E,d.SupportedCRS,"EPSG:4326");T=q[0]-1e-10<=R[0]&&q[2]+1e-10>=R[2]}}var F=createFromCapabilitiesMatrixSet(d,C,s),W=[],w=e.requestEncoding;if(w=void 0!==w?w:"","OperationsMetadata"in t&&"GetTile"in t.OperationsMetadata)for(var b=t.OperationsMetadata.GetTile.DCP.HTTP.Get,I=0,L=b.length;I<L;++I)if(b[I].Constraint){var D=find(b[I].Constraint,(function(t){return"GetEncoding"==t.name})).AllowedValues.Value;if(""===w&&(w=D[0]),w!==WMTSRequestEncoding.KVP)break;includes(D,WMTSRequestEncoding.KVP)&&W.push(b[I].href)}else b[I].href&&(w=WMTSRequestEncoding.KVP,W.push(b[I].href));return 0===W.length&&(w=WMTSRequestEncoding.REST,n.ResourceURL.forEach((function(t){"tile"===t.resourceType&&(l=t.format,W.push(t.template))}))),{urls:W,layer:e.layer,matrixSet:a,format:l,projection:p,requestEncoding:w,tileGrid:F,style:u,dimensions:c,wrapX:T,crossOrigin:e.crossOrigin}}
//# sourceMappingURL=/sm/a79714427ad188ba92e9b6e5f6dd0127af57473fb0d52ee43e6873a075061bc3.map