/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/source/TileImage.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},e(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();import EventType from"../events/EventType.js";import ImageTile from"../ImageTile.js";import ReprojTile from"../reproj/Tile.js";import TileCache from"../TileCache.js";import TileState from"../TileState.js";import UrlTile from"./UrlTile.js";import{ENABLE_RASTER_REPROJECTION}from"../reproj/common.js";import{equivalent,get as getProjection}from"../proj.js";import{getKey,getKeyZXY}from"../tilecoord.js";import{getForProjection as getTileGridForProjection}from"../tilegrid.js";import{getUid}from"../util.js";var TileImage=function(e){function t(t){var i=this,r=void 0===t.imageSmoothing||t.imageSmoothing;return void 0!==t.interpolate&&(r=t.interpolate),(i=e.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:defaultTileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:r,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})||this).crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,i.tileClass=void 0!==t.tileClass?t.tileClass:ImageTile,i.tileCacheForProjection={},i.tileGridForProjection={},i.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,i.renderReprojectionEdges_=!1,i}return __extends(t,e),t.prototype.canExpireCache=function(){if(!ENABLE_RASTER_REPROJECTION)return e.prototype.canExpireCache.call(this);if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1},t.prototype.expireCache=function(t,i){if(ENABLE_RASTER_REPROJECTION){var r=this.getTileCacheForProjection(t);for(var o in this.tileCache.expireCache(this.tileCache==r?i:{}),this.tileCacheForProjection){var n=this.tileCacheForProjection[o];n.expireCache(n==r?i:{})}}else e.prototype.expireCache.call(this,t,i)},t.prototype.getGutterForProjection=function(e){return ENABLE_RASTER_REPROJECTION&&this.getProjection()&&e&&!equivalent(this.getProjection(),e)?0:this.getGutter()},t.prototype.getGutter=function(){return 0},t.prototype.getKey=function(){var t=e.prototype.getKey.call(this);return this.getInterpolate()||(t+=":disable-interpolation"),t},t.prototype.getOpaque=function(t){return!(ENABLE_RASTER_REPROJECTION&&this.getProjection()&&t&&!equivalent(this.getProjection(),t))&&e.prototype.getOpaque.call(this,t)},t.prototype.getTileGridForProjection=function(t){if(!ENABLE_RASTER_REPROJECTION)return e.prototype.getTileGridForProjection.call(this,t);var i=this.getProjection();if(!this.tileGrid||i&&!equivalent(i,t)){var r=getUid(t);return r in this.tileGridForProjection||(this.tileGridForProjection[r]=getTileGridForProjection(t)),this.tileGridForProjection[r]}return this.tileGrid},t.prototype.getTileCacheForProjection=function(t){if(!ENABLE_RASTER_REPROJECTION)return e.prototype.getTileCacheForProjection.call(this,t);var i=this.getProjection();if(!i||equivalent(i,t))return this.tileCache;var r=getUid(t);return r in this.tileCacheForProjection||(this.tileCacheForProjection[r]=new TileCache(this.tileCache.highWaterMark)),this.tileCacheForProjection[r]},t.prototype.createTile_=function(e,t,i,r,o,n){var l=[e,t,i],c=this.getTileCoordForTileUrlFunction(l,o),a=c?this.tileUrlFunction(c,r,o):void 0,s=new this.tileClass(l,void 0!==a?TileState.IDLE:TileState.EMPTY,void 0!==a?a:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return s.key=n,s.addEventListener(EventType.CHANGE,this.handleTileChange.bind(this)),s},t.prototype.getTile=function(e,t,i,r,o){var n=this.getProjection();if(ENABLE_RASTER_REPROJECTION&&n&&o&&!equivalent(n,o)){var l=this.getTileCacheForProjection(o),c=[e,t,i],a=void 0,s=getKey(c);l.containsKey(s)&&(a=l.get(s));var h=this.getKey();if(a&&a.key==h)return a;var p=this.getTileGridForProjection(n),u=this.getTileGridForProjection(o),T=this.getTileCoordForTileUrlFunction(c,o),g=new ReprojTile(n,p,o,u,c,T,this.getTilePixelRatio(r),this.getGutter(),function(e,t,i,r){return this.getTileInternal(e,t,i,r,n)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return g.key=h,a?(g.interimTile=a,g.refreshInterimChain(),l.replace(s,g)):l.set(s,g),g}return this.getTileInternal(e,t,i,r,n||o)},t.prototype.getTileInternal=function(e,t,i,r,o){var n=null,l=getKeyZXY(e,t,i),c=this.getKey();if(this.tileCache.containsKey(l)){if((n=this.tileCache.get(l)).key!=c){var a=n;n=this.createTile_(e,t,i,r,o,c),a.getState()==TileState.IDLE?n.interimTile=a.interimTile:n.interimTile=a,n.refreshInterimChain(),this.tileCache.replace(l,n)}}else n=this.createTile_(e,t,i,r,o,c),this.tileCache.set(l,n);return n},t.prototype.setRenderReprojectionEdges=function(e){if(ENABLE_RASTER_REPROJECTION&&this.renderReprojectionEdges_!=e){for(var t in this.renderReprojectionEdges_=e,this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}},t.prototype.setTileGridForProjection=function(e,t){if(ENABLE_RASTER_REPROJECTION){var i=getProjection(e);if(i){var r=getUid(i);r in this.tileGridForProjection||(this.tileGridForProjection[r]=t)}}},t}(UrlTile);function defaultTileLoadFunction(e,t){e.getImage().src=t}export default TileImage;
//# sourceMappingURL=/sm/2854940ae2cce65d9398c743472a13f83673358a884c0f72dca955f30e0c5393.map