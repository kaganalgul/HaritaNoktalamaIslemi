/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/source/Vector.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();import Collection from"../Collection.js";import CollectionEventType from"../CollectionEventType.js";import Event from"../events/Event.js";import EventType from"../events/EventType.js";import ObjectEventType from"../ObjectEventType.js";import RBush from"../structs/RBush.js";import Source from"./Source.js";import SourceState from"./State.js";import VectorEventType from"./VectorEventType.js";import{TRUE,VOID}from"../functions.js";import{all as allStrategy}from"../loadingstrategy.js";import{assert}from"../asserts.js";import{containsExtent,equals}from"../extent.js";import{extend}from"../array.js";import{getUid}from"../util.js";import{getValues,isEmpty}from"../obj.js";import{listen,unlistenByKey}from"../events.js";import{xhr}from"../featureloader.js";var VectorSourceEvent=function(e){function t(t,r,n){var o=e.call(this,t)||this;return o.feature=r,o.features=n,o}return __extends(t,e),t}(Event);export{VectorSourceEvent};var VectorSource=function(e){function t(t){var r=this,n=t||{};(r=e.call(this,{attributions:n.attributions,interpolate:!0,projection:void 0,state:SourceState.READY,wrapX:void 0===n.wrapX||n.wrapX})||this).on,r.once,r.un,r.loader_=VOID,r.format_=n.format,r.overlaps_=void 0===n.overlaps||n.overlaps,r.url_=n.url,void 0!==n.loader?r.loader_=n.loader:void 0!==r.url_&&(assert(r.format_,7),r.loader_=xhr(r.url_,r.format_)),r.strategy_=void 0!==n.strategy?n.strategy:allStrategy;var o,i,s=void 0===n.useSpatialIndex||n.useSpatialIndex;return r.featuresRtree_=s?new RBush:null,r.loadedExtentsRtree_=new RBush,r.loadingExtentsCount_=0,r.nullGeometryFeatures_={},r.idIndex_={},r.uidIndex_={},r.featureChangeKeys_={},r.featuresCollection_=null,Array.isArray(n.features)?i=n.features:n.features&&(i=(o=n.features).getArray()),s||void 0!==o||(o=new Collection(i)),void 0!==i&&r.addFeaturesInternal(i),void 0!==o&&r.bindFeaturesCollection_(o),r}return __extends(t,e),t.prototype.addFeature=function(e){this.addFeatureInternal(e),this.changed()},t.prototype.addFeatureInternal=function(e){var t=getUid(e);if(this.addToIndex_(t,e)){this.setupChangeEvents_(t,e);var r=e.getGeometry();if(r){var n=r.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE,e))}else this.featuresCollection_&&this.featuresCollection_.remove(e)},t.prototype.setupChangeEvents_=function(e,t){this.featureChangeKeys_[e]=[listen(t,EventType.CHANGE,this.handleFeatureChange_,this),listen(t,ObjectEventType.PROPERTYCHANGE,this.handleFeatureChange_,this)]},t.prototype.addToIndex_=function(e,t){var r=!0,n=t.getId();return void 0!==n&&(n.toString()in this.idIndex_?r=!1:this.idIndex_[n.toString()]=t),r&&(assert(!(e in this.uidIndex_),30),this.uidIndex_[e]=t),r},t.prototype.addFeatures=function(e){this.addFeaturesInternal(e),this.changed()},t.prototype.addFeaturesInternal=function(e){for(var t=[],r=[],n=[],o=0,i=e.length;o<i;o++){var s=e[o],a=getUid(s);this.addToIndex_(a,s)&&r.push(s)}o=0;for(var u=r.length;o<u;o++){s=r[o],a=getUid(s);this.setupChangeEvents_(a,s);var h=s.getGeometry();if(h){var l=h.getExtent();t.push(l),n.push(s)}else this.nullGeometryFeatures_[a]=s}this.featuresRtree_&&this.featuresRtree_.load(t,n);o=0;for(var f=r.length;o<f;o++)this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE,r[o]))},t.prototype.bindFeaturesCollection_=function(e){var t=!1;this.addEventListener(VectorEventType.ADDFEATURE,(function(r){t||(t=!0,e.push(r.feature),t=!1)})),this.addEventListener(VectorEventType.REMOVEFEATURE,(function(r){t||(t=!0,e.remove(r.feature),t=!1)})),e.addEventListener(CollectionEventType.ADD,function(e){t||(t=!0,this.addFeature(e.element),t=!1)}.bind(this)),e.addEventListener(CollectionEventType.REMOVE,function(e){t||(t=!0,this.removeFeature(e.element),t=!1)}.bind(this)),this.featuresCollection_=e},t.prototype.clear=function(e){if(e){for(var t in this.featureChangeKeys_){this.featureChangeKeys_[t].forEach(unlistenByKey)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){var r=function(e){this.removeFeatureInternal(e)}.bind(this);for(var n in this.featuresRtree_.forEach(r),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var o=new VectorSourceEvent(VectorEventType.CLEAR);this.dispatchEvent(o),this.changed()},t.prototype.forEachFeature=function(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},t.prototype.forEachFeatureAtCoordinateDirect=function(e,t){var r=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(r,(function(r){return r.getGeometry().intersectsCoordinate(e)?t(r):void 0}))},t.prototype.forEachFeatureInExtent=function(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},t.prototype.forEachFeatureIntersectingExtent=function(e,t){return this.forEachFeatureInExtent(e,(function(r){if(r.getGeometry().intersectsExtent(e)){var n=t(r);if(n)return n}}))},t.prototype.getFeaturesCollection=function(){return this.featuresCollection_},t.prototype.getFeatures=function(){var e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),isEmpty(this.nullGeometryFeatures_)||extend(e,getValues(this.nullGeometryFeatures_))),e},t.prototype.getFeaturesAtCoordinate=function(e){var t=[];return this.forEachFeatureAtCoordinateDirect(e,(function(e){t.push(e)})),t},t.prototype.getFeaturesInExtent=function(e){return this.featuresRtree_?this.featuresRtree_.getInExtent(e):this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]},t.prototype.getClosestFeatureToCoordinate=function(e,t){var r=e[0],n=e[1],o=null,i=[NaN,NaN],s=1/0,a=[-1/0,-1/0,1/0,1/0],u=t||TRUE;return this.featuresRtree_.forEachInExtent(a,(function(e){if(u(e)){var t=e.getGeometry(),h=s;if((s=t.closestPointXY(r,n,i,s))<h){o=e;var l=Math.sqrt(s);a[0]=r-l,a[1]=n-l,a[2]=r+l,a[3]=n+l}}})),o},t.prototype.getExtent=function(e){return this.featuresRtree_.getExtent(e)},t.prototype.getFeatureById=function(e){var t=this.idIndex_[e.toString()];return void 0!==t?t:null},t.prototype.getFeatureByUid=function(e){var t=this.uidIndex_[e];return void 0!==t?t:null},t.prototype.getFormat=function(){return this.format_},t.prototype.getOverlaps=function(){return this.overlaps_},t.prototype.getUrl=function(){return this.url_},t.prototype.handleFeatureChange_=function(e){var t=e.target,r=getUid(t),n=t.getGeometry();if(n){var o=n.getExtent();r in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[r],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}else r in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[r]=t);var i=t.getId();if(void 0!==i){var s=i.toString();this.idIndex_[s]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[s]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[r]=t;this.changed(),this.dispatchEvent(new VectorSourceEvent(VectorEventType.CHANGEFEATURE,t))},t.prototype.hasFeature=function(e){var t=e.getId();return void 0!==t?t in this.idIndex_:getUid(e)in this.uidIndex_},t.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&isEmpty(this.nullGeometryFeatures_)},t.prototype.loadFeatures=function(e,t,r){for(var n=this.loadedExtentsRtree_,o=this.strategy_(e,t,r),i=function(e,i){var a=o[e];n.forEachInExtent(a,(function(e){return containsExtent(e.extent,a)}))||(++s.loadingExtentsCount_,s.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADSTART)),s.loader_.call(s,a,t,r,function(e){--this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADEND,void 0,e))}.bind(s),function(){--this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADERROR))}.bind(s)),n.insert(a,{extent:a.slice()}))},s=this,a=0,u=o.length;a<u;++a)i(a);this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0},t.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),e.prototype.refresh.call(this)},t.prototype.removeLoadedExtent=function(e){var t,r=this.loadedExtentsRtree_;r.forEachInExtent(e,(function(r){if(equals(r.extent,e))return t=r,!0})),t&&r.remove(t)},t.prototype.removeFeature=function(e){if(e){var t=getUid(e);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e)&&this.changed()}},t.prototype.removeFeatureInternal=function(e){var t=getUid(e),r=this.featureChangeKeys_[t];if(r){r.forEach(unlistenByKey),delete this.featureChangeKeys_[t];var n=e.getId();return void 0!==n&&delete this.idIndex_[n.toString()],delete this.uidIndex_[t],this.dispatchEvent(new VectorSourceEvent(VectorEventType.REMOVEFEATURE,e)),e}},t.prototype.removeFromIdIndex_=function(e){var t=!1;for(var r in this.idIndex_)if(this.idIndex_[r]===e){delete this.idIndex_[r],t=!0;break}return t},t.prototype.setLoader=function(e){this.loader_=e},t.prototype.setUrl=function(e){assert(this.format_,7),this.url_=e,this.setLoader(xhr(e,this.format_))},t}(Source);export default VectorSource;
//# sourceMappingURL=/sm/e7a1fa78342ac1dd52179b31936514ed58e5355e1bc0dd6c7ca30530a0e34049.map