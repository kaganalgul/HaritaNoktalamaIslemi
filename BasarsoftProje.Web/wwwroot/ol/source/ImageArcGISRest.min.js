/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/source/ImageArcGISRest.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();import EventType from"../events/EventType.js";import ImageSource,{defaultImageLoadFunction}from"./Image.js";import ImageWrapper from"../Image.js";import{appendParams}from"../uri.js";import{assert}from"../asserts.js";import{assign}from"../obj.js";import{containsExtent,getHeight,getWidth}from"../extent.js";var ImageArcGISRest=function(t){function e(e){var i=this,r=e||{},o=void 0===r.imageSmoothing||r.imageSmoothing;return void 0!==r.interpolate&&(o=r.interpolate),(i=t.call(this,{attributions:r.attributions,interpolate:o,projection:r.projection,resolutions:r.resolutions})||this).crossOrigin_=void 0!==r.crossOrigin?r.crossOrigin:null,i.hidpi_=void 0===r.hidpi||r.hidpi,i.url_=r.url,i.imageLoadFunction_=void 0!==r.imageLoadFunction?r.imageLoadFunction:defaultImageLoadFunction,i.params_=r.params||{},i.image_=null,i.imageSize_=[0,0],i.renderedRevision_=0,i.ratio_=void 0!==r.ratio?r.ratio:1.5,i}return __extends(e,t),e.prototype.getParams=function(){return this.params_},e.prototype.getImageInternal=function(t,e,i,r){if(void 0===this.url_)return null;e=this.findNearestResolution(e),i=this.hidpi_?i:1;var o=this.image_;if(o&&this.renderedRevision_==this.getRevision()&&o.getResolution()==e&&o.getPixelRatio()==i&&containsExtent(o.getExtent(),t))return o;var n={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};assign(n,this.params_);var a=((t=t.slice())[0]+t[2])/2,s=(t[1]+t[3])/2;if(1!=this.ratio_){var g=this.ratio_*getWidth(t)/2,p=this.ratio_*getHeight(t)/2;t[0]=a-g,t[1]=s-p,t[2]=a+g,t[3]=s+p}var u=e/i,h=Math.ceil(getWidth(t)/u),m=Math.ceil(getHeight(t)/u);t[0]=a-u*h/2,t[2]=a+u*h/2,t[1]=s-u*m/2,t[3]=s+u*m/2,this.imageSize_[0]=h,this.imageSize_[1]=m;var c=this.getRequestUrl_(t,this.imageSize_,i,r,n);return this.image_=new ImageWrapper(t,e,i,c,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),this.image_.addEventListener(EventType.CHANGE,this.handleImageChange.bind(this)),this.image_},e.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},e.prototype.getRequestUrl_=function(t,e,i,r,o){var n=r.getCode().split(/:(?=\d+$)/).pop();o.SIZE=e[0]+","+e[1],o.BBOX=t.join(","),o.BBOXSR=n,o.IMAGESR=n,o.DPI=Math.round(90*i);var a=this.url_,s=a.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return s==a&&assert(!1,50),appendParams(s,o)},e.prototype.getUrl=function(){return this.url_},e.prototype.setImageLoadFunction=function(t){this.image_=null,this.imageLoadFunction_=t,this.changed()},e.prototype.setUrl=function(t){t!=this.url_&&(this.url_=t,this.image_=null,this.changed())},e.prototype.updateParams=function(t){assign(this.params_,t),this.image_=null,this.changed()},e}(ImageSource);export default ImageArcGISRest;
//# sourceMappingURL=/sm/f759e322c759f32fd799b06e37bbfb6a72447c271c6dcfbb8d760a3494d75f46.map