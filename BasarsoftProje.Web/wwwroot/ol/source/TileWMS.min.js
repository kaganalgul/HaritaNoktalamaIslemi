/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/source/TileWMS.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();import{DEFAULT_WMS_VERSION}from"./common.js";import TileImage from"./TileImage.js";import WMSServerType from"./WMSServerType.js";import{appendParams}from"../uri.js";import{assert}from"../asserts.js";import{assign}from"../obj.js";import{buffer,createEmpty}from"../extent.js";import{buffer as bufferSize,scale as scaleSize,toSize}from"../size.js";import{calculateSourceResolution}from"../reproj.js";import{compareVersions}from"../string.js";import{get as getProjection,transform,transformExtent}from"../proj.js";import{modulo}from"../math.js";import{hash as tileCoordHash}from"../tilecoord.js";var TileWMS=function(t){function e(e){var r=this,i=e||{},o=void 0===i.imageSmoothing||i.imageSmoothing;void 0!==i.interpolate&&(o=i.interpolate);var s=i.params||{},a=!("TRANSPARENT"in s)||s.TRANSPARENT;return(r=t.call(this,{attributions:i.attributions,attributionsCollapsible:i.attributionsCollapsible,cacheSize:i.cacheSize,crossOrigin:i.crossOrigin,interpolate:o,opaque:!a,projection:i.projection,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileClass:i.tileClass,tileGrid:i.tileGrid,tileLoadFunction:i.tileLoadFunction,url:i.url,urls:i.urls,wrapX:void 0===i.wrapX||i.wrapX,transition:i.transition,zDirection:i.zDirection})||this).gutter_=void 0!==i.gutter?i.gutter:0,r.params_=s,r.v13_=!0,r.serverType_=i.serverType,r.hidpi_=void 0===i.hidpi||i.hidpi,r.tmpExtent_=createEmpty(),r.updateV13_(),r.setKey(r.getKeyForParams_()),r}return __extends(e,t),e.prototype.getFeatureInfoUrl=function(t,e,r,i){var o=getProjection(r),s=this.getProjection(),a=this.getTileGrid();a||(a=this.getTileGridForProjection(o));var n=a.getZForResolution(e,this.zDirection),p=a.getTileCoordForCoordAndZ(t,n);if(!(a.getResolutions().length<=p[0])){var u=a.getResolution(p[0]),l=a.getTileCoordExtent(p,this.tmpExtent_),S=toSize(a.getTileSize(p[0]),this.tmpSize),h=this.gutter_;0!==h&&(S=bufferSize(S,h,this.tmpSize),l=buffer(l,u*h,l)),s&&s!==o&&(u=calculateSourceResolution(s,o,t,u),l=transformExtent(l,o,s),t=transform(t,o,s));var m={SERVICE:"WMS",VERSION:DEFAULT_WMS_VERSION,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};assign(m,this.params_,i);var c=Math.floor((t[0]-l[0])/u),f=Math.floor((l[3]-t[1])/u);return m[this.v13_?"I":"X"]=c,m[this.v13_?"J":"Y"]=f,this.getRequestUrl_(p,S,l,1,s||o,m)}},e.prototype.getLegendUrl=function(t,e){if(void 0!==this.urls[0]){var r={SERVICE:"WMS",VERSION:DEFAULT_WMS_VERSION,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===e||void 0===e.LAYER){var i=this.params_.LAYERS;if(!(!Array.isArray(i)||1===i.length))return;r.LAYER=i}if(void 0!==t){var o=this.getProjection()?this.getProjection().getMetersPerUnit():1;r.SCALE=t*o/28e-5}return assign(r,e),appendParams(this.urls[0],r)}},e.prototype.getGutter=function(){return this.gutter_},e.prototype.getParams=function(){return this.params_},e.prototype.getRequestUrl_=function(t,e,r,i,o,s){var a=this.urls;if(a){if(s.WIDTH=e[0],s.HEIGHT=e[1],s[this.v13_?"CRS":"SRS"]=o.getCode(),"STYLES"in this.params_||(s.STYLES=""),1!=i)switch(this.serverType_){case WMSServerType.GEOSERVER:var n=90*i+.5|0;"FORMAT_OPTIONS"in s?s.FORMAT_OPTIONS+=";dpi:"+n:s.FORMAT_OPTIONS="dpi:"+n;break;case WMSServerType.MAPSERVER:s.MAP_RESOLUTION=90*i;break;case WMSServerType.CARMENTA_SERVER:case WMSServerType.QGIS:s.DPI=90*i;break;default:assert(!1,52)}var p,u=o.getAxisOrientation(),l=r;if(this.v13_&&"ne"==u.substr(0,2)){var S=void 0;S=r[0],l[0]=r[1],l[1]=S,S=r[2],l[2]=r[3],l[3]=S}if(s.BBOX=l.join(","),1==a.length)p=a[0];else p=a[modulo(tileCoordHash(t),a.length)];return appendParams(p,s)}},e.prototype.getTilePixelRatio=function(t){return this.hidpi_&&void 0!==this.serverType_?t:1},e.prototype.getKeyForParams_=function(){var t=0,e=[];for(var r in this.params_)e[t++]=r+"-"+this.params_[r];return e.join("/")},e.prototype.updateParams=function(t){assign(this.params_,t),this.updateV13_(),this.setKey(this.getKeyForParams_())},e.prototype.updateV13_=function(){var t=this.params_.VERSION||DEFAULT_WMS_VERSION;this.v13_=compareVersions(t,"1.3")>=0},e.prototype.tileUrlFunction=function(t,e,r){var i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(r)),!(i.getResolutions().length<=t[0])){1==e||this.hidpi_&&void 0!==this.serverType_||(e=1);var o=i.getResolution(t[0]),s=i.getTileCoordExtent(t,this.tmpExtent_),a=toSize(i.getTileSize(t[0]),this.tmpSize),n=this.gutter_;0!==n&&(a=bufferSize(a,n,this.tmpSize),s=buffer(s,o*n,s)),1!=e&&(a=scaleSize(a,e,this.tmpSize));var p={SERVICE:"WMS",VERSION:DEFAULT_WMS_VERSION,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};return assign(p,this.params_),this.getRequestUrl_(t,a,s,e,r,p)}},e}(TileImage);export default TileWMS;
//# sourceMappingURL=/sm/8a370614432731191a93991552c3515cd6e8c6b4eb7d8f63f59eea3b282b944f.map