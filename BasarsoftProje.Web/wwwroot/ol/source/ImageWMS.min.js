/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/source/ImageWMS.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();import{DEFAULT_WMS_VERSION}from"./common.js";import EventType from"../events/EventType.js";import ImageSource,{defaultImageLoadFunction}from"./Image.js";import ImageWrapper from"../Image.js";import WMSServerType from"./WMSServerType.js";import{appendParams}from"../uri.js";import{assert}from"../asserts.js";import{assign}from"../obj.js";import{calculateSourceResolution}from"../reproj.js";import{ceil,floor,round}from"../math.js";import{compareVersions}from"../string.js";import{containsExtent,getCenter,getForViewAndSize,getHeight,getWidth}from"../extent.js";import{get as getProjection,transform}from"../proj.js";var DECIMALS=4,GETFEATUREINFO_IMAGE_SIZE=[101,101],ImageWMS=function(t){function e(e){var i=this,r=e||{},o=void 0===r.imageSmoothing||r.imageSmoothing;return void 0!==r.interpolate&&(o=r.interpolate),(i=t.call(this,{attributions:r.attributions,interpolate:o,projection:r.projection,resolutions:r.resolutions})||this).crossOrigin_=void 0!==r.crossOrigin?r.crossOrigin:null,i.url_=r.url,i.imageLoadFunction_=void 0!==r.imageLoadFunction?r.imageLoadFunction:defaultImageLoadFunction,i.params_=r.params||{},i.v13_=!0,i.updateV13_(),i.serverType_=r.serverType,i.hidpi_=void 0===r.hidpi||r.hidpi,i.image_=null,i.imageSize_=[0,0],i.renderedRevision_=0,i.ratio_=void 0!==r.ratio?r.ratio:1.5,i}return __extends(e,t),e.prototype.getFeatureInfoUrl=function(t,e,i,r){if(void 0!==this.url_){var o=getProjection(i),n=this.getProjection();n&&n!==o&&(e=calculateSourceResolution(n,o,t,e),t=transform(t,o,n));var s=getForViewAndSize(t,e,0,GETFEATUREINFO_IMAGE_SIZE),a={SERVICE:"WMS",VERSION:DEFAULT_WMS_VERSION,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};assign(a,this.params_,r);var p=floor((t[0]-s[0])/e,DECIMALS),g=floor((s[3]-t[1])/e,DECIMALS);return a[this.v13_?"I":"X"]=p,a[this.v13_?"J":"Y"]=g,this.getRequestUrl_(s,GETFEATUREINFO_IMAGE_SIZE,1,n||o,a)}},e.prototype.getLegendUrl=function(t,e){if(void 0!==this.url_){var i={SERVICE:"WMS",VERSION:DEFAULT_WMS_VERSION,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===e||void 0===e.LAYER){var r=this.params_.LAYERS;if(!(!Array.isArray(r)||1===r.length))return;i.LAYER=r}if(void 0!==t){var o=this.getProjection()?this.getProjection().getMetersPerUnit():1;i.SCALE=t*o/28e-5}return assign(i,e),appendParams(this.url_,i)}},e.prototype.getParams=function(){return this.params_},e.prototype.getImageInternal=function(t,e,i,r){if(void 0===this.url_)return null;e=this.findNearestResolution(e),1==i||this.hidpi_&&void 0!==this.serverType_||(i=1);var o=e/i,n=getCenter(t),s=ceil(getWidth(t)/o,DECIMALS),a=ceil(getHeight(t)/o,DECIMALS),p=getForViewAndSize(n,o,0,[s,a]),g=ceil(this.ratio_*getWidth(t)/o,DECIMALS),u=ceil(this.ratio_*getHeight(t)/o,DECIMALS),_=getForViewAndSize(n,o,0,[g,u]),h=this.image_;if(h&&this.renderedRevision_==this.getRevision()&&h.getResolution()==e&&h.getPixelRatio()==i&&containsExtent(h.getExtent(),p))return h;var m={SERVICE:"WMS",VERSION:DEFAULT_WMS_VERSION,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};assign(m,this.params_),this.imageSize_[0]=round(getWidth(_)/o,DECIMALS),this.imageSize_[1]=round(getHeight(_)/o,DECIMALS);var S=this.getRequestUrl_(_,this.imageSize_,i,r,m);return this.image_=new ImageWrapper(_,e,i,S,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),this.image_.addEventListener(EventType.CHANGE,this.handleImageChange.bind(this)),this.image_},e.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},e.prototype.getRequestUrl_=function(t,e,i,r,o){if(assert(void 0!==this.url_,9),o[this.v13_?"CRS":"SRS"]=r.getCode(),"STYLES"in this.params_||(o.STYLES=""),1!=i)switch(this.serverType_){case WMSServerType.GEOSERVER:var n=90*i+.5|0;"FORMAT_OPTIONS"in o?o.FORMAT_OPTIONS+=";dpi:"+n:o.FORMAT_OPTIONS="dpi:"+n;break;case WMSServerType.MAPSERVER:o.MAP_RESOLUTION=90*i;break;case WMSServerType.CARMENTA_SERVER:case WMSServerType.QGIS:o.DPI=90*i;break;default:assert(!1,8)}o.WIDTH=e[0],o.HEIGHT=e[1];var s,a=r.getAxisOrientation();return s=this.v13_&&"ne"==a.substr(0,2)?[t[1],t[0],t[3],t[2]]:t,o.BBOX=s.join(","),appendParams(this.url_,o)},e.prototype.getUrl=function(){return this.url_},e.prototype.setImageLoadFunction=function(t){this.image_=null,this.imageLoadFunction_=t,this.changed()},e.prototype.setUrl=function(t){t!=this.url_&&(this.url_=t,this.image_=null,this.changed())},e.prototype.updateParams=function(t){assign(this.params_,t),this.updateV13_(),this.image_=null,this.changed()},e.prototype.updateV13_=function(){var t=this.params_.VERSION||DEFAULT_WMS_VERSION;this.v13_=compareVersions(t,"1.3")>=0},e}(ImageSource);export default ImageWMS;
//# sourceMappingURL=/sm/4e4a6335892c0ee72e4b97197125a0366272af34804ed780c49ee016d2f9566b.map