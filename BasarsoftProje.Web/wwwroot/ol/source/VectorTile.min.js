/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/source/VectorTile.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},e(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();import EventType from"../events/EventType.js";import Tile from"../VectorTile.js";import TileCache from"../TileCache.js";import TileState from"../TileState.js";import UrlTile from"./UrlTile.js";import VectorRenderTile from"../VectorRenderTile.js";import{buffer as bufferExtent,getIntersection,intersects}from"../extent.js";import{createForProjection,createXYZ,extentFromProjection}from"../tilegrid.js";import{fromKey,getCacheKeyForTileKey,getKeyZXY}from"../tilecoord.js";import{isEmpty}from"../obj.js";import{loadFeaturesXhr}from"../featureloader.js";import{toSize}from"../size.js";var VectorTile=function(e){function t(t){var i=this,r=t.projection||"EPSG:3857",o=t.extent||extentFromProjection(r),n=t.tileGrid||createXYZ({extent:o,maxResolution:t.maxResolution,maxZoom:void 0!==t.maxZoom?t.maxZoom:22,minZoom:t.minZoom,tileSize:t.tileSize||512});return(i=e.call(this,{attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,interpolate:!0,opaque:!1,projection:r,state:t.state,tileGrid:n,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:defaultLoadFunction,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,zDirection:void 0===t.zDirection?1:t.zDirection})||this).format_=t.format?t.format:null,i.sourceTileCache=new TileCache(i.tileCache.highWaterMark),i.overlaps_=null==t.overlaps||t.overlaps,i.tileClass=t.tileClass?t.tileClass:Tile,i.tileGrids_={},i}return __extends(t,e),t.prototype.getFeaturesInExtent=function(e){var t=[],i=this.tileCache;if(0===i.getCount())return t;var r=fromKey(i.peekFirstKey())[0],o=this.tileGrid;return i.forEach((function(i){if(i.tileCoord[0]===r&&i.getState()===TileState.LOADED)for(var n=i.getSourceTiles(),l=0,a=n.length;l<a;++l){var s=n[l],c=s.tileCoord;if(intersects(e,o.getTileCoordExtent(c))){var u=s.getFeatures();if(u)for(var h=0,T=u.length;h<T;++h){var p=u[h],f=p.getGeometry();intersects(e,f.getExtent())&&t.push(p)}}}})),t},t.prototype.getOverlaps=function(){return this.overlaps_},t.prototype.clear=function(){this.tileCache.clear(),this.sourceTileCache.clear()},t.prototype.expireCache=function(t,i){var r=this.getTileCacheForProjection(t),o=Object.keys(i).reduce((function(e,t){var i=getCacheKeyForTileKey(t);if(r.containsKey(i))for(var o=r.get(i).sourceTiles,n=0,l=o.length;n<l;++n)e[o[n].getKey()]=!0;return e}),{});e.prototype.expireCache.call(this,t,i),this.sourceTileCache.expireCache(o)},t.prototype.getSourceTiles=function(e,t,i){var r=this;if(i.getState()===TileState.IDLE){i.setState(TileState.LOADING);var o=i.wrappedTileCoord,n=this.getTileGridForProjection(t),l=n.getTileCoordExtent(o),a=o[0],s=n.getResolution(a);bufferExtent(l,-s,l);var c=this.tileGrid,u=c.getExtent();u&&getIntersection(l,u,l);var h=c.getZForResolution(s,1);c.forEachTileCoord(l,h,(function(o){var n=r.tileUrlFunction(o,e,t),l=r.sourceTileCache.containsKey(n)?r.sourceTileCache.get(n):new r.tileClass(o,n?TileState.IDLE:TileState.EMPTY,n,r.format_,r.tileLoadFunction);i.sourceTiles.push(l);var a=l.getState();if(a<TileState.LOADED){var s=function(e){r.handleTileChange(e);var t=l.getState();if(t===TileState.LOADED||t===TileState.ERROR){var o=l.getKey();o in i.errorTileKeys?l.getState()===TileState.LOADED&&delete i.errorTileKeys[o]:i.loadingSourceTiles--,t===TileState.ERROR?i.errorTileKeys[o]=!0:l.removeEventListener(EventType.CHANGE,s),0===i.loadingSourceTiles&&i.setState(isEmpty(i.errorTileKeys)?TileState.LOADED:TileState.ERROR)}};l.addEventListener(EventType.CHANGE,s),i.loadingSourceTiles++}a===TileState.IDLE&&(l.extent=c.getTileCoordExtent(o),l.projection=t,l.resolution=c.getResolution(o[0]),r.sourceTileCache.set(n,l),l.load())})),i.loadingSourceTiles||i.setState(i.sourceTiles.some((function(e){return e.getState()===TileState.ERROR}))?TileState.ERROR:TileState.LOADED)}return i.sourceTiles},t.prototype.getTile=function(e,t,i,r,o){var n,l=getKeyZXY(e,t,i),a=this.getKey();if(this.tileCache.containsKey(l)&&(n=this.tileCache.get(l)).key===a)return n;var s=[e,t,i],c=this.getTileCoordForTileUrlFunction(s,o),u=this.getTileGrid().getExtent(),h=this.getTileGridForProjection(o);if(c&&u){var T=h.getTileCoordExtent(c);bufferExtent(T,-h.getResolution(e),T),intersects(u,T)||(c=null)}var p=!0;if(null!==c){var f=this.tileGrid,d=h.getResolution(e),g=f.getZForResolution(d,1),m=h.getTileCoordExtent(c);bufferExtent(m,-d,m),f.forEachTileCoord(m,g,function(e){p=p&&!this.tileUrlFunction(e,r,o)}.bind(this))}var v=new VectorRenderTile(s,p?TileState.EMPTY:TileState.IDLE,c,this.getSourceTiles.bind(this,r,o));return v.key=a,n?(v.interimTile=n,v.refreshInterimChain(),this.tileCache.replace(l,v)):this.tileCache.set(l,v),v},t.prototype.getTileGridForProjection=function(e){var t=e.getCode(),i=this.tileGrids_[t];if(!i){var r=this.tileGrid;i=createForProjection(e,void 0,r?r.getTileSize(r.getMinZoom()):void 0),this.tileGrids_[t]=i}return i},t.prototype.getTilePixelRatio=function(e){return e},t.prototype.getTilePixelSize=function(e,t,i){var r=this.getTileGridForProjection(i),o=toSize(r.getTileSize(e),this.tmpSize);return[Math.round(o[0]*t),Math.round(o[1]*t)]},t.prototype.updateCacheSize=function(t,i){e.prototype.updateCacheSize.call(this,2*t,i),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(i).highWaterMark},t}(UrlTile);export default VectorTile;export function defaultLoadFunction(e,t){e.setLoader((function(i,r,o){loadFeaturesXhr(t,e.getFormat(),i,r,o,e.onLoad.bind(e),e.onError.bind(e))}))}
//# sourceMappingURL=/sm/850199aa3f80a3cee9891e346511eee3702b45cd5beed9abdcfffdd7fdb322f8.map