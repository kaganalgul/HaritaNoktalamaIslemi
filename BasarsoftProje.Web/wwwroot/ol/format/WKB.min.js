/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/format/WKB.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();import Feature from"../Feature.js";import FeatureFormat,{transformGeometryWithOptions}from"./Feature.js";import FormatType from"./FormatType.js";import GeometryCollection from"../geom/GeometryCollection.js";import GeometryLayout from"../geom/GeometryLayout.js";import GeometryType from"../geom/GeometryType.js";import LineString from"../geom/LineString.js";import MultiLineString from"../geom/MultiLineString.js";import MultiPoint from"../geom/MultiPoint.js";import MultiPolygon from"../geom/MultiPolygon.js";import Point from"../geom/Point.js";import Polygon from"../geom/Polygon.js";import{get as getProjection}from"../proj.js";import SimpleGeometry from"../geom/SimpleGeometry.js";import{assign}from"../obj.js";var WKBGeometryType={POINT:1,LINE_STRING:2,POLYGON:3,MULTI_POINT:4,MULTI_LINE_STRING:5,MULTI_POLYGON:6,GEOMETRY_COLLECTION:7,POLYHEDRAL_SURFACE:15,TIN:16,TRIANGLE:17},WkbReader=function(){function t(t){this.view_=t,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_=GeometryLayout.XY}return t.prototype.readUint8=function(){return this.view_.getUint8(this.pos_++)},t.prototype.readUint32=function(t){return this.view_.getUint32((this.pos_+=4)-4,void 0!==t?t:this.isLittleEndian_)},t.prototype.readDouble=function(t){return this.view_.getFloat64((this.pos_+=8)-8,void 0!==t?t:this.isLittleEndian_)},t.prototype.readPoint=function(){var t=[];return t.push(this.readDouble()),t.push(this.readDouble()),this.hasZ_&&t.push(this.readDouble()),this.hasM_&&t.push(this.readDouble()),t},t.prototype.readLineString=function(){for(var t=this.readUint32(),e=[],r=0;r<t;r++)e.push(this.readPoint());return e},t.prototype.readPolygon=function(){for(var t=this.readUint32(),e=[],r=0;r<t;r++)e.push(this.readLineString());return e},t.prototype.readWkbHeader=function(t){var e=this.readUint8()>0,r=this.readUint32(e),i=Math.floor((268435455&r)/1e3),o=Boolean(2147483648&r)||1===i||3===i,n=Boolean(1073741824&r)||2===i||3===i,a=Boolean(536870912&r),s=(268435455&r)%1e3,y=["XY",o?"Z":"",n?"M":""].join(""),u=a?this.readUint32(e):null;if(void 0!==t&&t!==s)throw new Error("Unexpected WKB geometry type "+s);if(this.initialized_){if(this.isLittleEndian_!==e)throw new Error("Inconsistent endian");if(this.layout_!==y)throw new Error("Inconsistent geometry layout");if(u&&this.srid_!==u)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=e,this.hasZ_=o,this.hasM_=n,this.layout_=y,this.srid_=u,this.initialized_=!0;return s},t.prototype.readWkbPayload=function(t){switch(t){case WKBGeometryType.POINT:return this.readPoint();case WKBGeometryType.LINE_STRING:return this.readLineString();case WKBGeometryType.POLYGON:case WKBGeometryType.TRIANGLE:return this.readPolygon();case WKBGeometryType.MULTI_POINT:return this.readMultiPoint();case WKBGeometryType.MULTI_LINE_STRING:return this.readMultiLineString();case WKBGeometryType.MULTI_POLYGON:case WKBGeometryType.POLYHEDRAL_SURFACE:case WKBGeometryType.TIN:return this.readMultiPolygon();case WKBGeometryType.GEOMETRY_COLLECTION:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+t+" is found")}},t.prototype.readWkbBlock=function(t){return this.readWkbPayload(this.readWkbHeader(t))},t.prototype.readWkbCollection=function(t,e){for(var r=this.readUint32(),i=[],o=0;o<r;o++){var n=t.call(this,e);n&&i.push(n)}return i},t.prototype.readMultiPoint=function(){return this.readWkbCollection(this.readWkbBlock,WKBGeometryType.POINT)},t.prototype.readMultiLineString=function(){return this.readWkbCollection(this.readWkbBlock,WKBGeometryType.LINE_STRING)},t.prototype.readMultiPolygon=function(){return this.readWkbCollection(this.readWkbBlock,WKBGeometryType.POLYGON)},t.prototype.readGeometryCollection=function(){return this.readWkbCollection(this.readGeometry)},t.prototype.readGeometry=function(){var t=this.readWkbHeader(),e=this.readWkbPayload(t);switch(t){case WKBGeometryType.POINT:return new Point(e,this.layout_);case WKBGeometryType.LINE_STRING:return new LineString(e,this.layout_);case WKBGeometryType.POLYGON:case WKBGeometryType.TRIANGLE:return new Polygon(e,this.layout_);case WKBGeometryType.MULTI_POINT:return new MultiPoint(e,this.layout_);case WKBGeometryType.MULTI_LINE_STRING:return new MultiLineString(e,this.layout_);case WKBGeometryType.MULTI_POLYGON:case WKBGeometryType.POLYHEDRAL_SURFACE:case WKBGeometryType.TIN:return new MultiPolygon(e,this.layout_);case WKBGeometryType.GEOMETRY_COLLECTION:return new GeometryCollection(e);default:return null}},t.prototype.getSrid=function(){return this.srid_},t}(),WkbWriter=function(){function t(t){t=t||{},this.layout_=t.layout,this.isLittleEndian_=!1!==t.littleEndian,this.isEWKB_=!1!==t.ewkb,this.writeQueue_=[],this.nodata_=assign({X:0,Y:0,Z:0,M:0},t.nodata)}return t.prototype.writeUint8=function(t){this.writeQueue_.push([1,t])},t.prototype.writeUint32=function(t){this.writeQueue_.push([4,t])},t.prototype.writeDouble=function(t){this.writeQueue_.push([8,t])},t.prototype.writePoint=function(t,e){for(var r=assign.apply(null,e.split("").map((function(e,r){var i;return(i={})[e]=t[r],i}))),i=0,o=this.layout_;i<o.length;i++){var n=o[i];this.writeDouble(n in r?r[n]:this.nodata_[n])}},t.prototype.writeLineString=function(t,e){this.writeUint32(t.length);for(var r=0;r<t.length;r++)this.writePoint(t[r],e)},t.prototype.writePolygon=function(t,e){this.writeUint32(t.length);for(var r=0;r<t.length;r++)this.writeLineString(t[r],e)},t.prototype.writeWkbHeader=function(t,e){t%=1e3,this.layout_.indexOf("Z")>=0&&(t+=this.isEWKB_?2147483648:1e3),this.layout_.indexOf("M")>=0&&(t+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(e)&&(t|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(t),this.isEWKB_&&Number.isInteger(e)&&this.writeUint32(e)},t.prototype.writeMultiPoint=function(t,e){this.writeUint32(t.length);for(var r=0;r<t.length;r++)this.writeWkbHeader(1),this.writePoint(t[r],e)},t.prototype.writeMultiLineString=function(t,e){this.writeUint32(t.length);for(var r=0;r<t.length;r++)this.writeWkbHeader(2),this.writeLineString(t[r],e)},t.prototype.writeMultiPolygon=function(t,e){this.writeUint32(t.length);for(var r=0;r<t.length;r++)this.writeWkbHeader(3),this.writePolygon(t[r],e)},t.prototype.writeGeometryCollection=function(t){this.writeUint32(t.length);for(var e=0;e<t.length;e++)this.writeGeometry(t[e])},t.prototype.findMinimumLayout=function(t,e){void 0===e&&(e=GeometryLayout.XYZM);var r,i;if(t instanceof SimpleGeometry)return(r=t.getLayout())===(i=e)?r:r===GeometryLayout.XYZM?i:i===GeometryLayout.XYZM?r:GeometryLayout.XY;if(t instanceof GeometryCollection)for(var o=t.getGeometriesArray(),n=0;n<o.length&&e!==GeometryLayout.XY;n++)e=this.findMinimumLayout(o[n],e);return e},t.prototype.writeGeometry=function(t,e){var r,i,o=((r={})[GeometryType.POINT]=WKBGeometryType.POINT,r[GeometryType.LINE_STRING]=WKBGeometryType.LINE_STRING,r[GeometryType.POLYGON]=WKBGeometryType.POLYGON,r[GeometryType.MULTI_POINT]=WKBGeometryType.MULTI_POINT,r[GeometryType.MULTI_LINE_STRING]=WKBGeometryType.MULTI_LINE_STRING,r[GeometryType.MULTI_POLYGON]=WKBGeometryType.MULTI_POLYGON,r[GeometryType.GEOMETRY_COLLECTION]=WKBGeometryType.GEOMETRY_COLLECTION,r),n=t.getType(),a=o[n];if(!a)throw new Error("GeometryType "+n+" is not supported");(this.layout_||(this.layout_=this.findMinimumLayout(t)),this.writeWkbHeader(a,e),t instanceof SimpleGeometry)?((i={})[GeometryType.POINT]=this.writePoint,i[GeometryType.LINE_STRING]=this.writeLineString,i[GeometryType.POLYGON]=this.writePolygon,i[GeometryType.MULTI_POINT]=this.writeMultiPoint,i[GeometryType.MULTI_LINE_STRING]=this.writeMultiLineString,i[GeometryType.MULTI_POLYGON]=this.writeMultiPolygon,i)[n].call(this,t.getCoordinates(),t.getLayout()):t instanceof GeometryCollection&&this.writeGeometryCollection(t.getGeometriesArray())},t.prototype.getBuffer=function(){var t=this,e=this.writeQueue_.reduce((function(t,e){return t+e[0]}),0),r=new ArrayBuffer(e),i=new DataView(r),o=0;return this.writeQueue_.forEach((function(e){switch(e[0]){case 1:i.setUint8(o,e[1]);break;case 4:i.setUint32(o,e[1],t.isLittleEndian_);break;case 8:i.setFloat64(o,e[1],t.isLittleEndian_)}o+=e[0]})),r},t}(),WKB=function(t){function e(e){var r=t.call(this)||this,i=e||{};return r.splitCollection=Boolean(i.splitCollection),r.viewCache_=null,r.hex_=!1!==i.hex,r.littleEndian_=!1!==i.littleEndian,r.ewkb_=!1!==i.ewkb,r.layout_=i.geometryLayout,r.nodataZ_=i.nodataZ||0,r.nodataM_=i.nodataM||0,r.srid_=i.srid,r}return __extends(e,t),e.prototype.getType=function(){return this.hex_?FormatType.TEXT:FormatType.ARRAY_BUFFER},e.prototype.readFeature=function(t,e){return new Feature({geometry:this.readGeometry(t,e)})},e.prototype.readFeatures=function(t,e){var r=this.readGeometry(t,e);return(this.splitCollection&&r instanceof GeometryCollection?r.getGeometriesArray():[r]).map((function(t){return new Feature({geometry:t})}))},e.prototype.readGeometry=function(t,e){var r=getDataView(t);if(!r)return null;var i=new WkbReader(r).readGeometry();this.viewCache_=r;var o=this.getReadOptions(t,e);return this.viewCache_=null,transformGeometryWithOptions(i,!1,o)},e.prototype.readProjection=function(t){var e=this.viewCache_||getDataView(t);if(e){var r=new WkbReader(e);return r.readWkbHeader(),r.getSrid()&&getProjection("EPSG:"+r.getSrid())||void 0}},e.prototype.writeFeature=function(t,e){return this.writeGeometry(t.getGeometry(),e)},e.prototype.writeFeatures=function(t,e){return this.writeGeometry(new GeometryCollection(t.map((function(t){return t.getGeometry()}))),e)},e.prototype.writeGeometry=function(t,e){var r=this.adaptOptions(e),i=new WkbWriter({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}}),o=Number.isInteger(this.srid_)?Number(this.srid_):null;if(!1!==this.srid_&&!Number.isInteger(this.srid_)){var n=r.dataProjection&&getProjection(r.dataProjection);if(n){var a=n.getCode();0===a.indexOf("EPSG:")&&(o=Number(a.substring(5)))}}i.writeGeometry(transformGeometryWithOptions(t,!0,r),o);var s=i.getBuffer();return this.hex_?encodeHexString(s):s},e}(FeatureFormat);function encodeHexString(t){var e=new Uint8Array(t);return Array.from(e.values()).map((function(t){return(t<16?"0":"")+Number(t).toString(16).toUpperCase()})).join("")}function decodeHexString(t){for(var e=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)e[r]=parseInt(t.substr(2*r,2),16);return new DataView(e.buffer)}function getDataView(t){return"string"==typeof t?decodeHexString(t):ArrayBuffer.isView(t)?t instanceof DataView?t:new DataView(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer?new DataView(t):null}export default WKB;
//# sourceMappingURL=/sm/326bfb99460c724f2b77e38661198fb3a8db1239cbd2f39460f561e40ec1750c.map