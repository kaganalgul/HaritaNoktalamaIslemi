/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/format/WFS.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();import GML2 from"./GML2.js";import GML3 from"./GML3.js";import GML32 from"./GML32.js";import GMLBase,{GMLNS}from"./GMLBase.js";import XMLFeature from"./XMLFeature.js";import{XML_SCHEMA_INSTANCE_URI,createElementNS,isDocument,makeArrayPusher,makeChildAppender,makeObjectPropertySetter,makeSimpleNodeFactory,parse,parseNode,pushParseAndPop,pushSerializeAndPop}from"../xml.js";import{and as andFilterFn,bbox as bboxFilterFn}from"./filter.js";import{assert}from"../asserts.js";import{assign}from"../obj.js";import{get as getProjection}from"../proj.js";import{readNonNegativeIntegerString,readPositiveInteger,writeStringTextNode}from"./xsd.js";var FEATURE_COLLECTION_PARSERS={"http://www.opengis.net/gml":{boundedBy:makeObjectPropertySetter(GMLBase.prototype.readGeometryElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:makeArrayPusher(GMLBase.prototype.readFeaturesInternal)}},TRANSACTION_SUMMARY_PARSERS={"http://www.opengis.net/wfs":{totalInserted:makeObjectPropertySetter(readPositiveInteger),totalUpdated:makeObjectPropertySetter(readPositiveInteger),totalDeleted:makeObjectPropertySetter(readPositiveInteger)},"http://www.opengis.net/wfs/2.0":{totalInserted:makeObjectPropertySetter(readPositiveInteger),totalUpdated:makeObjectPropertySetter(readPositiveInteger),totalDeleted:makeObjectPropertySetter(readPositiveInteger)}},TRANSACTION_RESPONSE_PARSERS={"http://www.opengis.net/wfs":{TransactionSummary:makeObjectPropertySetter(readTransactionSummary,"transactionSummary"),InsertResults:makeObjectPropertySetter(readInsertResults,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:makeObjectPropertySetter(readTransactionSummary,"transactionSummary"),InsertResults:makeObjectPropertySetter(readInsertResults,"insertIds")}},QUERY_SERIALIZERS={"http://www.opengis.net/wfs":{PropertyName:makeChildAppender(writeStringTextNode)},"http://www.opengis.net/wfs/2.0":{PropertyName:makeChildAppender(writeStringTextNode)}},TRANSACTION_SERIALIZERS={"http://www.opengis.net/wfs":{Insert:makeChildAppender(writeFeature),Update:makeChildAppender(writeUpdate),Delete:makeChildAppender(writeDelete),Property:makeChildAppender(writeProperty),Native:makeChildAppender(writeNative)},"http://www.opengis.net/wfs/2.0":{Insert:makeChildAppender(writeFeature),Update:makeChildAppender(writeUpdate),Delete:makeChildAppender(writeDelete),Property:makeChildAppender(writeProperty),Native:makeChildAppender(writeNative)}},FEATURE_PREFIX="feature",XMLNS="http://www.w3.org/2000/xmlns/",OGCNS={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},WFSNS={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},FESNS={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},SCHEMA_LOCATIONS={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},GML_FORMATS={"2.0.0":GML32,"1.1.0":GML3,"1.0.0":GML2},DEFAULT_VERSION="1.1.0",WFS=function(e){function t(t){var r=e.call(this)||this,i=t||{};return r.version_=i.version?i.version:DEFAULT_VERSION,r.featureType_=i.featureType,r.featureNS_=i.featureNS,r.gmlFormat_=i.gmlFormat?i.gmlFormat:new GML_FORMATS[r.version_],r.schemaLocation_=i.schemaLocation?i.schemaLocation:SCHEMA_LOCATIONS[r.version_],r}return __extends(t,e),t.prototype.getFeatureType=function(){return this.featureType_},t.prototype.setFeatureType=function(e){this.featureType_=e},t.prototype.readFeaturesFromNode=function(e,t){var r={node:e};assign(r,{featureType:this.featureType_,featureNS:this.featureNS_}),assign(r,this.getReadOptions(e,t||{}));var i,n=[r];i="2.0.0"===this.version_?FEATURE_COLLECTION_PARSERS:this.gmlFormat_.FEATURE_COLLECTION_PARSERS;var a=pushParseAndPop([],i,e,n,this.gmlFormat_);return a||(a=[]),a},t.prototype.readTransactionResponse=function(e){if(e){if("string"==typeof e){var t=parse(e);return this.readTransactionResponseFromDocument(t)}return isDocument(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}},t.prototype.readFeatureCollectionMetadata=function(e){if(e){if("string"==typeof e){var t=parse(e);return this.readFeatureCollectionMetadataFromDocument(t)}return isDocument(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}},t.prototype.readFeatureCollectionMetadataFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)},t.prototype.readFeatureCollectionMetadataFromNode=function(e){var t={},r=readNonNegativeIntegerString(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=r,pushParseAndPop(t,FEATURE_COLLECTION_PARSERS,e,[],this.gmlFormat_)},t.prototype.readTransactionResponseFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)},t.prototype.readTransactionResponseFromNode=function(e){return pushParseAndPop({},TRANSACTION_RESPONSE_PARSERS,e,[])},t.prototype.writeGetFeature=function(e){var t=this,r=createElementNS(WFSNS[this.version_],"GetFeature");r.setAttribute("service","WFS"),r.setAttribute("version",this.version_),e.handle&&r.setAttribute("handle",e.handle),e.outputFormat&&r.setAttribute("outputFormat",e.outputFormat),void 0!==e.maxFeatures&&r.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&r.setAttribute("resultType",e.resultType),void 0!==e.startIndex&&r.setAttribute("startIndex",String(e.startIndex)),void 0!==e.count&&r.setAttribute("count",String(e.count)),void 0!==e.viewParams&&r.setAttribute("viewParams",e.viewParams),r.setAttributeNS(XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",this.schemaLocation_);var i={node:r};if(assign(i,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),assert(Array.isArray(e.featureTypes),11),"string"==typeof e.featureTypes[0]){var n=e.filter;e.bbox&&(assert(e.geometryName,12),n=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,n)),assign(i,{geometryName:e.geometryName,filter:n}),writeGetFeature(r,e.featureTypes,[i])}else e.featureTypes.forEach((function(n){var a=t.combineBboxAndFilter(n.geometryName,n.bbox,e.srsName,e.filter);assign(i,{geometryName:n.geometryName,filter:a}),writeGetFeature(r,[n.name],[i])}));return r},t.prototype.combineBboxAndFilter=function(e,t,r,i){var n=bboxFilterFn(e,t,r);return i?andFilterFn(i,n):n},t.prototype.writeTransaction=function(e,t,r,i){var n,a=[],o=i.version?i.version:this.version_,s=createElementNS(WFSNS[o],"Transaction");s.setAttribute("service","WFS"),s.setAttribute("version",o),i&&(n=i.gmlOptions?i.gmlOptions:{},i.handle&&s.setAttribute("handle",i.handle)),s.setAttributeNS(XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",SCHEMA_LOCATIONS[o]);var p=createTransactionRequest(s,n,o,i);return e&&serializeTransactionRequest("Insert",e,a,p),t&&serializeTransactionRequest("Update",t,a,p),r&&serializeTransactionRequest("Delete",r,a,p),i.nativeElements&&serializeTransactionRequest("Native",i.nativeElements,a,p),s},t.prototype.readProjectionFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null},t.prototype.readProjectionFromNode=function(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild)for(var t=(e=e.firstElementChild.firstElementChild).firstElementChild;t;t=t.nextElementSibling)if(0!==t.childNodes.length&&(1!==t.childNodes.length||3!==t.firstChild.nodeType)){var r=[{}];return this.gmlFormat_.readGeometryElement(t,r),getProjection(r.pop().srsName)}return null},t}(XMLFeature);function createTransactionRequest(e,t,r,i){var n,a=i.featurePrefix?i.featurePrefix:FEATURE_PREFIX;return"1.0.0"===r?n=2:"1.1.0"===r?n=3:"2.0.0"===r&&(n=3.2),assign({node:e},{version:r,featureNS:i.featureNS,featureType:i.featureType,featurePrefix:a,gmlVersion:n,hasZ:i.hasZ,srsName:i.srsName},t)}function serializeTransactionRequest(e,t,r,i){pushSerializeAndPop(i,TRANSACTION_SERIALIZERS,makeSimpleNodeFactory(e),t,r)}function readTransactionSummary(e,t){return pushParseAndPop({},TRANSACTION_SUMMARY_PARSERS,e,t)}var OGC_FID_PARSERS={"http://www.opengis.net/ogc":{FeatureId:makeArrayPusher((function(e,t){return e.getAttribute("fid")}))},"http://www.opengis.net/ogc/1.1":{FeatureId:makeArrayPusher((function(e,t){return e.getAttribute("fid")}))}};function fidParser(e,t){parseNode(OGC_FID_PARSERS,e,t)}var INSERT_RESULTS_PARSERS={"http://www.opengis.net/wfs":{Feature:fidParser},"http://www.opengis.net/wfs/2.0":{Feature:fidParser}};function readInsertResults(e,t){return pushParseAndPop([],INSERT_RESULTS_PARSERS,e,t)}function writeFeature(e,t,r){var i=r[r.length-1],n=i.featureType,a=i.featureNS,o=i.gmlVersion,s=createElementNS(a,n);e.appendChild(s),2===o?GML2.prototype.writeFeatureElement(s,t,r):3===o?GML3.prototype.writeFeatureElement(s,t,r):GML32.prototype.writeFeatureElement(s,t,r)}function writeOgcFidFilter(e,t,r){var i=r[r.length-1].version,n=OGCNS[i],a=createElementNS(n,"Filter"),o=createElementNS(n,"FeatureId");a.appendChild(o),o.setAttribute("fid",t),e.appendChild(a)}function getTypeName(e,t){var r=(e=e||FEATURE_PREFIX)+":";return 0===t.indexOf(r)?t:r+t}function writeDelete(e,t,r){var i=r[r.length-1];assert(void 0!==t.getId(),26);var n=i.featureType,a=i.featurePrefix,o=i.featureNS,s=getTypeName(a,n);e.setAttribute("typeName",s),e.setAttributeNS(XMLNS,"xmlns:"+a,o);var p=t.getId();void 0!==p&&writeOgcFidFilter(e,p,r)}function writeUpdate(e,t,r){var i=r[r.length-1];assert(void 0!==t.getId(),27);var n=i.version,a=i.featureType,o=i.featurePrefix,s=i.featureNS,p=getTypeName(o,a),l=t.getGeometryName();e.setAttribute("typeName",p),e.setAttributeNS(XMLNS,"xmlns:"+o,s);var d=t.getId();if(void 0!==d){for(var m=t.getKeys(),u=[],w=0,h=m.length;w<h;w++){var c=t.get(m[w]);if(void 0!==c){var S=m[w];c&&"function"==typeof c.getSimplifiedGeometry&&(S=l),u.push({name:S,value:c})}}pushSerializeAndPop({version:n,gmlVersion:i.gmlVersion,node:e,hasZ:i.hasZ,srsName:i.srsName},TRANSACTION_SERIALIZERS,makeSimpleNodeFactory("Property"),u,r),writeOgcFidFilter(e,d,r)}}function writeProperty(e,t,r){var i=r[r.length-1],n=i.version,a=WFSNS[n],o=createElementNS(a,"Name"),s=i.gmlVersion;if(e.appendChild(o),writeStringTextNode(o,t.name),void 0!==t.value&&null!==t.value){var p=createElementNS(a,"Value");e.appendChild(p),t.value&&"function"==typeof t.value.getSimplifiedGeometry?2===s?GML2.prototype.writeGeometryElement(p,t.value,r):3===s?GML3.prototype.writeGeometryElement(p,t.value,r):GML32.prototype.writeGeometryElement(p,t.value,r):writeStringTextNode(p,t.value)}}function writeNative(e,t,r){t.vendorId&&e.setAttribute("vendorId",t.vendorId),void 0!==t.safeToIgnore&&e.setAttribute("safeToIgnore",String(t.safeToIgnore)),void 0!==t.value&&writeStringTextNode(e,t.value)}var GETFEATURE_SERIALIZERS={"http://www.opengis.net/wfs":{Query:makeChildAppender(writeQuery)},"http://www.opengis.net/wfs/2.0":{Query:makeChildAppender(writeQuery)},"http://www.opengis.net/ogc":{During:makeChildAppender(writeDuringFilter),And:makeChildAppender(writeLogicalFilter),Or:makeChildAppender(writeLogicalFilter),Not:makeChildAppender(writeNotFilter),BBOX:makeChildAppender(writeBboxFilter),Contains:makeChildAppender(writeSpatialFilter),Intersects:makeChildAppender(writeSpatialFilter),Within:makeChildAppender(writeSpatialFilter),DWithin:makeChildAppender(writeDWithinFilter),PropertyIsEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsNotEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsLessThan:makeChildAppender(writeComparisonFilter),PropertyIsLessThanOrEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsGreaterThan:makeChildAppender(writeComparisonFilter),PropertyIsGreaterThanOrEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsNull:makeChildAppender(writeIsNullFilter),PropertyIsBetween:makeChildAppender(writeIsBetweenFilter),PropertyIsLike:makeChildAppender(writeIsLikeFilter)},"http://www.opengis.net/fes/2.0":{During:makeChildAppender(writeDuringFilter),And:makeChildAppender(writeLogicalFilter),Or:makeChildAppender(writeLogicalFilter),Not:makeChildAppender(writeNotFilter),BBOX:makeChildAppender(writeBboxFilter),Contains:makeChildAppender(writeSpatialFilter),Disjoint:makeChildAppender(writeSpatialFilter),Intersects:makeChildAppender(writeSpatialFilter),ResourceId:makeChildAppender(writeResourceIdFilter),Within:makeChildAppender(writeSpatialFilter),DWithin:makeChildAppender(writeDWithinFilter),PropertyIsEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsNotEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsLessThan:makeChildAppender(writeComparisonFilter),PropertyIsLessThanOrEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsGreaterThan:makeChildAppender(writeComparisonFilter),PropertyIsGreaterThanOrEqualTo:makeChildAppender(writeComparisonFilter),PropertyIsNull:makeChildAppender(writeIsNullFilter),PropertyIsBetween:makeChildAppender(writeIsBetweenFilter),PropertyIsLike:makeChildAppender(writeIsLikeFilter)}};function writeQuery(e,t,r){var i,n,a=r[r.length-1],o=a.version,s=a.featurePrefix,p=a.featureNS,l=a.propertyNames,d=a.srsName;i=s?getTypeName(s,t):t,n="2.0.0"===o?"typeNames":"typeName",e.setAttribute(n,i),d&&e.setAttribute("srsName",d),p&&e.setAttributeNS(XMLNS,"xmlns:"+s,p);var m=assign({},a);m.node=e,pushSerializeAndPop(m,QUERY_SERIALIZERS,makeSimpleNodeFactory("PropertyName"),l,r);var u=a.filter;if(u){var w=createElementNS(getFilterNS(o),"Filter");e.appendChild(w),writeFilterCondition(w,u,r)}}function writeFilterCondition(e,t,r){var i=r[r.length-1],n={node:e};assign(n,{context:i}),pushSerializeAndPop(n,GETFEATURE_SERIALIZERS,makeSimpleNodeFactory(t.getTagName()),[t],r)}function writeBboxFilter(e,t,r){var i=r[r.length-1],n=i.context.version;i.srsName=t.srsName;var a=GML_FORMATS[n];writePropertyName(n,e,t.geometryName),a.prototype.writeGeometryElement(e,t.extent,r)}function writeResourceIdFilter(e,t,r){e.setAttribute("rid",t.rid)}function writeSpatialFilter(e,t,r){var i=r[r.length-1],n=i.context.version;i.srsName=t.srsName;var a=GML_FORMATS[n];writePropertyName(n,e,t.geometryName),a.prototype.writeGeometryElement(e,t.geometry,r)}function writeDWithinFilter(e,t,r){var i=r[r.length-1].context.version;writeSpatialFilter(e,t,r);var n=createElementNS(getFilterNS(i),"Distance");writeStringTextNode(n,t.distance.toString()),"2.0.0"===i?n.setAttribute("uom",t.unit):n.setAttribute("units",t.unit),e.appendChild(n)}function writeDuringFilter(e,t,r){var i=r[r.length-1].context.version;writeExpression(FESNS[i],"ValueReference",e,t.propertyName);var n=createElementNS(GMLNS,"TimePeriod");e.appendChild(n);var a=createElementNS(GMLNS,"begin");n.appendChild(a),writeTimeInstant(a,t.begin);var o=createElementNS(GMLNS,"end");n.appendChild(o),writeTimeInstant(o,t.end)}function writeLogicalFilter(e,t,r){var i=r[r.length-1].context,n={node:e};assign(n,{context:i});for(var a=t.conditions,o=0,s=a.length;o<s;++o){var p=a[o];pushSerializeAndPop(n,GETFEATURE_SERIALIZERS,makeSimpleNodeFactory(p.getTagName()),[p],r)}}function writeNotFilter(e,t,r){var i=r[r.length-1].context,n={node:e};assign(n,{context:i});var a=t.condition;pushSerializeAndPop(n,GETFEATURE_SERIALIZERS,makeSimpleNodeFactory(a.getTagName()),[a],r)}function writeComparisonFilter(e,t,r){var i=r[r.length-1].context.version;void 0!==t.matchCase&&e.setAttribute("matchCase",t.matchCase.toString()),writePropertyName(i,e,t.propertyName),writeLiteral(i,e,""+t.expression)}function writeIsNullFilter(e,t,r){writePropertyName(r[r.length-1].context.version,e,t.propertyName)}function writeIsBetweenFilter(e,t,r){var i=r[r.length-1].context.version,n=getFilterNS(i);writePropertyName(i,e,t.propertyName);var a=createElementNS(n,"LowerBoundary");e.appendChild(a),writeLiteral(i,a,""+t.lowerBoundary);var o=createElementNS(n,"UpperBoundary");e.appendChild(o),writeLiteral(i,o,""+t.upperBoundary)}function writeIsLikeFilter(e,t,r){var i=r[r.length-1].context.version;e.setAttribute("wildCard",t.wildCard),e.setAttribute("singleChar",t.singleChar),e.setAttribute("escapeChar",t.escapeChar),void 0!==t.matchCase&&e.setAttribute("matchCase",t.matchCase.toString()),writePropertyName(i,e,t.propertyName),writeLiteral(i,e,""+t.pattern)}function writeExpression(e,t,r,i){var n=createElementNS(e,t);writeStringTextNode(n,i),r.appendChild(n)}function writeLiteral(e,t,r){writeExpression(getFilterNS(e),"Literal",t,r)}function writePropertyName(e,t,r){"2.0.0"===e?writeExpression(FESNS[e],"ValueReference",t,r):writeExpression(OGCNS[e],"PropertyName",t,r)}function writeTimeInstant(e,t){var r=createElementNS(GMLNS,"TimeInstant");e.appendChild(r);var i=createElementNS(GMLNS,"timePosition");r.appendChild(i),writeStringTextNode(i,t)}export function writeFilter(e,t){var r=t||"1.1.0",i=createElementNS(getFilterNS(r),"Filter"),n={node:i};return assign(n,{version:r,filter:e}),writeFilterCondition(i,e,[n]),i}function writeGetFeature(e,t,r){var i=r[r.length-1],n=assign({},i);n.node=e,pushSerializeAndPop(n,GETFEATURE_SERIALIZERS,makeSimpleNodeFactory("Query"),t,r)}function getFilterNS(e){return"2.0.0"===e?FESNS[e]:OGCNS[e]}export default WFS;
//# sourceMappingURL=/sm/bc8eacb12c523b82a8e665dca8a5dc0215c355d610355ca9679f376fa4bb1612.map