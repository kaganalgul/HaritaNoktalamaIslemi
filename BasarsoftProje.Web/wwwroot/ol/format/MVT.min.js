/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/format/MVT.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])},e(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}();import FeatureFormat,{transformGeometryWithOptions}from"./Feature.js";import FormatType from"./FormatType.js";import GeometryLayout from"../geom/GeometryLayout.js";import GeometryType from"../geom/GeometryType.js";import LineString from"../geom/LineString.js";import MultiLineString from"../geom/MultiLineString.js";import MultiPoint from"../geom/MultiPoint.js";import MultiPolygon from"../geom/MultiPolygon.js";import PBF from"pbf";import Point from"../geom/Point.js";import Polygon from"../geom/Polygon.js";import Projection from"../proj/Projection.js";import RenderFeature from"../render/Feature.js";import Units from"../proj/Units.js";import{assert}from"../asserts.js";import{get}from"../proj.js";import{linearRingIsClockwise}from"../geom/flat/orient.js";var MVT=function(e){function r(r){var t=e.call(this)||this,o=r||{};return t.dataProjection=new Projection({code:"",units:Units.TILE_PIXELS}),t.featureClass_=o.featureClass?o.featureClass:RenderFeature,t.geometryName_=o.geometryName,t.layerName_=o.layerName?o.layerName:"layer",t.layers_=o.layers?o.layers:null,t.idProperty_=o.idProperty,t.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"],t}return __extends(r,e),r.prototype.readRawGeometry_=function(e,r,t,o){e.pos=r.geometry;for(var a=e.readVarint()+e.pos,n=1,i=0,s=0,p=0,y=0,l=0;e.pos<a;){if(!i){var u=e.readVarint();n=7&u,i=u>>3}i--,1===n||2===n?(s+=e.readSVarint(),p+=e.readSVarint(),1===n&&y>l&&(o.push(y),l=y),t.push(s,p),y+=2):7===n?y>l&&(t.push(t[l],t[l+1]),y+=2):assert(!1,59)}y>l&&(o.push(y),l=y)},r.prototype.createFeature_=function(e,r,t){var o,a=r.type;if(0===a)return null;var n,i=r.properties;this.idProperty_?(n=i[this.idProperty_],delete i[this.idProperty_]):n=r.id,i[this.layerName_]=r.layer.name;var s=[],p=[];this.readRawGeometry_(e,r,s,p);var y=getGeometryType(a,p.length);if(this.featureClass_===RenderFeature)(o=new this.featureClass_(y,s,p,i,n)).transform(t.dataProjection);else{var l=void 0;if(y==GeometryType.POLYGON){for(var u=[],m=0,f=0,d=0,c=p.length;d<c;++d){var g=p[d];if(linearRingIsClockwise(s,m,g,2)){if(0===u.length)continue;u[u.length-1].push(p[f])}else u.push(p.slice(f,d+1));f=d+1,m=g}l=u.length>1?new MultiPolygon(s,GeometryLayout.XY,u):new Polygon(s,GeometryLayout.XY,p)}else l=y===GeometryType.POINT?new Point(s,GeometryLayout.XY):y===GeometryType.LINE_STRING?new LineString(s,GeometryLayout.XY):y===GeometryType.POLYGON?new Polygon(s,GeometryLayout.XY,p):y===GeometryType.MULTI_POINT?new MultiPoint(s,GeometryLayout.XY):y===GeometryType.MULTI_LINE_STRING?new MultiLineString(s,GeometryLayout.XY,p):null;o=new(0,this.featureClass_),this.geometryName_&&o.setGeometryName(this.geometryName_);var P=transformGeometryWithOptions(l,!1,t);o.setGeometry(P),o.setId(n),o.setProperties(i,!0)}return o},r.prototype.getType=function(){return FormatType.ARRAY_BUFFER},r.prototype.readFeatures=function(e,r){var t=this.layers_,o=this.adaptOptions(r),a=get(o.dataProjection);a.setWorldExtent(o.extent),o.dataProjection=a;var n=new PBF(e),i=n.readFields(layersPBFReader,{}),s=[];for(var p in i)if(!t||-1!=t.indexOf(p)){var y=i[p],l=y?[0,0,y.extent,y.extent]:null;a.setExtent(l);for(var u=0,m=y.length;u<m;++u){var f=readRawFeature(n,y,u),d=this.createFeature_(n,f,o);null!==d&&s.push(d)}}return s},r.prototype.readProjection=function(e){return this.dataProjection},r.prototype.setLayers=function(e){this.layers_=e},r}(FeatureFormat);function layersPBFReader(e,r,t){if(3===e){var o={keys:[],values:[],features:[]},a=t.readVarint()+t.pos;t.readFields(layerPBFReader,o,a),o.length=o.features.length,o.length&&(r[o.name]=o)}}function layerPBFReader(e,r,t){if(15===e)r.version=t.readVarint();else if(1===e)r.name=t.readString();else if(5===e)r.extent=t.readVarint();else if(2===e)r.features.push(t.pos);else if(3===e)r.keys.push(t.readString());else if(4===e){for(var o=null,a=t.readVarint()+t.pos;t.pos<a;)o=1===(e=t.readVarint()>>3)?t.readString():2===e?t.readFloat():3===e?t.readDouble():4===e?t.readVarint64():5===e?t.readVarint():6===e?t.readSVarint():7===e?t.readBoolean():null;r.values.push(o)}}function featurePBFReader(e,r,t){if(1==e)r.id=t.readVarint();else if(2==e)for(var o=t.readVarint()+t.pos;t.pos<o;){var a=r.layer.keys[t.readVarint()],n=r.layer.values[t.readVarint()];r.properties[a]=n}else 3==e?r.type=t.readVarint():4==e&&(r.geometry=t.pos)}function readRawFeature(e,r,t){e.pos=r.features[t];var o=e.readVarint()+e.pos,a={layer:r,type:0,properties:{}};return e.readFields(featurePBFReader,a,o),a}function getGeometryType(e,r){var t;return 1===e?t=1===r?GeometryType.POINT:GeometryType.MULTI_POINT:2===e?t=1===r?GeometryType.LINE_STRING:GeometryType.MULTI_LINE_STRING:3===e&&(t=GeometryType.POLYGON),t}export default MVT;
//# sourceMappingURL=/sm/f13afd97c7071a2723e122aeb87243e746095c53c612defe01aaa6c490ee8179.map