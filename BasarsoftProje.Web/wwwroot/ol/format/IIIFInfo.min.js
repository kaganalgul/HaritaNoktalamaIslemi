/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/format/IIIFInfo.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __spreadArray=this&&this.__spreadArray||function(e,i){for(var o=0,r=i.length,t=e.length;o<r;o++,t++)e[t]=i[o];return e};import{assert}from"../asserts.js";import{includes}from"../array.js";export var Versions={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"};var IIIF_PROFILE_VALUES={};IIIF_PROFILE_VALUES[Versions.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}},IIIF_PROFILE_VALUES[Versions.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}},IIIF_PROFILE_VALUES[Versions.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}},IIIF_PROFILE_VALUES.none={none:{supports:[],formats:[],qualities:[]}};var COMPLIANCE_VERSION1=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,COMPLIANCE_VERSION2=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,COMPLIANCE_VERSION3=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function generateVersion1Options(e){var i=e.getComplianceLevelSupportedFeatures();return void 0===i&&(i=IIIF_PROFILE_VALUES[Versions.VERSION1].level0),{url:void 0===e.imageInfo["@id"]?void 0:e.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:i.supports,formats:__spreadArray(__spreadArray([],i.formats),[void 0===e.imageInfo.formats?[]:e.imageInfo.formats]),qualities:__spreadArray(__spreadArray([],i.qualities),[void 0===e.imageInfo.qualities?[]:e.imageInfo.qualities]),resolutions:e.imageInfo.scale_factors,tileSize:void 0!==e.imageInfo.tile_width?void 0!==e.imageInfo.tile_height?[e.imageInfo.tile_width,e.imageInfo.tile_height]:[e.imageInfo.tile_width,e.imageInfo.tile_width]:null!=e.imageInfo.tile_height?[e.imageInfo.tile_height,e.imageInfo.tile_height]:void 0}}function generateVersion2Options(e){var i=e.getComplianceLevelSupportedFeatures(),o=Array.isArray(e.imageInfo.profile)&&e.imageInfo.profile.length>1,r=o&&e.imageInfo.profile[1].supports?e.imageInfo.profile[1].supports:[],t=o&&e.imageInfo.profile[1].formats?e.imageInfo.profile[1].formats:[],s=o&&e.imageInfo.profile[1].qualities?e.imageInfo.profile[1].qualities:[];return{url:e.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:void 0===e.imageInfo.sizes?void 0:e.imageInfo.sizes.map((function(e){return[e.width,e.height]})),tileSize:void 0===e.imageInfo.tiles?void 0:[e.imageInfo.tiles.map((function(e){return e.width}))[0],e.imageInfo.tiles.map((function(e){return void 0===e.height?e.width:e.height}))[0]],resolutions:void 0===e.imageInfo.tiles?void 0:e.imageInfo.tiles.map((function(e){return e.scaleFactors}))[0],supports:__spreadArray(__spreadArray([],i.supports),r),formats:__spreadArray(__spreadArray([],i.formats),t),qualities:__spreadArray(__spreadArray([],i.qualities),s)}}function generateVersion3Options(e){var i=e.getComplianceLevelSupportedFeatures(),o=void 0===e.imageInfo.extraFormats?i.formats:__spreadArray(__spreadArray([],i.formats),e.imageInfo.extraFormats),r=void 0!==e.imageInfo.preferredFormats&&Array.isArray(e.imageInfo.preferredFormats)&&e.imageInfo.preferredFormats.length>0?e.imageInfo.preferredFormats.filter((function(e){return includes(["jpg","png","gif"],e)})).reduce((function(e,i){return void 0===e&&includes(o,i)?i:e}),void 0):void 0;return{url:e.imageInfo.id,sizes:void 0===e.imageInfo.sizes?void 0:e.imageInfo.sizes.map((function(e){return[e.width,e.height]})),tileSize:void 0===e.imageInfo.tiles?void 0:[e.imageInfo.tiles.map((function(e){return e.width}))[0],e.imageInfo.tiles.map((function(e){return e.height}))[0]],resolutions:void 0===e.imageInfo.tiles?void 0:e.imageInfo.tiles.map((function(e){return e.scaleFactors}))[0],supports:void 0===e.imageInfo.extraFeatures?i.supports:__spreadArray(__spreadArray([],i.supports),e.imageInfo.extraFeatures),formats:o,qualities:void 0===e.imageInfo.extraQualities?i.qualities:__spreadArray(__spreadArray([],i.qualities),e.imageInfo.extraQualities),preferredFormat:r}}var versionFunctions={};versionFunctions[Versions.VERSION1]=generateVersion1Options,versionFunctions[Versions.VERSION2]=generateVersion2Options,versionFunctions[Versions.VERSION3]=generateVersion3Options;var IIIFInfo=function(){function e(e){this.setImageInfo(e)}return e.prototype.setImageInfo=function(e){this.imageInfo="string"==typeof e?JSON.parse(e):e},e.prototype.getImageApiVersion=function(){if(void 0!==this.imageInfo){var e=this.imageInfo["@context"]||"ol-no-context";"string"==typeof e&&(e=[e]);for(var i=0;i<e.length;i++)switch(e[i]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return Versions.VERSION1;case"http://iiif.io/api/image/2/context.json":return Versions.VERSION2;case"http://iiif.io/api/image/3/context.json":return Versions.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(Versions.VERSION1)&&this.imageInfo.identifier)return Versions.VERSION1}assert(!1,61)}},e.prototype.getComplianceLevelEntryFromProfile=function(e){if(void 0!==this.imageInfo&&void 0!==this.imageInfo.profile)switch(void 0===e&&(e=this.getImageApiVersion()),e){case Versions.VERSION1:if(COMPLIANCE_VERSION1.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Versions.VERSION3:if(COMPLIANCE_VERSION3.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Versions.VERSION2:if("string"==typeof this.imageInfo.profile&&COMPLIANCE_VERSION2.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&"string"==typeof this.imageInfo.profile[0]&&COMPLIANCE_VERSION2.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0]}},e.prototype.getComplianceLevelFromProfile=function(e){var i=this.getComplianceLevelEntryFromProfile(e);if(void 0!==i){var o=i.match(/level[0-2](?:\.json)?$/g);return Array.isArray(o)?o[0].replace(".json",""):void 0}},e.prototype.getComplianceLevelSupportedFeatures=function(){if(void 0!==this.imageInfo){var e=this.getImageApiVersion(),i=this.getComplianceLevelFromProfile(e);return void 0===i?IIIF_PROFILE_VALUES.none.none:IIIF_PROFILE_VALUES[e][i]}},e.prototype.getTileSourceOptions=function(e){var i=e||{},o=this.getImageApiVersion();if(void 0!==o){var r=void 0===o?void 0:versionFunctions[o](this);if(void 0!==r)return{url:r.url,version:o,size:[this.imageInfo.width,this.imageInfo.height],sizes:r.sizes,format:void 0!==i.format&&includes(r.formats,i.format)?i.format:void 0!==r.preferredFormat?r.preferredFormat:"jpg",supports:r.supports,quality:i.quality&&includes(r.qualities,i.quality)?i.quality:includes(r.qualities,"native")?"native":"default",resolutions:Array.isArray(r.resolutions)?r.resolutions.sort((function(e,i){return i-e})):void 0,tileSize:r.tileSize}}},e}();export default IIIFInfo;
//# sourceMappingURL=/sm/3062d4ef58457b9b3cdc50c4596afec9bdffdc6f5c727c3564cd27afd698d1b2.map