/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/format/KML.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();import Feature from"../Feature.js";import Fill from"../style/Fill.js";import GeometryCollection from"../geom/GeometryCollection.js";import GeometryLayout from"../geom/GeometryLayout.js";import GeometryType from"../geom/GeometryType.js";import Icon from"../style/Icon.js";import IconAnchorUnits from"../style/IconAnchorUnits.js";import IconOrigin from"../style/IconOrigin.js";import ImageState from"../ImageState.js";import LineString from"../geom/LineString.js";import MultiLineString from"../geom/MultiLineString.js";import MultiPoint from"../geom/MultiPoint.js";import MultiPolygon from"../geom/MultiPolygon.js";import Point from"../geom/Point.js";import Polygon from"../geom/Polygon.js";import Stroke from"../style/Stroke.js";import Style from"../style/Style.js";import Text from"../style/Text.js";import XMLFeature from"./XMLFeature.js";import{OBJECT_PROPERTY_NODE_FACTORY,XML_SCHEMA_INSTANCE_URI,createElementNS,getAllTextContent,isDocument,makeArrayExtender,makeArrayPusher,makeChildAppender,makeObjectPropertySetter,makeReplacer,makeSequence,makeSimpleNodeFactory,makeStructureNS,parse,parseNode,pushParseAndPop,pushSerializeAndPop}from"../xml.js";import{asArray}from"../color.js";import{assert}from"../asserts.js";import{extend,includes}from"../array.js";import{get as getProjection}from"../proj.js";import{readBoolean,readDecimal,readString,writeBooleanTextNode,writeCDATASection,writeDecimalTextNode,writeStringTextNode}from"./xsd.js";import{toRadians}from"../math.js";import{transformGeometryWithOptions}from"./Feature.js";var DEFAULT_COLOR,DEFAULT_IMAGE_STYLE_ANCHOR,DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS,DEFAULT_IMAGE_STYLE_SIZE,DEFAULT_IMAGE_STYLE_SRC,GX_NAMESPACE_URIS=["http://www.google.com/kml/ext/2.2"],NAMESPACE_URIS=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],SCHEMA_LOCATION="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",ICON_ANCHOR_UNITS_MAP={fraction:IconAnchorUnits.FRACTION,pixels:IconAnchorUnits.PIXELS,insetPixels:IconAnchorUnits.PIXELS},PLACEMARK_PARSERS=makeStructureNS(NAMESPACE_URIS,{ExtendedData:extendedDataParser,Region:regionParser,MultiGeometry:makeObjectPropertySetter(readMultiGeometry,"geometry"),LineString:makeObjectPropertySetter(readLineString,"geometry"),LinearRing:makeObjectPropertySetter(readLinearRing,"geometry"),Point:makeObjectPropertySetter(readPoint,"geometry"),Polygon:makeObjectPropertySetter(readPolygon,"geometry"),Style:makeObjectPropertySetter(readStyle),StyleMap:placemarkStyleMapParser,address:makeObjectPropertySetter(readString),description:makeObjectPropertySetter(readString),name:makeObjectPropertySetter(readString),open:makeObjectPropertySetter(readBoolean),phoneNumber:makeObjectPropertySetter(readString),styleUrl:makeObjectPropertySetter(readStyleURL),visibility:makeObjectPropertySetter(readBoolean)},makeStructureNS(GX_NAMESPACE_URIS,{MultiTrack:makeObjectPropertySetter(readGxMultiTrack,"geometry"),Track:makeObjectPropertySetter(readGxTrack,"geometry")})),NETWORK_LINK_PARSERS=makeStructureNS(NAMESPACE_URIS,{ExtendedData:extendedDataParser,Region:regionParser,Link:linkParser,address:makeObjectPropertySetter(readString),description:makeObjectPropertySetter(readString),name:makeObjectPropertySetter(readString),open:makeObjectPropertySetter(readBoolean),phoneNumber:makeObjectPropertySetter(readString),visibility:makeObjectPropertySetter(readBoolean)}),LINK_PARSERS=makeStructureNS(NAMESPACE_URIS,{href:makeObjectPropertySetter(readURI)}),REGION_PARSERS=makeStructureNS(NAMESPACE_URIS,{LatLonAltBox:latLonAltBoxParser,Lod:lodParser}),KML_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["Document","Placemark"]),KML_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{Document:makeChildAppender(writeDocument),Placemark:makeChildAppender(writePlacemark)}),DEFAULT_FILL_STYLE=null;export function getDefaultFillStyle(){return DEFAULT_FILL_STYLE}var DEFAULT_NO_IMAGE_STYLE,DEFAULT_IMAGE_STYLE=null;export function getDefaultImageStyle(){return DEFAULT_IMAGE_STYLE}var DEFAULT_TEXT_STROKE_STYLE,DEFAULT_STROKE_STYLE=null;export function getDefaultStrokeStyle(){return DEFAULT_STROKE_STYLE}var DEFAULT_TEXT_STYLE=null;export function getDefaultTextStyle(){return DEFAULT_TEXT_STYLE}var DEFAULT_STYLE=null;export function getDefaultStyle(){return DEFAULT_STYLE}var TEXTAREA,DEFAULT_STYLE_ARRAY=null;export function getDefaultStyleArray(){return DEFAULT_STYLE_ARRAY}function scaleForSize(e){return 32/Math.min(e[0],e[1])}function createStyleDefaults(){DEFAULT_FILL_STYLE=new Fill({color:DEFAULT_COLOR=[255,255,255,1]}),DEFAULT_IMAGE_STYLE_ANCHOR=[20,2],DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS=IconAnchorUnits.PIXELS,DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS=IconAnchorUnits.PIXELS,DEFAULT_IMAGE_STYLE_SIZE=[64,64],DEFAULT_IMAGE_STYLE_SRC="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",DEFAULT_IMAGE_STYLE=new Icon({anchor:DEFAULT_IMAGE_STYLE_ANCHOR,anchorOrigin:IconOrigin.BOTTOM_LEFT,anchorXUnits:DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,anchorYUnits:DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS,crossOrigin:"anonymous",rotation:0,scale:scaleForSize(DEFAULT_IMAGE_STYLE_SIZE),size:DEFAULT_IMAGE_STYLE_SIZE,src:DEFAULT_IMAGE_STYLE_SRC}),DEFAULT_NO_IMAGE_STYLE="NO_IMAGE",DEFAULT_STROKE_STYLE=new Stroke({color:DEFAULT_COLOR,width:1}),DEFAULT_TEXT_STROKE_STYLE=new Stroke({color:[51,51,51,1],width:2}),DEFAULT_TEXT_STYLE=new Text({font:"bold 16px Helvetica",fill:DEFAULT_FILL_STYLE,stroke:DEFAULT_TEXT_STROKE_STYLE,scale:.8}),DEFAULT_STYLE=new Style({fill:DEFAULT_FILL_STYLE,image:DEFAULT_IMAGE_STYLE,text:DEFAULT_TEXT_STYLE,stroke:DEFAULT_STROKE_STYLE,zIndex:0}),DEFAULT_STYLE_ARRAY=[DEFAULT_STYLE]}function defaultIconUrlFunction(e){return e}var KML=function(e){function t(t){var r=e.call(this)||this,a=t||{};return DEFAULT_STYLE_ARRAY||createStyleDefaults(),r.dataProjection=getProjection("EPSG:4326"),r.defaultStyle_=a.defaultStyle?a.defaultStyle:DEFAULT_STYLE_ARRAY,r.extractStyles_=void 0===a.extractStyles||a.extractStyles,r.writeStyles_=void 0===a.writeStyles||a.writeStyles,r.sharedStyles_={},r.showPointNames_=void 0===a.showPointNames||a.showPointNames,r.crossOrigin_=void 0!==a.crossOrigin?a.crossOrigin:"anonymous",r.iconUrlFunction_=a.iconUrlFunction?a.iconUrlFunction:defaultIconUrlFunction,r.supportedMediaTypes=["application/vnd.google-earth.kml+xml"],r}return __extends(t,e),t.prototype.readDocumentOrFolder_=function(e,t){var r=makeStructureNS(NAMESPACE_URIS,{Document:makeArrayExtender(this.readDocumentOrFolder_,this),Folder:makeArrayExtender(this.readDocumentOrFolder_,this),Placemark:makeArrayPusher(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),a=pushParseAndPop([],r,e,t,this);return a||void 0},t.prototype.readPlacemark_=function(e,t){var r=pushParseAndPop({geometry:null},PLACEMARK_PARSERS,e,t,this);if(r){var a=new Feature,o=e.getAttribute("id");null!==o&&a.setId(o);var n=t[0],i=r.geometry;if(i&&transformGeometryWithOptions(i,!1,n),a.setGeometry(i),delete r.geometry,this.extractStyles_){var S=createFeatureStyleFunction(r.Style,r.styleUrl,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);a.setStyle(S)}return delete r.Style,a.setProperties(r,!0),a}},t.prototype.readSharedStyle_=function(e,t){var r=e.getAttribute("id");if(null!==r){var a=readStyle.call(this,e,t);if(a){var o=void 0,n=e.baseURI;if(n&&"about:blank"!=n||(n=window.location.href),n)o=new URL("#"+r,n).href;else o="#"+r;this.sharedStyles_[o]=a}}},t.prototype.readSharedStyleMap_=function(e,t){var r=e.getAttribute("id");if(null!==r){var a=readStyleMapValue.call(this,e,t);if(a){var o,n=e.baseURI;if(n&&"about:blank"!=n||(n=window.location.href),n)o=new URL("#"+r,n).href;else o="#"+r;this.sharedStyles_[o]=a}}},t.prototype.readFeatureFromNode=function(e,t){if(!includes(NAMESPACE_URIS,e.namespaceURI))return null;var r=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return r||null},t.prototype.readFeaturesFromNode=function(e,t){if(!includes(NAMESPACE_URIS,e.namespaceURI))return[];var r,a=e.localName;if("Document"==a||"Folder"==a)return(r=this.readDocumentOrFolder_(e,[this.getReadOptions(e,t)]))||[];if("Placemark"==a){var o=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return o?[o]:[]}if("kml"==a){r=[];for(var n=e.firstElementChild;n;n=n.nextElementSibling){var i=this.readFeaturesFromNode(n,t);i&&extend(r,i)}return r}return[]},t.prototype.readName=function(e){if(e){if("string"==typeof e){var t=parse(e);return this.readNameFromDocument(t)}return isDocument(e)?this.readNameFromDocument(e):this.readNameFromNode(e)}},t.prototype.readNameFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE){var r=this.readNameFromNode(t);if(r)return r}},t.prototype.readNameFromNode=function(e){for(var t=e.firstElementChild;t;t=t.nextElementSibling)if(includes(NAMESPACE_URIS,t.namespaceURI)&&"name"==t.localName)return readString(t);for(t=e.firstElementChild;t;t=t.nextElementSibling){var r=t.localName;if(includes(NAMESPACE_URIS,t.namespaceURI)&&("Document"==r||"Folder"==r||"Placemark"==r||"kml"==r)){var a=this.readNameFromNode(t);if(a)return a}}},t.prototype.readNetworkLinks=function(e){var t=[];if("string"==typeof e){var r=parse(e);extend(t,this.readNetworkLinksFromDocument(r))}else isDocument(e)?extend(t,this.readNetworkLinksFromDocument(e)):extend(t,this.readNetworkLinksFromNode(e));return t},t.prototype.readNetworkLinksFromDocument=function(e){for(var t=[],r=e.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&extend(t,this.readNetworkLinksFromNode(r));return t},t.prototype.readNetworkLinksFromNode=function(e){for(var t=[],r=e.firstElementChild;r;r=r.nextElementSibling)if(includes(NAMESPACE_URIS,r.namespaceURI)&&"NetworkLink"==r.localName){var a=pushParseAndPop({},NETWORK_LINK_PARSERS,r,[]);t.push(a)}for(r=e.firstElementChild;r;r=r.nextElementSibling){var o=r.localName;!includes(NAMESPACE_URIS,r.namespaceURI)||"Document"!=o&&"Folder"!=o&&"kml"!=o||extend(t,this.readNetworkLinksFromNode(r))}return t},t.prototype.readRegion=function(e){var t=[];if("string"==typeof e){var r=parse(e);extend(t,this.readRegionFromDocument(r))}else isDocument(e)?extend(t,this.readRegionFromDocument(e)):extend(t,this.readRegionFromNode(e));return t},t.prototype.readRegionFromDocument=function(e){for(var t=[],r=e.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&extend(t,this.readRegionFromNode(r));return t},t.prototype.readRegionFromNode=function(e){for(var t=[],r=e.firstElementChild;r;r=r.nextElementSibling)if(includes(NAMESPACE_URIS,r.namespaceURI)&&"Region"==r.localName){var a=pushParseAndPop({},REGION_PARSERS,r,[]);t.push(a)}for(r=e.firstElementChild;r;r=r.nextElementSibling){var o=r.localName;!includes(NAMESPACE_URIS,r.namespaceURI)||"Document"!=o&&"Folder"!=o&&"kml"!=o||extend(t,this.readRegionFromNode(r))}return t},t.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);var r=createElementNS(NAMESPACE_URIS[4],"kml"),a="http://www.w3.org/2000/xmlns/";r.setAttributeNS(a,"xmlns:gx",GX_NAMESPACE_URIS[0]),r.setAttributeNS(a,"xmlns:xsi",XML_SCHEMA_INSTANCE_URI),r.setAttributeNS(XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",SCHEMA_LOCATION);var o={node:r},n={};e.length>1?n.Document=e:1==e.length&&(n.Placemark=e[0]);var i=KML_SEQUENCE[r.namespaceURI],S=makeSequence(n,i);return pushSerializeAndPop(o,KML_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,S,[t],i,this),r},t}(XMLFeature);function createNameStyleFunction(e,t){var r=[0,0],a="start",o=e.getImage();if(o){var n=o.getSize();if(n&&2==n.length){var i=o.getScaleArray(),S=o.getAnchor();r[0]=i[0]*(n[0]-S[0]),r[1]=i[1]*(n[1]/2-S[1]),a="left"}}var l=e.getText();return l?((l=l.clone()).setFont(l.getFont()||DEFAULT_TEXT_STYLE.getFont()),l.setScale(l.getScale()||DEFAULT_TEXT_STYLE.getScale()),l.setFill(l.getFill()||DEFAULT_TEXT_STYLE.getFill()),l.setStroke(l.getStroke()||DEFAULT_TEXT_STROKE_STYLE)):l=DEFAULT_TEXT_STYLE.clone(),l.setText(t),l.setOffsetX(r[0]),l.setOffsetY(r[1]),l.setTextAlign(a),new Style({image:o,text:l})}function createFeatureStyleFunction(e,t,r,a,o){return function(n,i){var S=o,l="",E=[];if(S){var s=n.getGeometry();if(s){var A=s.getType();A===GeometryType.GEOMETRY_COLLECTION?(E=s.getGeometriesArrayRecursive().filter((function(e){var t=e.getType();return t===GeometryType.POINT||t===GeometryType.MULTI_POINT})),S=E.length>0):S=A===GeometryType.POINT||A===GeometryType.MULTI_POINT}}S&&(l=n.get("name"),(S=S&&!!l)&&l.search(/&[^&]+;/)>-1&&(TEXTAREA||(TEXTAREA=document.createElement("textarea")),TEXTAREA.innerHTML=l,l=TEXTAREA.value));var m=r;if(e?m=e:t&&(m=findStyle(t,r,a)),S){var d=createNameStyleFunction(m[0],l);return E.length>0?(d.setGeometry(new GeometryCollection(E)),[d,new Style({geometry:m[0].getGeometry(),image:null,fill:m[0].getFill(),stroke:m[0].getStroke(),text:null})].concat(m.slice(1))):d}return m}}function findStyle(e,t,r){return Array.isArray(e)?e:"string"==typeof e?findStyle(r[e],t,r):t}function readColor(e){var t=getAllTextContent(e,!1),r=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t);if(r){var a=r[1];return[parseInt(a.substr(6,2),16),parseInt(a.substr(4,2),16),parseInt(a.substr(2,2),16),parseInt(a.substr(0,2),16)/255]}}export function readFlatCoordinates(e){var t=getAllTextContent(e,!1),r=[];t=t.replace(/\s*,\s*/g,",");for(var a,o=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;a=o.exec(t);){var n=parseFloat(a[1]),i=parseFloat(a[2]),S=a[3]?parseFloat(a[3]):0;r.push(n,i,S),t=t.substr(a[0].length)}if(""===t)return r}function readURI(e){var t=getAllTextContent(e,!1).trim(),r=e.baseURI;return r&&"about:blank"!=r||(r=window.location.href),r?new URL(t,r).href:t}function readStyleURL(e){var t=getAllTextContent(e,!1).trim().replace(/^(?!.*#)/,"#"),r=e.baseURI;return r&&"about:blank"!=r||(r=window.location.href),r?new URL(t,r).href:t}function readVec2(e){var t,r=e.getAttribute("xunits"),a=e.getAttribute("yunits");return t="insetPixels"!==r?"insetPixels"!==a?IconOrigin.BOTTOM_LEFT:IconOrigin.TOP_LEFT:"insetPixels"!==a?IconOrigin.BOTTOM_RIGHT:IconOrigin.TOP_RIGHT,{x:parseFloat(e.getAttribute("x")),xunits:ICON_ANCHOR_UNITS_MAP[r],y:parseFloat(e.getAttribute("y")),yunits:ICON_ANCHOR_UNITS_MAP[a],origin:t}}function readScale(e){return readDecimal(e)}var STYLE_MAP_PARSERS=makeStructureNS(NAMESPACE_URIS,{Pair:pairDataParser});function readStyleMapValue(e,t){return pushParseAndPop(void 0,STYLE_MAP_PARSERS,e,t,this)}var ICON_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{Icon:makeObjectPropertySetter(readIcon),color:makeObjectPropertySetter(readColor),heading:makeObjectPropertySetter(readDecimal),hotSpot:makeObjectPropertySetter(readVec2),scale:makeObjectPropertySetter(readScale)});function iconStyleParser(e,t){var r=pushParseAndPop({},ICON_STYLE_PARSERS,e,t);if(r){var a,o,n,i,S=t[t.length-1],l="Icon"in r?r.Icon:{},E=!("Icon"in r)||Object.keys(l).length>0,s=l.href;s?a=s:E&&(a=DEFAULT_IMAGE_STYLE_SRC);var A,m=IconOrigin.BOTTOM_LEFT,d=r.hotSpot;d?(o=[d.x,d.y],n=d.xunits,i=d.yunits,m=d.origin):/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(a)&&(/pushpin/.test(a)?(o=DEFAULT_IMAGE_STYLE_ANCHOR,n=DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,i=DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS):/arrow-reverse/.test(a)?(o=[54,42],n=DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,i=DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS):/paddle/.test(a)&&(o=[32,1],n=DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,i=DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS));var _,u=l.x,c=l.y;void 0!==u&&void 0!==c&&(A=[u,c]);var T,p=l.w,y=l.h;void 0!==p&&void 0!==y&&(_=[p,y]);var R=r.heading;void 0!==R&&(T=toRadians(R));var N=r.scale,P=r.color;if(E){a==DEFAULT_IMAGE_STYLE_SRC&&(_=DEFAULT_IMAGE_STYLE_SIZE);var L=new Icon({anchor:o,anchorOrigin:m,anchorXUnits:n,anchorYUnits:i,crossOrigin:this.crossOrigin_,offset:A,offsetOrigin:IconOrigin.BOTTOM_LEFT,rotation:T,scale:N,size:_,src:this.iconUrlFunction_(a),color:P}),I=L.getScaleArray()[0],O=L.getSize();if(null===O){var g=L.getImageState();if(g===ImageState.IDLE||g===ImageState.LOADING){var h=function(){var e=L.getImageState();if(e!==ImageState.IDLE&&e!==ImageState.LOADING){var t=L.getSize();if(t&&2==t.length){var r=scaleForSize(t);L.setScale(I*r)}L.unlistenImageChange(h)}};L.listenImageChange(h),g===ImageState.IDLE&&L.load()}}else if(2==O.length){var C=scaleForSize(O);L.setScale(I*C)}S.imageStyle=L}else S.imageStyle=DEFAULT_NO_IMAGE_STYLE}}var LABEL_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{color:makeObjectPropertySetter(readColor),scale:makeObjectPropertySetter(readScale)});function labelStyleParser(e,t){var r=pushParseAndPop({},LABEL_STYLE_PARSERS,e,t);if(r){var a=t[t.length-1],o=new Text({fill:new Fill({color:"color"in r?r.color:DEFAULT_COLOR}),scale:r.scale});a.textStyle=o}}var LINE_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{color:makeObjectPropertySetter(readColor),width:makeObjectPropertySetter(readDecimal)});function lineStyleParser(e,t){var r=pushParseAndPop({},LINE_STYLE_PARSERS,e,t);if(r){var a=t[t.length-1],o=new Stroke({color:"color"in r?r.color:DEFAULT_COLOR,width:"width"in r?r.width:1});a.strokeStyle=o}}var POLY_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{color:makeObjectPropertySetter(readColor),fill:makeObjectPropertySetter(readBoolean),outline:makeObjectPropertySetter(readBoolean)});function polyStyleParser(e,t){var r=pushParseAndPop({},POLY_STYLE_PARSERS,e,t);if(r){var a=t[t.length-1],o=new Fill({color:"color"in r?r.color:DEFAULT_COLOR});a.fillStyle=o;var n=r.fill;void 0!==n&&(a.fill=n);var i=r.outline;void 0!==i&&(a.outline=i)}}var FLAT_LINEAR_RING_PARSERS=makeStructureNS(NAMESPACE_URIS,{coordinates:makeReplacer(readFlatCoordinates)});function readFlatLinearRing(e,t){return pushParseAndPop(null,FLAT_LINEAR_RING_PARSERS,e,t)}function gxCoordParser(e,t){var r=t[t.length-1].coordinates,a=getAllTextContent(e,!1),o=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(a);if(o){var n=parseFloat(o[1]),i=parseFloat(o[2]),S=parseFloat(o[3]);r.push([n,i,S])}else r.push([])}var GX_MULTITRACK_GEOMETRY_PARSERS=makeStructureNS(GX_NAMESPACE_URIS,{Track:makeArrayPusher(readGxTrack)});function readGxMultiTrack(e,t){var r=pushParseAndPop([],GX_MULTITRACK_GEOMETRY_PARSERS,e,t);if(r)return new MultiLineString(r)}var GX_TRACK_PARSERS=makeStructureNS(NAMESPACE_URIS,{when:whenParser},makeStructureNS(GX_NAMESPACE_URIS,{coord:gxCoordParser}));function readGxTrack(e,t){var r=pushParseAndPop({coordinates:[],whens:[]},GX_TRACK_PARSERS,e,t);if(r){for(var a=[],o=r.coordinates,n=r.whens,i=0,S=Math.min(o.length,n.length);i<S;++i)3==o[i].length&&a.push(o[i][0],o[i][1],o[i][2],n[i]);return new LineString(a,GeometryLayout.XYZM)}}var ICON_PARSERS=makeStructureNS(NAMESPACE_URIS,{href:makeObjectPropertySetter(readURI)},makeStructureNS(GX_NAMESPACE_URIS,{x:makeObjectPropertySetter(readDecimal),y:makeObjectPropertySetter(readDecimal),w:makeObjectPropertySetter(readDecimal),h:makeObjectPropertySetter(readDecimal)}));function readIcon(e,t){var r=pushParseAndPop({},ICON_PARSERS,e,t);return r||null}var GEOMETRY_FLAT_COORDINATES_PARSERS=makeStructureNS(NAMESPACE_URIS,{coordinates:makeReplacer(readFlatCoordinates)});function readFlatCoordinatesFromNode(e,t){return pushParseAndPop(null,GEOMETRY_FLAT_COORDINATES_PARSERS,e,t)}var EXTRUDE_AND_ALTITUDE_MODE_PARSERS=makeStructureNS(NAMESPACE_URIS,{extrude:makeObjectPropertySetter(readBoolean),tessellate:makeObjectPropertySetter(readBoolean),altitudeMode:makeObjectPropertySetter(readString)});function readLineString(e,t){var r=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,e,t),a=readFlatCoordinatesFromNode(e,t);if(a){var o=new LineString(a,GeometryLayout.XYZ);return o.setProperties(r,!0),o}}function readLinearRing(e,t){var r=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,e,t),a=readFlatCoordinatesFromNode(e,t);if(a){var o=new Polygon(a,GeometryLayout.XYZ,[a.length]);return o.setProperties(r,!0),o}}var MULTI_GEOMETRY_PARSERS=makeStructureNS(NAMESPACE_URIS,{LineString:makeArrayPusher(readLineString),LinearRing:makeArrayPusher(readLinearRing),MultiGeometry:makeArrayPusher(readMultiGeometry),Point:makeArrayPusher(readPoint),Polygon:makeArrayPusher(readPolygon)});function readMultiGeometry(e,t){var r,a=pushParseAndPop([],MULTI_GEOMETRY_PARSERS,e,t);if(!a)return null;if(0===a.length)return new GeometryCollection(a);for(var o,n=!0,i=a[0].getType(),S=1,l=a.length;S<l;++S)if((o=a[S]).getType()!=i){n=!1;break}if(n){var E=void 0,s=void 0;if(i==GeometryType.POINT){var A=a[0];E=A.getLayout(),s=A.getFlatCoordinates();for(S=1,l=a.length;S<l;++S)o=a[S],extend(s,o.getFlatCoordinates());setCommonGeometryProperties(r=new MultiPoint(s,E),a)}else i==GeometryType.LINE_STRING?setCommonGeometryProperties(r=new MultiLineString(a),a):i==GeometryType.POLYGON?setCommonGeometryProperties(r=new MultiPolygon(a),a):i==GeometryType.GEOMETRY_COLLECTION?r=new GeometryCollection(a):assert(!1,37)}else r=new GeometryCollection(a);return r}function readPoint(e,t){var r=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,e,t),a=readFlatCoordinatesFromNode(e,t);if(a){var o=new Point(a,GeometryLayout.XYZ);return o.setProperties(r,!0),o}}var FLAT_LINEAR_RINGS_PARSERS=makeStructureNS(NAMESPACE_URIS,{innerBoundaryIs:innerBoundaryIsParser,outerBoundaryIs:outerBoundaryIsParser});function readPolygon(e,t){var r=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,e,t),a=pushParseAndPop([null],FLAT_LINEAR_RINGS_PARSERS,e,t);if(a&&a[0]){for(var o=a[0],n=[o.length],i=1,S=a.length;i<S;++i)extend(o,a[i]),n.push(o.length);var l=new Polygon(o,GeometryLayout.XYZ,n);return l.setProperties(r,!0),l}}var STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{IconStyle:iconStyleParser,LabelStyle:labelStyleParser,LineStyle:lineStyleParser,PolyStyle:polyStyleParser});function readStyle(e,t){var r=pushParseAndPop({},STYLE_PARSERS,e,t,this);if(!r)return null;var a,o="fillStyle"in r?r.fillStyle:DEFAULT_FILL_STYLE,n=r.fill;void 0===n||n||(o=null),"imageStyle"in r?r.imageStyle!=DEFAULT_NO_IMAGE_STYLE&&(a=r.imageStyle):a=DEFAULT_IMAGE_STYLE;var i="textStyle"in r?r.textStyle:DEFAULT_TEXT_STYLE,S="strokeStyle"in r?r.strokeStyle:DEFAULT_STROKE_STYLE,l=r.outline;return void 0===l||l?[new Style({fill:o,image:a,stroke:S,text:i,zIndex:void 0})]:[new Style({geometry:function(e){var t=e.getGeometry(),r=t.getType();return r===GeometryType.GEOMETRY_COLLECTION?new GeometryCollection(t.getGeometriesArrayRecursive().filter((function(e){var t=e.getType();return t!==GeometryType.POLYGON&&t!==GeometryType.MULTI_POLYGON}))):r!==GeometryType.POLYGON&&r!==GeometryType.MULTI_POLYGON?t:void 0},fill:o,image:a,stroke:S,text:i,zIndex:void 0}),new Style({geometry:function(e){var t=e.getGeometry(),r=t.getType();return r===GeometryType.GEOMETRY_COLLECTION?new GeometryCollection(t.getGeometriesArrayRecursive().filter((function(e){var t=e.getType();return t===GeometryType.POLYGON||t===GeometryType.MULTI_POLYGON}))):r===GeometryType.POLYGON||r===GeometryType.MULTI_POLYGON?t:void 0},fill:o,stroke:null,zIndex:void 0})]}function setCommonGeometryProperties(e,t){var r,a,o,n=t.length,i=new Array(t.length),S=new Array(t.length),l=new Array(t.length);r=!1,a=!1,o=!1;for(var E=0;E<n;++E){var s=t[E];i[E]=s.get("extrude"),S[E]=s.get("tessellate"),l[E]=s.get("altitudeMode"),r=r||void 0!==i[E],a=a||void 0!==S[E],o=o||l[E]}r&&e.set("extrude",i),a&&e.set("tessellate",S),o&&e.set("altitudeMode",l)}var DATA_PARSERS=makeStructureNS(NAMESPACE_URIS,{displayName:makeObjectPropertySetter(readString),value:makeObjectPropertySetter(readString)});function dataParser(e,t){var r=e.getAttribute("name");parseNode(DATA_PARSERS,e,t);var a=t[t.length-1];r&&a.displayName?a[r]={value:a.value,displayName:a.displayName,toString:function(){return a.value}}:null!==r?a[r]=a.value:null!==a.displayName&&(a[a.displayName]=a.value),delete a.value}var EXTENDED_DATA_PARSERS=makeStructureNS(NAMESPACE_URIS,{Data:dataParser,SchemaData:schemaDataParser});function extendedDataParser(e,t){parseNode(EXTENDED_DATA_PARSERS,e,t)}function regionParser(e,t){parseNode(REGION_PARSERS,e,t)}var PAIR_PARSERS=makeStructureNS(NAMESPACE_URIS,{Style:makeObjectPropertySetter(readStyle),key:makeObjectPropertySetter(readString),styleUrl:makeObjectPropertySetter(readStyleURL)});function pairDataParser(e,t){var r=pushParseAndPop({},PAIR_PARSERS,e,t,this);if(r){var a=r.key;if(a&&"normal"==a){var o=r.styleUrl;o&&(t[t.length-1]=o);var n=r.Style;n&&(t[t.length-1]=n)}}}function placemarkStyleMapParser(e,t){var r=readStyleMapValue.call(this,e,t);if(r){var a=t[t.length-1];Array.isArray(r)?a.Style=r:"string"==typeof r?a.styleUrl=r:assert(!1,38)}}var SCHEMA_DATA_PARSERS=makeStructureNS(NAMESPACE_URIS,{SimpleData:simpleDataParser});function schemaDataParser(e,t){parseNode(SCHEMA_DATA_PARSERS,e,t)}function simpleDataParser(e,t){var r=e.getAttribute("name");if(null!==r){var a=readString(e);t[t.length-1][r]=a}}var LAT_LON_ALT_BOX_PARSERS=makeStructureNS(NAMESPACE_URIS,{altitudeMode:makeObjectPropertySetter(readString),minAltitude:makeObjectPropertySetter(readDecimal),maxAltitude:makeObjectPropertySetter(readDecimal),north:makeObjectPropertySetter(readDecimal),south:makeObjectPropertySetter(readDecimal),east:makeObjectPropertySetter(readDecimal),west:makeObjectPropertySetter(readDecimal)});function latLonAltBoxParser(e,t){var r=pushParseAndPop({},LAT_LON_ALT_BOX_PARSERS,e,t);if(r){var a=t[t.length-1],o=[parseFloat(r.west),parseFloat(r.south),parseFloat(r.east),parseFloat(r.north)];a.extent=o,a.altitudeMode=r.altitudeMode,a.minAltitude=parseFloat(r.minAltitude),a.maxAltitude=parseFloat(r.maxAltitude)}}var LOD_PARSERS=makeStructureNS(NAMESPACE_URIS,{minLodPixels:makeObjectPropertySetter(readDecimal),maxLodPixels:makeObjectPropertySetter(readDecimal),minFadeExtent:makeObjectPropertySetter(readDecimal),maxFadeExtent:makeObjectPropertySetter(readDecimal)});function lodParser(e,t){var r=pushParseAndPop({},LOD_PARSERS,e,t);if(r){var a=t[t.length-1];a.minLodPixels=parseFloat(r.minLodPixels),a.maxLodPixels=parseFloat(r.maxLodPixels),a.minFadeExtent=parseFloat(r.minFadeExtent),a.maxFadeExtent=parseFloat(r.maxFadeExtent)}}var INNER_BOUNDARY_IS_PARSERS=makeStructureNS(NAMESPACE_URIS,{LinearRing:makeArrayPusher(readFlatLinearRing)});function innerBoundaryIsParser(e,t){var r=pushParseAndPop([],INNER_BOUNDARY_IS_PARSERS,e,t);if(r.length>0){var a=t[t.length-1];a.push.apply(a,r)}}var OUTER_BOUNDARY_IS_PARSERS=makeStructureNS(NAMESPACE_URIS,{LinearRing:makeReplacer(readFlatLinearRing)});function outerBoundaryIsParser(e,t){var r=pushParseAndPop(void 0,OUTER_BOUNDARY_IS_PARSERS,e,t);r&&(t[t.length-1][0]=r)}function linkParser(e,t){parseNode(LINK_PARSERS,e,t)}function whenParser(e,t){var r=t[t.length-1].whens,a=getAllTextContent(e,!1),o=Date.parse(a);r.push(isNaN(o)?0:o)}function writeColorTextNode(e,t){for(var r=asArray(t),a=[255*(4==r.length?r[3]:1),r[2],r[1],r[0]],o=0;o<4;++o){var n=Math.floor(a[o]).toString(16);a[o]=1==n.length?"0"+n:n}writeStringTextNode(e,a.join(""))}function writeCoordinatesTextNode(e,t,r){var a,o=r[r.length-1],n=o.layout,i=o.stride;n==GeometryLayout.XY||n==GeometryLayout.XYM?a=2:n==GeometryLayout.XYZ||n==GeometryLayout.XYZM?a=3:assert(!1,34);var S=t.length,l="";if(S>0){l+=t[0];for(var E=1;E<a;++E)l+=","+t[E];for(var s=i;s<S;s+=i){l+=" "+t[s];for(E=1;E<a;++E)l+=","+t[s+E]}}writeStringTextNode(e,l)}var EXTENDEDDATA_NODE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{Data:makeChildAppender(writeDataNode),value:makeChildAppender(writeDataNodeValue),displayName:makeChildAppender(writeDataNodeName)});function writeDataNode(e,t,r){e.setAttribute("name",t.name);var a={node:e},o=t.value;"object"==typeof o?(null!==o&&o.displayName&&pushSerializeAndPop(a,EXTENDEDDATA_NODE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,[o.displayName],r,["displayName"]),null!==o&&o.value&&pushSerializeAndPop(a,EXTENDEDDATA_NODE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,[o.value],r,["value"])):pushSerializeAndPop(a,EXTENDEDDATA_NODE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,[o],r,["value"])}function writeDataNodeName(e,t){writeCDATASection(e,t)}function writeDataNodeValue(e,t){writeStringTextNode(e,t)}var DOCUMENT_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{Placemark:makeChildAppender(writePlacemark)}),DOCUMENT_NODE_FACTORY=function(e,t,r){var a=t[t.length-1].node;return createElementNS(a.namespaceURI,"Placemark")};function writeDocument(e,t,r){pushSerializeAndPop({node:e},DOCUMENT_SERIALIZERS,DOCUMENT_NODE_FACTORY,t,r,void 0,this)}var DATA_NODE_FACTORY=makeSimpleNodeFactory("Data");function writeExtendedData(e,t,r){for(var a={node:e},o=t.names,n=t.values,i=o.length,S=0;S<i;S++)pushSerializeAndPop(a,EXTENDEDDATA_NODE_SERIALIZERS,DATA_NODE_FACTORY,[{name:o[S],value:n[S]}],r)}var ICON_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["href"],makeStructureNS(GX_NAMESPACE_URIS,["x","y","w","h"])),ICON_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{href:makeChildAppender(writeStringTextNode)},makeStructureNS(GX_NAMESPACE_URIS,{x:makeChildAppender(writeDecimalTextNode),y:makeChildAppender(writeDecimalTextNode),w:makeChildAppender(writeDecimalTextNode),h:makeChildAppender(writeDecimalTextNode)})),GX_NODE_FACTORY=function(e,t,r){return createElementNS(GX_NAMESPACE_URIS[0],"gx:"+r)};function writeIcon(e,t,r){var a={node:e},o=r[r.length-1].node,n=ICON_SEQUENCE[o.namespaceURI],i=makeSequence(t,n);pushSerializeAndPop(a,ICON_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,i,r,n),n=ICON_SEQUENCE[GX_NAMESPACE_URIS[0]],i=makeSequence(t,n),pushSerializeAndPop(a,ICON_SERIALIZERS,GX_NODE_FACTORY,i,r,n)}var ICON_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["scale","heading","Icon","color","hotSpot"]),ICON_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{Icon:makeChildAppender(writeIcon),color:makeChildAppender(writeColorTextNode),heading:makeChildAppender(writeDecimalTextNode),hotSpot:makeChildAppender(writeVec2),scale:makeChildAppender(writeScaleTextNode)});function writeIconStyle(e,t,r){var a={node:e},o={},n=t.getSrc(),i=t.getSize(),S=t.getImageSize(),l={href:n};if(i){l.w=i[0],l.h=i[1];var E=t.getAnchor(),s=t.getOrigin();if(s&&S&&0!==s[0]&&s[1]!==i[1]&&(l.x=s[0],l.y=S[1]-(s[1]+i[1])),E&&(E[0]!==i[0]/2||E[1]!==i[1]/2)){var A={x:E[0],xunits:IconAnchorUnits.PIXELS,y:i[1]-E[1],yunits:IconAnchorUnits.PIXELS};o.hotSpot=A}}o.Icon=l;var m=t.getScaleArray()[0],d=i;(null===d&&(d=DEFAULT_IMAGE_STYLE_SIZE),2==d.length)&&(m/=scaleForSize(d));1!==m&&(o.scale=m);var _=t.getRotation();0!==_&&(o.heading=_);var u=t.getColor();u&&(o.color=u);var c=r[r.length-1].node,T=ICON_STYLE_SEQUENCE[c.namespaceURI],p=makeSequence(o,T);pushSerializeAndPop(a,ICON_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,p,r,T)}var LABEL_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["color","scale"]),LABEL_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{color:makeChildAppender(writeColorTextNode),scale:makeChildAppender(writeScaleTextNode)});function writeLabelStyle(e,t,r){var a={node:e},o={},n=t.getFill();n&&(o.color=n.getColor());var i=t.getScale();i&&1!==i&&(o.scale=i);var S=r[r.length-1].node,l=LABEL_STYLE_SEQUENCE[S.namespaceURI],E=makeSequence(o,l);pushSerializeAndPop(a,LABEL_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,E,r,l)}var LINE_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["color","width"]),LINE_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{color:makeChildAppender(writeColorTextNode),width:makeChildAppender(writeDecimalTextNode)});function writeLineStyle(e,t,r){var a={node:e},o={color:t.getColor(),width:Number(t.getWidth())||1},n=r[r.length-1].node,i=LINE_STYLE_SEQUENCE[n.namespaceURI],S=makeSequence(o,i);pushSerializeAndPop(a,LINE_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,S,r,i)}var GEOMETRY_TYPE_TO_NODENAME={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},GEOMETRY_NODE_FACTORY=function(e,t,r){if(e){var a=t[t.length-1].node;return createElementNS(a.namespaceURI,GEOMETRY_TYPE_TO_NODENAME[e.getType()])}},POINT_NODE_FACTORY=makeSimpleNodeFactory("Point"),LINE_STRING_NODE_FACTORY=makeSimpleNodeFactory("LineString"),LINEAR_RING_NODE_FACTORY=makeSimpleNodeFactory("LinearRing"),POLYGON_NODE_FACTORY=makeSimpleNodeFactory("Polygon"),MULTI_GEOMETRY_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{LineString:makeChildAppender(writePrimitiveGeometry),Point:makeChildAppender(writePrimitiveGeometry),Polygon:makeChildAppender(writePolygon),GeometryCollection:makeChildAppender(writeMultiGeometry)});function writeMultiGeometry(e,t,r){var a,o={node:e},n=t.getType(),i=[];n===GeometryType.GEOMETRY_COLLECTION?(t.getGeometriesArrayRecursive().forEach((function(e){var t=e.getType();t===GeometryType.MULTI_POINT?i=i.concat(e.getPoints()):t===GeometryType.MULTI_LINE_STRING?i=i.concat(e.getLineStrings()):t===GeometryType.MULTI_POLYGON?i=i.concat(e.getPolygons()):t===GeometryType.POINT||t===GeometryType.LINE_STRING||t===GeometryType.POLYGON?i.push(e):assert(!1,39)})),a=GEOMETRY_NODE_FACTORY):n===GeometryType.MULTI_POINT?(i=t.getPoints(),a=POINT_NODE_FACTORY):n===GeometryType.MULTI_LINE_STRING?(i=t.getLineStrings(),a=LINE_STRING_NODE_FACTORY):n===GeometryType.MULTI_POLYGON?(i=t.getPolygons(),a=POLYGON_NODE_FACTORY):assert(!1,39),pushSerializeAndPop(o,MULTI_GEOMETRY_SERIALIZERS,a,i,r)}var BOUNDARY_IS_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{LinearRing:makeChildAppender(writePrimitiveGeometry)});function writeBoundaryIs(e,t,r){pushSerializeAndPop({node:e},BOUNDARY_IS_SERIALIZERS,LINEAR_RING_NODE_FACTORY,[t],r)}var PLACEMARK_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{ExtendedData:makeChildAppender(writeExtendedData),MultiGeometry:makeChildAppender(writeMultiGeometry),LineString:makeChildAppender(writePrimitiveGeometry),LinearRing:makeChildAppender(writePrimitiveGeometry),Point:makeChildAppender(writePrimitiveGeometry),Polygon:makeChildAppender(writePolygon),Style:makeChildAppender(writeStyle),address:makeChildAppender(writeStringTextNode),description:makeChildAppender(writeStringTextNode),name:makeChildAppender(writeStringTextNode),open:makeChildAppender(writeBooleanTextNode),phoneNumber:makeChildAppender(writeStringTextNode),styleUrl:makeChildAppender(writeStringTextNode),visibility:makeChildAppender(writeBooleanTextNode)}),PLACEMARK_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),EXTENDEDDATA_NODE_FACTORY=makeSimpleNodeFactory("ExtendedData");function writePlacemark(e,t,r){var a={node:e};t.getId()&&e.setAttribute("id",t.getId());var o=t.getProperties(),n={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};n[t.getGeometryName()]=1;var i=Object.keys(o||{}).sort().filter((function(e){return!n[e]})),S=t.getStyleFunction();if(S){var l=S(t,0);if(l){var E=Array.isArray(l)?l:[l],s=E;if(t.getGeometry()&&(s=E.filter((function(e){var r=e.getGeometryFunction()(t);if(r){var a=r.getType();return a===GeometryType.GEOMETRY_COLLECTION?r.getGeometriesArrayRecursive().filter((function(e){var t=e.getType();return t===GeometryType.POINT||t===GeometryType.MULTI_POINT})).length:a===GeometryType.POINT||a===GeometryType.MULTI_POINT}}))),this.writeStyles_){var A=E,m=E;t.getGeometry()&&(A=E.filter((function(e){var r=e.getGeometryFunction()(t);if(r){var a=r.getType();return a===GeometryType.GEOMETRY_COLLECTION?r.getGeometriesArrayRecursive().filter((function(e){var t=e.getType();return t===GeometryType.LINE_STRING||t===GeometryType.MULTI_LINE_STRING})).length:a===GeometryType.LINE_STRING||a===GeometryType.MULTI_LINE_STRING}})),m=E.filter((function(e){var r=e.getGeometryFunction()(t);if(r){var a=r.getType();return a===GeometryType.GEOMETRY_COLLECTION?r.getGeometriesArrayRecursive().filter((function(e){var t=e.getType();return t===GeometryType.POLYGON||t===GeometryType.MULTI_POLYGON})).length:a===GeometryType.POLYGON||a===GeometryType.MULTI_POLYGON}}))),o.Style={pointStyles:s,lineStyles:A,polyStyles:m}}if(s.length&&void 0===o.name){var d=s[0].getText();d&&(o.name=d.getText())}}}var _=r[r.length-1].node,u=PLACEMARK_SEQUENCE[_.namespaceURI],c=makeSequence(o,u);if(pushSerializeAndPop(a,PLACEMARK_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,c,r,u),i.length>0){var T=makeSequence(o,i);pushSerializeAndPop(a,PLACEMARK_SERIALIZERS,EXTENDEDDATA_NODE_FACTORY,[{names:i,values:T}],r)}var p=r[0],y=t.getGeometry();y&&(y=transformGeometryWithOptions(y,!0,p)),pushSerializeAndPop(a,PLACEMARK_SERIALIZERS,GEOMETRY_NODE_FACTORY,[y],r)}var PRIMITIVE_GEOMETRY_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["extrude","tessellate","altitudeMode","coordinates"]),PRIMITIVE_GEOMETRY_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{extrude:makeChildAppender(writeBooleanTextNode),tessellate:makeChildAppender(writeBooleanTextNode),altitudeMode:makeChildAppender(writeStringTextNode),coordinates:makeChildAppender(writeCoordinatesTextNode)});function writePrimitiveGeometry(e,t,r){var a=t.getFlatCoordinates(),o={node:e};o.layout=t.getLayout(),o.stride=t.getStride();var n=t.getProperties();n.coordinates=a;var i=r[r.length-1].node,S=PRIMITIVE_GEOMETRY_SEQUENCE[i.namespaceURI],l=makeSequence(n,S);pushSerializeAndPop(o,PRIMITIVE_GEOMETRY_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,l,r,S)}var POLY_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["color","fill","outline"]),POLYGON_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{outerBoundaryIs:makeChildAppender(writeBoundaryIs),innerBoundaryIs:makeChildAppender(writeBoundaryIs)}),INNER_BOUNDARY_NODE_FACTORY=makeSimpleNodeFactory("innerBoundaryIs"),OUTER_BOUNDARY_NODE_FACTORY=makeSimpleNodeFactory("outerBoundaryIs");function writePolygon(e,t,r){var a=t.getLinearRings(),o=a.shift(),n={node:e};pushSerializeAndPop(n,POLYGON_SERIALIZERS,INNER_BOUNDARY_NODE_FACTORY,a,r),pushSerializeAndPop(n,POLYGON_SERIALIZERS,OUTER_BOUNDARY_NODE_FACTORY,[o],r)}var POLY_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{color:makeChildAppender(writeColorTextNode),fill:makeChildAppender(writeBooleanTextNode),outline:makeChildAppender(writeBooleanTextNode)});function writePolyStyle(e,t,r){var a={node:e},o=t.getFill(),n=t.getStroke(),i={color:o?o.getColor():void 0,fill:!!o&&void 0,outline:!!n&&void 0},S=r[r.length-1].node,l=POLY_STYLE_SEQUENCE[S.namespaceURI],E=makeSequence(i,l);pushSerializeAndPop(a,POLY_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,E,r,l)}function writeScaleTextNode(e,t){writeDecimalTextNode(e,Math.round(1e6*t)/1e6)}var STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{IconStyle:makeChildAppender(writeIconStyle),LabelStyle:makeChildAppender(writeLabelStyle),LineStyle:makeChildAppender(writeLineStyle),PolyStyle:makeChildAppender(writePolyStyle)});function writeStyle(e,t,r){var a,o={node:e},n={};if(t.pointStyles.length){var i=t.pointStyles[0].getText();i&&(n.LabelStyle=i);var S=t.pointStyles[0].getImage();S&&"function"==typeof S.getSrc&&(n.IconStyle=S)}t.lineStyles.length&&((a=t.lineStyles[0].getStroke())&&(n.LineStyle=a));t.polyStyles.length&&((a=t.polyStyles[0].getStroke())&&!n.LineStyle&&(n.LineStyle=a),n.PolyStyle=t.polyStyles[0]);var l=r[r.length-1].node,E=STYLE_SEQUENCE[l.namespaceURI],s=makeSequence(n,E);pushSerializeAndPop(o,STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,s,r,E)}function writeVec2(e,t){e.setAttribute("x",String(t.x)),e.setAttribute("y",String(t.y)),e.setAttribute("xunits",t.xunits),e.setAttribute("yunits",t.yunits)}export default KML;
//# sourceMappingURL=/sm/ee12678ca53a5c2df452e2598f9ebd93548f8d477cab563f7dff518c6b4fb1c5.map