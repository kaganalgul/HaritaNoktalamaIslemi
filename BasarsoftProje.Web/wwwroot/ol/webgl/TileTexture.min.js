/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/webgl/TileTexture.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();import EventTarget from"../events/Target.js";import EventType from"../events/EventType.js";import ImageTile from"../ImageTile.js";import ReprojTile from"../reproj/Tile.js";import TileState from"../TileState.js";import WebGLArrayBuffer from"./Buffer.js";import{ARRAY_BUFFER,STATIC_DRAW}from"../webgl.js";import{toSize}from"../size.js";function bindAndConfigure(e,t,r){var i=r?e.LINEAR:e.NEAREST;e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i)}function uploadImageTexture(e,t,r,i){bindAndConfigure(e,t,i),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}function uploadDataTexture(e,t,r,i,n,a){var o=e.getGL();bindAndConfigure(o,t,a);var s,l,T=r.byteLength/i[1],u=1;switch(T%8==0?u=8:T%4==0?u=4:T%2==0&&(u=2),n){case 1:s=o.LUMINANCE;break;case 2:s=o.LUMINANCE_ALPHA;break;case 3:s=o.RGB;break;case 4:s=o.RGBA;break;default:throw new Error("Unsupported number of bands: "+n)}r instanceof Float32Array?(l=o.FLOAT,e.getExtension("OES_texture_float"),e.getExtension("OES_texture_float_linear")):l=o.UNSIGNED_BYTE;var h=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,u),o.texImage2D(o.TEXTURE_2D,0,s,i[0],i[1],0,s,l,r),o.pixelStorei(o.UNPACK_ALIGNMENT,h)}var TileTexture=function(e){function t(t,r,i){var n=e.call(this)||this;n.tile,n.textures=[],n.handleTileChange_=n.handleTileChange_.bind(n),n.size=toSize(r.getTileSize(t.tileCoord[0])),n.bandCount=NaN,n.helper_=i;var a=new WebGLArrayBuffer(ARRAY_BUFFER,STATIC_DRAW);return a.fromArray([0,1,1,1,1,0,0,0]),i.flushBufferData(a),n.coords=a,n.setTile(t),n}return __extends(t,e),t.prototype.setTile=function(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(EventType.CHANGE,this.handleTileChange_),this.tile=e,this.textures.length=0,this.loaded=e.getState()===TileState.LOADED,this.loaded)this.uploadTile_();else{if(e instanceof ImageTile){var t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(EventType.CHANGE,this.handleTileChange_)}},t.prototype.uploadTile_=function(){var e=this.helper_,t=e.getGL(),r=this.tile;if(r instanceof ImageTile||r instanceof ReprojTile){var i=t.createTexture();return this.textures.push(i),this.bandCount=4,void uploadImageTexture(t,i,r.getImage(),r.interpolate)}var n=r.getData(),a=n instanceof Float32Array,o=this.size[0]*this.size[1],s=a?Float32Array:Uint8Array,l=s.BYTES_PER_ELEMENT,T=n.byteLength/this.size[1];this.bandCount=Math.floor(T/l/this.size[0]);var u=Math.ceil(this.bandCount/4);if(1===u){i=t.createTexture();return this.textures.push(i),void uploadDataTexture(e,i,n,this.size,this.bandCount,r.interpolate)}for(var h=new Array(u),E=0;E<u;++E){i=t.createTexture();this.textures.push(i);var f=E<u-1?4:this.bandCount%4;h[E]=new s(o*f)}for(var p=0,_=0,d=this.size[0]*this.bandCount,c=0;c<this.size[1];++c){for(var A=0;A<d;++A){var g=n[_+A],v=Math.floor(p/this.bandCount),m=A%this.bandCount;(x=h[E=Math.floor(m/4)])[v*(f=x.length/o)+m%4]=g,++p}_+=T/l}for(E=0;E<u;++E){var x;i=this.textures[E],f=(x=h[E]).length/o;uploadDataTexture(e,i,x,this.size,f,r.interpolate)}},t.prototype.handleTileChange_=function(){this.tile.getState()===TileState.LOADED&&(this.loaded=!0,this.uploadTile_(),this.dispatchEvent(EventType.CHANGE))},t.prototype.disposeInternal=function(){var e=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(var t=0;t<this.textures.length;++t)e.deleteTexture(this.textures[t]);this.tile.removeEventListener(EventType.CHANGE,this.handleTileChange_)},t}(EventTarget);export default TileTexture;
//# sourceMappingURL=/sm/549b6a7e61e13237cb8be10da66122e4f2cd1326e6a4301ed5949eb76114dbab.map