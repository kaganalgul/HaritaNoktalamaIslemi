/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/ol@6.12.0/reproj.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{IMAGE_SMOOTHING_DISABLED}from"./renderer/canvas/common.js";import{assign}from"./obj.js";import{containsCoordinate,createEmpty,extend,forEachCorner,getCenter,getHeight,getTopLeft,getWidth}from"./extent.js";import{createCanvasContext2D}from"./dom.js";import{getPointResolution,transform}from"./proj.js";import{solveLinearSystem}from"./math.js";var brokenDiagonalRendering_;function drawTestTriangle(e,t,n,r,o){e.beginPath(),e.moveTo(0,0),e.lineTo(t,n),e.lineTo(r,o),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,r)+1,Math.max(n,o)),e.restore()}function verifyBrokenDiagonalRendering(e,t){return Math.abs(e[4*t]-210)>2||Math.abs(e[4*t+3]-191.25)>2}function isBrokenDiagonalRendering(){if(void 0===brokenDiagonalRendering_){var e=document.createElement("canvas").getContext("2d");e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",drawTestTriangle(e,4,5,4,0),drawTestTriangle(e,4,5,0,5);var t=e.getImageData(0,0,3,3).data;brokenDiagonalRendering_=verifyBrokenDiagonalRendering(t,0)||verifyBrokenDiagonalRendering(t,4)||verifyBrokenDiagonalRendering(t,8)}return brokenDiagonalRendering_}export function calculateSourceResolution(e,t,n,r){var o=transform(n,t,e),a=getPointResolution(t,r,n),i=t.getMetersPerUnit();void 0!==i&&(a*=i);var g=e.getMetersPerUnit();void 0!==g&&(a/=g);var s=e.getExtent();if(!s||containsCoordinate(s,o)){var l=getPointResolution(e,a,o)/a;isFinite(l)&&l>0&&(a/=l)}return a}export function calculateSourceExtentResolution(e,t,n,r){var o=getCenter(n),a=calculateSourceResolution(e,t,o,r);return(!isFinite(a)||a<=0)&&forEachCorner(n,(function(n){return a=calculateSourceResolution(e,t,n,r),isFinite(a)&&a>0})),a}export function render(e,t,n,r,o,a,i,g,s,l,c,u){var v=createCanvasContext2D(Math.round(n*e),Math.round(n*t));if(u||assign(v,IMAGE_SMOOTHING_DISABLED),0===s.length)return v.canvas;function m(e){return Math.round(e*n)/n}v.scale(n,n),v.globalCompositeOperation="lighter";var f=createEmpty();s.forEach((function(e,t,n){extend(f,e.extent)}));var d=getWidth(f),h=getHeight(f),T=createCanvasContext2D(Math.round(n*d/r),Math.round(n*h/r));u||assign(T,IMAGE_SMOOTHING_DISABLED);var p=n/r;s.forEach((function(e,t,n){var r=e.extent[0]-f[0],o=-(e.extent[3]-f[3]),a=getWidth(e.extent),i=getHeight(e.extent);e.image.width>0&&e.image.height>0&&T.drawImage(e.image,l,l,e.image.width-2*l,e.image.height-2*l,r*p,o*p,a*p,i*p)}));var D=getTopLeft(i);return g.getTriangles().forEach((function(e,t,o){var i=e.source,g=e.target,s=i[0][0],l=i[0][1],c=i[1][0],d=i[1][1],h=i[2][0],p=i[2][1],x=m((g[0][0]-D[0])/a),R=m(-(g[0][1]-D[1])/a),E=m((g[1][0]-D[0])/a),M=m(-(g[1][1]-D[1])/a),C=m((g[2][0]-D[0])/a),b=m(-(g[2][1]-D[1])/a),S=s,k=l;s=0,l=0;var I=solveLinearSystem([[c-=S,d-=k,0,0,E-x],[h-=S,p-=k,0,0,C-x],[0,0,c,d,M-R],[0,0,h,p,b-R]]);if(I){if(v.save(),v.beginPath(),isBrokenDiagonalRendering()||!u){v.moveTo(E,M);for(var y=x-E,P=R-M,_=0;_<4;_++)v.lineTo(E+m((_+1)*y/4),M+m(_*P/3)),3!=_&&v.lineTo(E+m((_+1)*y/4),M+m((_+1)*P/3));v.lineTo(C,b)}else v.moveTo(E,M),v.lineTo(x,R),v.lineTo(C,b);v.clip(),v.transform(I[0],I[2],I[1],I[3],x,R),v.translate(f[0]-S,f[3]-k),v.scale(r/n,-r/n),v.drawImage(T.canvas,0,0),v.restore()}})),c&&(v.save(),v.globalCompositeOperation="source-over",v.strokeStyle="black",v.lineWidth=1,g.getTriangles().forEach((function(e,t,n){var r=e.target,o=(r[0][0]-D[0])/a,i=-(r[0][1]-D[1])/a,g=(r[1][0]-D[0])/a,s=-(r[1][1]-D[1])/a,l=(r[2][0]-D[0])/a,c=-(r[2][1]-D[1])/a;v.beginPath(),v.moveTo(g,s),v.lineTo(o,i),v.lineTo(l,c),v.closePath(),v.stroke()})),v.restore()),v.canvas}
//# sourceMappingURL=/sm/a5e5473453f99fb69476a9438916fbfae49c90cd50efabc4f8d98c8f4655aec0.map